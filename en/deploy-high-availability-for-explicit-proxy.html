<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Deploy High Availability for Explicit Proxy</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/jquery.paligocode.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="configure-appliances-in-a-cluster-for-scalability.html#UUID-4a62d21a-0085-c244-3663-7cc61f3c4ecd_section-5cbe2f68a3163-idm46756702752560" title="Configure the Cluster"></link><link rel="next" href="deploy-high-availability-for-explicit-proxy.html#idm45631714347104" title="IP assignment at the Inbound"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script type="text/javascript">var containerid = 'GTM-W56WJ8S';

						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer',containerid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="appliances.html">Appliances</a></li><li class="breadcrumb-link"><a href="on-premises-appliance.html">On-Premises Appliance</a></li><li class="breadcrumb-node">Deploy High Availability for Explicit Proxy</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="configure-appliances-in-a-cluster-for-scalability.html#UUID-4a62d21a-0085-c244-3663-7cc61f3c4ecd_section-5cbe2f68a3163-idm46756702752560">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="deploy-high-availability-for-explicit-proxy.html#idm45631714347104">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-614ae0a9-5701-e4f1-34af-a883ad296e46" data-permalink="deploy-high-availability-for-explicit-proxy.html" data-topic-level="1" data-relative-prefix="" data-time-modified="July 27, 2020" data-publication-date="" id="UUID-e2fc25a2-9e37-e7fb-59b5-f7d2957155a7"><div class="titlepage"><div><div class="title"><h4 class="title">Deploy High Availability for Explicit Proxy</h4></div></div></div><p>Netskope provides support to ensure high availability of Dataplane On-Premises appliances that are running in explicit proxy mode. The high availability deployment requires at least two appliances, <span class="phrase">primary</span> and backup configured in a cluster in active-passive mode. When high availability is enabled, the <span class="phrase">primary</span> appliance is active and the backup appliance is on standby. The <span class="phrase">primary</span> appliance receives requests from client machines to serve as a proxy server for the cloud and web application domains managed by Netskope. A health check service running on the appliance, monitors the health of the appliance at regular intervals. In case of a failure, the status of the appliance is changed from <code class="literal">HEALTHY</code> to <code class="literal">FAULT</code>. </p><p>Netskope assigns a priority value to appliances in a cluster. The appliance priority determines the order in which an appliance goes from being a backup to <span class="phrase">primary</span> during a failover.</p><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm45631714347104"><div class="titlepage"><div><div class="title"><h5 class="title">IP assignment at the Inbound</h5></div></div></div><p>The appliance receives client traffic at the inbound interface. The inbound interfaces of appliances that are configured in a high availability cluster have an assigned interface IP and a shared set of virtual IP addresses. The virtual IPs are assigned to a <span class="phrase">primary</span> appliance. During a failover, the failed <span class="phrase">primary</span> appliance releases the virtual IPs so they can be reassigned to the next active appliance.</p><p>The lowest IP address from the set of IP addresses of an inbound interface is assigned as the interface IP of an appliance.</p><div class="example" id="idm45631714343840"><div class="example-title">Example 2. Example</div><div class="example-contents"><p>If the inbound interface of an appliance is set to:</p><p><code class="literal">172.16.1.12-172.16.1.60,172.16.1.64,172.16.1.10,172.16.1.65-172.16.1.125</code></p><p>Then, the lowest IP, <span class="bold bold"><strong>172.16.1.10</strong></span> is assigned as the interface IP of the appliance.</p><p>The following virtual IPs are assigned to an active <span class="phrase">primary</span> appliance.</p><p><code class="literal">172.16.1.12-172.16.1.60,172.16.1.64,172.16.1.65-172.16.1.125</code></p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>All appliances in a cluster must have the same virtual IP addresses and a unique interface IP address assigned at the inbound interface.</p></div><div class="mediaobject"><img src="image/uuid-e980e9c4-4178-57b9-4065-ab590a68cba7.gif" style="" alt="High_Availability.gif"></img></div></div></div><br class="example-break"></br></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm45631714346848"><div class="titlepage"><div><div class="title"><h5 class="title">Failover Scenarios</h5></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the <span class="phrase">primary</span> appliance fails, a backup appliance is chosen based on the appliance priority and becomes active. All client requests will be sent to this appliance. When the <span class="phrase">primary</span> appliance is restored, it goes into standby.</p></li><li class="listitem"><p>If both the <span class="phrase">primary</span> and backup fail, then the first appliance to be restored becomes the active appliance.</p></li><li class="listitem"><p>If backup appliance fails while on standby, then the <span class="phrase">primary</span> appliance receives an alert from the backup appliance stating that the high availability mode is not available.</p></li><li class="listitem"><p>During a failover, if the available appliances in standby have the same priority value, then the first appliance to startup successfully becomes active. </p></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-e2fc25a2-9e37-e7fb-59b5-f7d2957155a7_N1525384901907"><div class="titlepage"><div><div class="title"><h5 class="title">Prerequisites</h5></div></div></div><p>Before configuring appliances in active-passive mode, plan the allocation of IP addresses. </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Ensure that you have two or more IP addresses to configure the inbound interface.</p></li><li class="listitem"><p>Depending on the number of appliances to be configured in your high availability deployment, reserve the same number of IP addresses for the interface IP. These IP addresses must be the lowest IPs in your set.</p><p>For example, if you deploy high availability with two appliances, reserve the two lowest IP addresses from your set of IP addresses for the interface IP of each appliance.</p></li><li class="listitem"><p>Ensure that the following do not use the lowest IP address,</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>proxy-listener-ip: set dataplane proxy-listener-ip <span class="emphasis"><em>&lt;IP address&gt;</em></span></p></li><li class="listitem"><p>pac-server-ip: set dataplane pac-server listener-ip <span class="emphasis"><em>&lt;IP address&gt;</em></span></p></li><li class="listitem"><p>ad-connector listener-ip: set ad-connector listener-ip <span class="emphasis"><em>&lt;IP address&gt;</em></span></p></li></ul></div></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm45631714330144"><div class="titlepage"><div><div class="title"><h5 class="title">Configure Appliances in Active-Passive Mode</h5></div></div></div><p>Appliances can function reliably with minimum down-time when they are configured in a high availability cluster. Follow these steps to configure the Dataplane On-Premises appliances in active-passive mode.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Before you begin, ensure that the appliances are configured to run in explicit proxy mode. For more information see, <a class="xref" href="configure-the-appliance-in-explicit-proxy-mode.html" title="Configure the Appliance in Explicit Proxy mode"><span class="xreftitle">Configure the Appliance in Explicit Proxy mode</span></a>.</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>At the Netskope shell prompt, enter <code class="literal">configure</code> to go to configuration mode.</p></li><li class="listitem"><p>Assign the interface IP and virtual IPs at the inbound interface of the appliance. Refer to the <a class="xref" href="deploy-high-availability-for-explicit-proxy.html#UUID-e2fc25a2-9e37-e7fb-59b5-f7d2957155a7_N1525384901907" title="Prerequisites"><span class="xreftitle">Prerequisites</span></a> section before assigning interface IPs.</p><pre class="programlisting">set interface inbound ip <span class="emphasis"><em>&lt;interface-ip-address,virtual-ip-addresses without space&gt;</em></span></pre><p>For example, on DPoP1, run:</p><pre class="programlisting">set interface inbound ip 172.16.1.64,172.16.1.65-172.16.1.125,<span class="bold bold"><strong>172.16.1.10</strong></span>,172.16.1.12-172.16.1.60
</pre><p>For example, on DPoP2, run:</p><pre class="programlisting">set interface inbound ip 172.16.1.12-172.16.1.60,172.16.1.64,172.16.1.65-172.16.1.125,<span class="bold bold"><strong>172.16.1.11</strong></span></pre><div dir="ltr" class="warning"><h3 class="title">Warning</h3><p>This command will override the previous inbound interface IP configurations on the appliances.</p></div></li><li class="listitem"><p>Optionally, set the virtual router id of the cluster to which the appliance should be assigned. By default, Netskope assigns a virtual router id of 16 to all appliances in a cluster when high availability is enabled.</p><pre class="programlisting">set dataplane ha mode active-passive vrid <span class="emphasis"><em>&lt;integer value&gt;</em></span></pre><div dir="ltr" class="note"><h3 class="title">Note</h3><p>All appliances in a cluster must have the same virtual router id.</p></div></li><li class="listitem"><p>Enable high availability in active-passive mode.</p><pre class="programlisting">set dataplane ha mode active-passive enable true</pre></li><li class="listitem"><p>Enable the explicit proxy mode on the appliance.</p><pre class="programlisting">set dataplane proxy-listener-ip <span class="emphasis"><em>&lt;virtual-ip-address&gt;</em></span>
</pre><p>For example, <code class="literal">set dataplane proxy-listener-ip 172.16.1.20</code></p><p>For information on configuring the proxy-listener-ip and pac-server-ip, see <a class="xref" href="configure-the-appliance-in-explicit-proxy-mode.html" title="Configure the Appliance in Explicit Proxy mode"><span class="xreftitle">Configure the Appliance in Explicit Proxy mode</span></a>.</p><p>For information on configuring the ad-connector listener-ip, see .</p></li><li class="listitem"><p>Enter <code class="literal">save</code> to save the configuration.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm45631714325168"><div class="titlepage"><div><div class="title"><h5 class="title">View Configuration</h5></div></div></div><p>To view your configuration, in operation mode enter:</p><pre class="programlisting">show dataplane ha environment</pre><p>Health check plugins are signals from the appliance services that provide the overall health of the appliance. The following health check plugins monitor the health of services and are enabled by default.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>forward-proxy</p></li><li class="listitem"><p>tssfastscan</p></li><li class="listitem"><p>internet</p></li></ul></div><p>To disable a health check plugin, in CLI's configuration mode, run:</p><pre class="programlisting">set dataplane ha mode active-passive health-check-plugin <span class="emphasis"><em>&lt;health check plugin&gt;</em></span> enable false
save</pre></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm45631714310032"><div class="titlepage"><div><div class="title"><h5 class="title">Manual Failover</h5></div></div></div><p> When configuration changes are made on the <span class="phrase">primary</span> appliance, a manual failover can be performed to ensure that services are not disrupted. Manual failover is only possible when a healthy backup appliance is available. </p><p>In operation mode, run:</p><pre class="programlisting">request dataplane ha manual-failover</pre><p>If this command is run without an available healthy backup appliance, then the current <span class="phrase">primary</span> appliance on which the command is run will continue to be the <span class="phrase">primary</span>.</p></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-e2fc25a2-9e37-e7fb-59b5-f7d2957155a7">Deploy High Availability for Explicit Proxy</a></li><li><a href="#idm45631714347104">IP assignment at the Inbound</a></li><li><a href="#idm45631714346848">Failover Scenarios</a></li><li><a href="#UUID-e2fc25a2-9e37-e7fb-59b5-f7d2957155a7_N1525384901907">Prerequisites</a></li><li><a href="#idm45631714330144">Configure Appliances in Active-Passive Mode</a></li><li><a href="#idm45631714325168">View Configuration</a></li><li><a href="#idm45631714310032">Manual Failover</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Deploy%20High%20Availability%20for%20Explicit%20Proxy%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Deploy%20High%20Availability%20for%20Explicit%20Proxy%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="configure-appliances-in-a-cluster-for-scalability.html#UUID-4a62d21a-0085-c244-3663-7cc61f3c4ecd_section-5cbe2f68a3163-idm46756702752560">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="deploy-high-availability-for-explicit-proxy.html#idm45631714347104">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">July 27, 2020</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div><!--Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W56WJ8S" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!--End Google Tag Manager (noscript)--></body></html>
