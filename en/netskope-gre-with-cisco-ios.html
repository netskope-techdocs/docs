<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Netskope GRE with Cisco IOS</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/jquery.paligocode.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="tips-and-faqs.html" title="Tips and FAQs"></link><link rel="next" href="netskope-gre-with-cisco-ios.html#UUID-128ba5c3-4184-2659-3501-a9cb09bae110_section-idm4638369515048032624282664594" title="Prerequisites"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script type="text/javascript">var containerid = 'GTM-W56WJ8S';

						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer',containerid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="integrations.html">Integrations</a></li><li class="breadcrumb-link"><a href="ipsec-and-gre.html">IPSec and GRE</a></li><li class="breadcrumb-node">Netskope GRE with Cisco IOS</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="tips-and-faqs.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-gre-with-cisco-ios.html#UUID-128ba5c3-4184-2659-3501-a9cb09bae110_section-idm4638369515048032624282664594">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section reused-publication reused-publication" data-origin-id="UUID-128ba5c3-4184-2659-3501-a9cb09bae110" data-permalink="netskope-gre-with-cisco-ios.html" data-topic-level="1" data-relative-prefix="" data-time-modified="December 3, 2021" data-publication-date="" id="UUID-128ba5c3-4184-2659-3501-a9cb09bae110"><div class="titlepage"><div><div class="title"><h4 class="title">Netskope GRE with Cisco IOS</h4></div></div></div><p>Netskope supports Generic Route Encapsulation (GRE) tunnels as a traffic steering method. GRE tunnels allow you to route web traffic (port 80 and 443) to Netskope using logical tunnel interfaces that terminate to a Netskope GRE gateway.  When you create GRE tunnels in Netskope, parameters for configuring the tunnels are provided. The GRE configuration below utilizes Cisco IOS XE commands and concepts. </p><p>This guide illustrates how to configure GRE tunnels between Netskope and the following Cisco routers:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Cisco CSR 1000v (VXE) running IOS XE version 17.03.03</p></li><li class="listitem"><p>Cisco ISR 3900 (C3900-UNIVERSALK9-M) running IOS XE version 15.4(3)M3</p></li></ul></div><p>You must define the GRE tunnel interfaces and failover methods. To meet your individual SLAs or requirements, you can modify certain parameters such as interfaces, timeouts, and thresholds. To learn more about the CLI steps on Cisco IOS XE, see the <a class="link" href="https://www.cisco.com/c/en/us/support/all-products.html" target="_blank" rel="noopener">Cisco documentation</a>.</p><div class="mediaobject"><img src="image/uuid-e0aec99b-5087-04a0-6945-21e0c036d869.png" style="" alt="GRE-Tunnel-Cisco-IOS-XE-Diagram.png" title="GRE-Tunnel-Cisco-IOS-XE-Diagram.png"></img></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-128ba5c3-4184-2659-3501-a9cb09bae110_section-idm4638369515048032624282664594"><div class="titlepage"><div><div class="title"><h5 class="title">Prerequisites</h5></div></div></div><p>Before configuring GRE, review the <a class="link" href="gre-127075.html" title="GRE">guidelines and prerequisites</a>.</p></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-10a2709b-a10c-f0a2-2101-949c2471a42e" data-time-modified="December 3, 2021" data-publication-date="" id="UUID-75f61c59-b47e-7e0d-946a-efbef48676f0"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-75f61c59-b47e-7e0d-946a-efbef48676f0_body" data-parent="#UUID-75f61c59-b47e-7e0d-946a-efbef48676f0"><div><div class="title"><h5 class="title">Creating GRE Tunnels in Netskope</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-75f61c59-b47e-7e0d-946a-efbef48676f0_body"><p>To create the GRE tunnels for Cisco routers in the Netskope UI:</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Go to <span class="bold bold"><strong>Settings</strong></span> &gt; <span class="bold bold"><strong><span class="phrase">Security Cloud Platform</span></strong></span> &gt; <span class="bold bold"><strong>GRE</strong></span>.</p></li><li class="step"><p>Click <span class="bold bold"><strong>New GRE Configuration</strong></span>. </p></li><li class="step"><p>In the <span class="bold bold"><strong>New GRE Configuration</strong></span> window:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Configuration Name</strong></span>: Enter a name for the GRE tunnel.</p></li><li class="listitem"><p><span class="bold bold"><strong>Tunnel Type</strong></span>: Select <span class="bold bold"><strong>Default</strong></span>.</p></li><li class="listitem"><p><span class="bold bold"><strong>Source Peer</strong></span>: Enter the source peer IP address (i.e., exit public IP) of the Cisco router that Netskope will receive packets from. Netskope identifies traffic belonging to your organization through your router or firewall IP addresses.</p></li></ul></div><div class="mediaobject"><img src="image/uuid-0fe08c77-1b6a-d547-3482-0d1c9462fa5a.png" style="" alt="The New GRE Configuration window on the GRE page." title="The New GRE Configuration window"></img></div></li><li class="step"><p>Click <span class="bold bold"><strong>Save and View POPs</strong></span>. </p></li><li class="step"><p>In the <span class="bold bold"><strong>Netskope POPs</strong></span> window, copy the <span class="bold bold"><strong>GRE Gateway</strong></span> IP address of the two closest Netskope POPs. You need this information to establish the GRE tunnels on your Cisco routers. For optimal performance, Netskope recommends using the geographically closest POPs and configuring at least two tunnels for each egress location in your network.</p><div class="mediaobject"><img src="image/uuid-896d45bb-639d-01a3-5e46-e1bfbce78ce6.png" style="" alt="Netskope Points Of Presense POPs information in the Netskope POPs window." title="Netskope Points Of Presense POPs information in the Netskope POPs window"></img></div></li></ol></div></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-f2d5fea4-3266-1307-0d6e-8389789c64da" data-time-modified="December 3, 2021" data-publication-date="" id="UUID-d9a7eca9-c21f-85bf-e33b-c54d98522985"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-d9a7eca9-c21f-85bf-e33b-c54d98522985_body" data-parent="#UUID-d9a7eca9-c21f-85bf-e33b-c54d98522985"><div><div class="title"><h5 class="title">Defining the Primary Tunnel Interface</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-d9a7eca9-c21f-85bf-e33b-c54d98522985_body"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Log in to your Cisco router.</p></li><li class="step"><p>Enter configuration mode: </p><pre class="programlisting">#configure terminal</pre></li><li class="step"><p>Create your tunnel interface with an ID:</p><pre class="programlisting">#Interface Tunnel1</pre></li><li class="step"><p>Enter an IP address for the interface. It can be any one you choose.</p><pre class="programlisting">(config-if)#ip address 192.168.100.2 255.255.255.254</pre></li><li class="step"><p>Enter the MSS value for the interface. To learn how to calculate this value, see <a class="xref" href="gre-127075.html" title="GRE"><span class="xreftitle">GRE</span></a>. </p><pre class="programlisting">(config-if)#ip tcp adjust-mss 1436</pre></li><li class="step"><p>Set the tunnel source interface, which is the interface that the tunnel is attached to. It's typically the public interface of the router.</p><pre class="programlisting">(config-if)#tunnel source GigabitEthernet0/0</pre></li><li class="step"><p>Set the tunnel destination to the IP address of the primary Netskope POP, which you copied in <a class="xref" href="netskope-gre-with-cisco-ios.html#UUID-75f61c59-b47e-7e0d-946a-efbef48676f0" title="Creating GRE Tunnels in Netskope"><span class="xreftitle">Creating GRE Tunnels in Netskope</span></a>):</p><pre class="programlisting">(config-if)#tunnel destination 10.136.176.49</pre></li></ol></div><p>To verify the primary tunnel interface is up and running on your router, you can enter the <code class="literal">show ip interface brief</code> command. If the configuration is successful, the <code class="literal">Status</code> and <code class="literal">Protocol</code> will be <code class="literal">UP</code>.</p><pre class="programlisting">Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     10.2.10.85      YES DHCP   up                    up
GigabitEthernet0/1     10.2.16.139     YES NVRAM  up                    up
Tunnel1                10.2.10.85      YES TFTP   up  			up
Tunnel2                10.2.10.85      YES TFTP   up                    up
VirtualPortGroup0      192.168.35.101  YES NVRAM  up
</pre></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-4ff75380-e84d-58c1-e7ba-ea9f96edd59a" data-time-modified="December 3, 2021" data-publication-date="" id="UUID-6b5ab6e7-06a5-2e78-ef14-84f82bfea32a"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-6b5ab6e7-06a5-2e78-ef14-84f82bfea32a_body" data-parent="#UUID-6b5ab6e7-06a5-2e78-ef14-84f82bfea32a"><div><div class="title"><h5 class="title">Defining the Backup Tunnel Interface</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-6b5ab6e7-06a5-2e78-ef14-84f82bfea32a_body"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create your tunnel interface with an ID:</p><pre class="programlisting">#Interface Tunnel2</pre></li><li class="step"><p>Enter an IP address for the interface. It can be any one you choose.</p><pre class="programlisting">(config-if)#ip address 192.168.100.4 255.255.255.254</pre></li><li class="step"><p>Enter the MSS value for the interface. To learn how to calculate this value, see <a class="xref" href="gre-127075.html" title="GRE"><span class="xreftitle">GRE</span></a>. </p><pre class="programlisting">(config-if)#ip tcp adjust-mss 1436</pre></li><li class="step"><p>Set the tunnel source interface, which is the interface that the tunnel is attached to. It's typically the public interface of the router.</p><pre class="programlisting">(config-if)#tunnel source GigabitEthernet0/0</pre></li><li class="step"><p>Set the tunnel destination to the IP address of the backup Netskope POP, which you copied in <a class="xref" href="netskope-gre-with-cisco-ios.html#UUID-75f61c59-b47e-7e0d-946a-efbef48676f0" title="Creating GRE Tunnels in Netskope"><span class="xreftitle">Creating GRE Tunnels in Netskope</span></a>): </p><pre class="programlisting">(config-if)#tunnel destination 10.136.176.61</pre></li></ol></div><p>To verify the backup tunnel interface is up and running on your router, you can enter the <code class="literal">show ip interface brief</code> command. If the configuration is successful, the <code class="literal">Status</code> and <code class="literal">Protocol</code> will be <code class="literal">UP</code>.</p><pre class="programlisting">Interface              IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0     10.2.10.85      YES DHCP   up                    up
GigabitEthernet0/1     10.2.16.139     YES NVRAM  up                    up
Tunnel1                10.2.10.85      YES TFTP   up  			up
Tunnel2                10.2.10.85      YES TFTP   up                    up
VirtualPortGroup0      192.168.35.101  YES NVRAM  up
</pre></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-4bf0e68b-c733-f754-2744-3d309ef00be4" data-time-modified="December 3, 2021" data-publication-date="" id="UUID-9395c4ca-08d6-1d81-2e78-6449ee669f42"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-9395c4ca-08d6-1d81-2e78-6449ee669f42_body" data-parent="#UUID-9395c4ca-08d6-1d81-2e78-6449ee669f42"><div><div class="title"><h5 class="title">Configuring the ACL &amp; Route Map</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-9395c4ca-08d6-1d81-2e78-6449ee669f42_body"><p>You can use the route map to only route web traffic on ports 80 and 443 to through the GRE tunnels.</p><p>To configure an access control list (ACL) and route map: </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Create an ACL for the traffic you want to match and apply the route map to:</p><pre class="programlisting">(config)#access-list 110 permit tcp any any eq www
(config)#access-list 110 permit tcp any any eq 443</pre></li><li class="step"><p>Define a route map to match traffic against:</p><pre class="programlisting">(config)#route-map netskope-tunnel permit 15</pre></li><li class="step"><p>Assign the access-list to the route map you created in Step 2:</p><pre class="programlisting">(config-route-map)#match ip address 110</pre></li><li class="step"><p>Set the tunnel interfaces in order of priority:</p><pre class="programlisting">(config-route-map)#set interface Tunnel1 Tunnel2</pre></li><li class="step"><p>Apply the route map to the interface that the traffic must be rerouted from:</p><pre class="programlisting">(config-route-map)#Interface GigabitEthernet0/0
(config-if)#ip policy route-map netskope-tunnel</pre></li></ol></div></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-0f989c92-2a8f-cf92-2908-4f82f614eea2" data-time-modified="December 3, 2021" data-publication-date="" id="UUID-d42f7ee5-e06f-f803-05e9-85836b9c883b"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-d42f7ee5-e06f-f803-05e9-85836b9c883b_body" data-parent="#UUID-d42f7ee5-e06f-f803-05e9-85836b9c883b"><div><div class="title"><h5 class="title">Configuring the Failover Options</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-d42f7ee5-e06f-f803-05e9-85836b9c883b_body"><p>Cisco provides two options to automate failover between the primary and backup GRE tunnels.  You can use keepalives on the tunnel or combine IP SLA with Embedded Event Manager (EEM) to automate the failover. Netskope recommends using GRE keepalives because they are easy to configure. </p><section dir="ltr" class="section accordion accordion" data-origin-id="" data-publication-date="" id="idm45376304779792"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#idm45376304779792_body" data-parent="#idm45376304779792"><div><div class="title"><h6 class="title">Configure GRE Keepalives</h6></div></div></a></div></div><div class="panel-body collapse" id="idm45376304779792_body"><div class="panel-inner"><p>Configure your tunnel interfaces for keepalives (the parameters 10 and 3 are for demonstration purposes only.  They need to be tuned to your environment and thresholds.  The first parameter is the keepalive period and the second is the number of keepalive retries before the tunnel will be changed to a down state until the keepalive succeeds again.</p><pre class="programlisting">(config)#interface tunnel1
(config-if)#keepalive 10 3
(config-if)#interface tunnel2
(config-if)#keepalive 10 3</pre><p>To learn more about monitoring GRE tunnels with keepalives, see <a class="xref" href="gre-127075.html" title="GRE"><span class="xreftitle">GRE</span></a>. To learn more about GRE keepalives, see the <a class="link" href="https://www.cisco.com/c/en/us/support/docs/ip/generic-routing-encapsulation-gre/63760-gre-keepalives-63760.html" target="_blank" rel="noopener">Cisco documentation</a>.</p></div></div></div></section><section dir="ltr" class="section accordion accordion" data-origin-id="" data-publication-date="" id="idm45376304779184"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#idm45376304779184_body" data-parent="#idm45376304779184"><div><div class="title"><h6 class="title">Combine IP SLA and EEM</h6></div></div></a></div></div><div class="panel-body collapse" id="idm45376304779184_body"><div class="panel-inner"><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Configure host routes to the primary and backup probe IP addresses through their corresponding tunnel interface.</p><pre class="programlisting">(config)#ip route 172.17.89.18 255.255.255.255 Tunnel1
(config)#ip route 172.20.16.15 255.255.255.255 Tunnel2</pre></li><li class="step"><p>Ping the probe to test it's reachability.</p></li><li class="step"><p>Configure the IP SLA objects:</p><pre class="programlisting">(config)#ip sla 1
(config-ip-sla)#icmp-echo 172.17.89.18 source-interface Tunnel1
(config-ip-sla-echo)#threshold 500
(config-ip-sla-echo)#frequency 5
(config)#ip sla schedule 1 life forever start-time now
(config)#ip sla 2
(config-ip-sla)#icmp-echo 172.20.16.15 source-interface Tunnel2
(config-ip-sla-echo)#threshold 500
(config-ip-sla-echo)#frequency 5
(config)#ip sla schedule 2 life forever start-time now</pre></li><li class="step"><p>Track the IP SLA objects. The Event Manager uses this to trigger failover.</p><pre class="programlisting">(config)#track 1 ip sla 1
(config-track)#delay down 10 up 15
(config)#track 2 ip sla 2
(config-track)#delay down 10 up 15</pre></li><li class="step"><p>Configure an Event Manager applet that allows failover to the backup tunnel based on the primary tunnel's IP SLA and resumes using the primary tunnel when it's healthy again.</p><pre class="programlisting">(confg)#event manager applet Primary_Tunnel_State_Down
(config-applet)#event track 1 state down
(config-applet)#action 1 wait 3
(config-applet)#action 2 cli command “enable”
(config-applet)#action 3 cli command “config t”
(config-applet)#action 4 cli command "route-map netskope-tunnel"
(config-applet)#action 5 cli command “no set interface Tunnel1 Tunnel2”
(config-applet)#action 5 cli command “set interface Tunnel2”
(confg)#event manager applet Primary_Tunnel_State_Up
(config-applet)#event track 1 state up
(config-applet)#action 1 wait 3
(config-applet)#action 2 cli command “enable”
(config-applet)#action 3 cli command “config t”
(config-applet)#action 4 cli command "route-map netskope-tunnel"
(config-applet)#action 5 cli command “no set interface Tunnel2”
(config-applet)#action 5 cli command “set interface Tunnel1 Tunnel2”</pre><p>These two applets only apply when the primary tunnel goes up or down.  You can <a class="link" href="additional-eem-applet-examples.html" title="Additional EEM Applet Examples">define more applets</a> for when the failover tunnel state changes or if both tunnels states go down.</p></li></ol></div></div></div></div></section></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-493f2fd5-a9ab-7962-de42-ef1effb919e1" data-time-modified="September 20, 2021" data-publication-date="" id="UUID-3b27dbd1-9db3-56f8-5e31-2d29b436e819"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-3b27dbd1-9db3-56f8-5e31-2d29b436e819_body" data-parent="#UUID-3b27dbd1-9db3-56f8-5e31-2d29b436e819"><div><div class="title"><h5 class="title">Sample CLI Configuration</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-3b27dbd1-9db3-56f8-5e31-2d29b436e819_body"><p>Below is a sample CLI GRE tunnel configuration for Cisco routers:</p><pre class="programlisting">interface GigabitEthernet0/0 
 description "External network  -  VLAN180" 
 ip address 192.168.180.3 255.255.252.0
 ip nat outside
 ip virtual-reassembly in 
 duplex auto 
 speed auto
!
interface GigabitEthernet0/1
 description "Internal network  -  VLAN119"
 ip address 192.168.119.3 255.255.255.0
 ip virtual-reassembly in
 ip policy route-map gre-automation
 duplex auto
 speed auto
!
interface Tunnel1 
 description "Primary GRE Tunnel"
 ip unnumbered GigabitEthernet0/0
 ip virtual-reassembly in
 ip tcp adjust-mss 1436
 keepalive 10 3
 tunnel source GigabitEthernet0/0 
 tunnel destination 10.136.176.49
!
interface Tunnel2
 description "Backup GRE Tunnel"
 ip unnumbered GigabitEthernet0/0
 ip virtual-reassembly in
 ip tcp adjust-mss 1436
 keepalive 10 3
 tunnel source GigabitEthernet0/0 
 tunnel destination 10.136.176.61
!
ip access-list extended 2000
 10 permit tcp any any eq 443
 20 permit tcp any any eq www
!
route-map netskope permit 10
 match ip address 2000
 set interface Tunnel1 Tunnel2
</pre></div></div></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-128ba5c3-4184-2659-3501-a9cb09bae110">Netskope GRE with Cisco IOS</a></li><li><a href="#UUID-128ba5c3-4184-2659-3501-a9cb09bae110_section-idm4638369515048032624282664594">Prerequisites</a></li><li><a href="#UUID-75f61c59-b47e-7e0d-946a-efbef48676f0">Creating GRE Tunnels in Netskope</a></li><li><a href="#UUID-d9a7eca9-c21f-85bf-e33b-c54d98522985">Defining the Primary Tunnel Interface</a></li><li><a href="#UUID-6b5ab6e7-06a5-2e78-ef14-84f82bfea32a">Defining the Backup Tunnel Interface</a></li><li><a href="#UUID-9395c4ca-08d6-1d81-2e78-6449ee669f42">Configuring the ACL &amp; Route Map</a></li><li><a href="#UUID-d42f7ee5-e06f-f803-05e9-85836b9c883b">Configuring the Failover Options</a></li><li><a href="#UUID-3b27dbd1-9db3-56f8-5e31-2d29b436e819">Sample CLI Configuration</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Netskope%20GRE%20with%20Cisco%20IOS%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Netskope%20GRE%20with%20Cisco%20IOS%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="tips-and-faqs.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-gre-with-cisco-ios.html#UUID-128ba5c3-4184-2659-3501-a9cb09bae110_section-idm4638369515048032624282664594">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">December 3, 2021</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div><!--Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W56WJ8S" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!--End Google Tag Manager (noscript)--></body></html>
