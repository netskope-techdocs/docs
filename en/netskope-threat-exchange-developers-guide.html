<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Netskope Threat Exchange Developers Guide</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/jquery.paligocode.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="select-and-modify-tags.html" title="Select and Modify Tags"></link><link rel="next" href="netskope-threat-exchange-developers-guide.html#UUID-d85193ff-740d-b945-4e22-b267afaec57a" title="Netskope Threat Exchange Module"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script type="text/javascript">var containerid = 'GTM-W56WJ8S';

						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer',containerid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc collapsible-sidebar-nav current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"><a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="data-security.html">Data Security</a></li><li class="breadcrumb-link"><a href="netskope-cloud-exchange.html">Netskope Cloud Exchange</a></li><li class="breadcrumb-link"><a href="threat-exchange.html">Threat Exchange </a></li><li class="breadcrumb-node">Netskope Threat Exchange Developers Guide</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="select-and-modify-tags.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-threat-exchange-developers-guide.html#UUID-d85193ff-740d-b945-4e22-b267afaec57a">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section reused-publication reused-publication" data-origin-id="UUID-abc521af-3e0d-4430-fe7f-8a9151690a93" data-permalink="netskope-threat-exchange-developers-guide.html" data-topic-level="1" data-relative-prefix="" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-abc521af-3e0d-4430-fe7f-8a9151690a93"><div class="titlepage"><div><div class="title"><h5 class="title">Netskope Threat Exchange Developers Guide</h5></div></div></div><p>This document explains how to write a new Threat Exchange plugin and extract maximum value out of your threat ecosystem by leveraging the functionality provided within the Threat Exchange module. You should be able to write a new plugin independently without any technical issues by following this guide.</p><h6 id="idm46361832786688" class="bridgehead">Prerequisites</h6><p>To create a new plugin, you need:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Python 3.x programming experience (intermediate level).</p></li><li class="listitem"><p>Access to the Netskope Cloud Exchange platform.</p></li><li class="listitem"><p>API or Python SDK access to the product or solution for which you need to write the plugin.</p></li></ul></div><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-2879a189-bc22-4039-8c9a-ec5d32b5fd27" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-d85193ff-740d-b945-4e22-b267afaec57a"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-d85193ff-740d-b945-4e22-b267afaec57a_body" data-parent="#UUID-d85193ff-740d-b945-4e22-b267afaec57a"><div><div class="title"><h6 class="title">Netskope Threat Exchange Module</h6></div></div></a></div></div><div class="panel-body collapse" id="UUID-d85193ff-740d-b945-4e22-b267afaec57a_body"><p>The Cloud Exchange (CE) platform, and its Threat Exchange module, comes with a rich set of features and functionality that allow for a high degree of customization, so we recommend that you familiarize yourself with the different aspects of the platform as listed below.</p><h7 id="idm46361832777968" class="bridgehead">Netskope Concepts and Terminology</h7><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Core: CE core engine manages the 3rd-party plugins and their life cycle methods, plus has API endpoints for interacting with the platform to perform various tasks.</p></li><li class="listitem"><p>Module: The functional code areas that invoke modular-specific plugins to accomplish different workflows. Threat Exchange is one of the modules in Cloud Exchange.</p></li><li class="listitem"><p>Plugin: Plugins are Python packages that have logic to pull and push Threat IoC information to/from 3rd-party Threat Intel systems, which will then be stored in the Threat Exchange.</p></li><li class="listitem"><p>Plugin Configurations: Plugin configurations are the plugin class objects which are configured with the required parameters and are scheduled by the Threat Exchange core engine for pulling and pushing Threat IoC information.</p></li><li class="listitem"><p>Indicators (Threat IoCs): Indicators are malware hashes and malsite URLs objects gathered from various Threat Intel Platform and stored in the Threat Exchange database.</p></li></ul></div></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-3b28729e-6fe4-553d-dd04-0acc5d0e446e" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-e1ea2f86-5ef4-3038-b333-5bd2db8b3a9f"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-e1ea2f86-5ef4-3038-b333-5bd2db8b3a9f_body" data-parent="#UUID-e1ea2f86-5ef4-3038-b333-5bd2db8b3a9f"><div><div class="title"><h6 class="title">Development Guidelines</h6></div></div></a></div></div><div class="panel-body collapse" id="UUID-e1ea2f86-5ef4-3038-b333-5bd2db8b3a9f_body"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Use the Package Directory Structure for all Python code.</p></li><li class="listitem"><p>Make sure all the 3rd-party libraries packaged with the plugin package are checked for known vulnerabilities.</p></li><li class="listitem"><p>Make sure to follow standard Python code conventions.</p></li><li class="listitem"><p>Run and verify that the <span class="emphasis"><em>flake8</em></span> lint check passes with docstring check enabled.</p></li><li class="listitem"><p>For Scripts/Integrations written in Python, make sure to create unit tests as documented here.</p></li><li class="listitem"><p>Plugin architecture allows storing states; however, avoid storing huge objects for state management.</p></li><li class="listitem"><p>Check your python code for any vulnerabilities.</p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The plugin icon has to be under 10kb. Make sure to use the company logo(and not the product’s) with a transparent background . Recommended size for logo is 300 x 50 or similar aspect ratio.</p></li><li class="listitem"><p>Use the checkpoint provided by the Threat Exchange core rather than implementing one on your own.</p></li><li class="listitem"><p>Follow the <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20" title="Plugin Directory Structure"><span class="xreftitle">Plugin Directory Structure</span></a>.</p></li><li class="listitem"><p>Make sure to map the various fields received from API calls with the Indicator data model to leverage the full benefit of the system. Fields like reputation, first-seen, and comments so that the data in the indicator fields makes more sense to the SOC user when analyzing the data. Make sure to map the comment field which gives more context to the SOC analyst. The comment field could include file name (in case of Hash).</p></li><li class="listitem"><p>Convert the time-stamp values to the human-readable format (from epoch to DateTime object).</p></li><li class="listitem"><p>Use proper validation for the parameters passed to the validate method and provide the proper help text for all the parameters.</p></li><li class="listitem"><p>Use notifier object to raise the notification for failures or critical situations (like rate-limiting, exceeding payload size) to notify the status of the plugin to the user.</p></li><li class="listitem"><p>Make sure to implement a proper logging mechanism with the logger object passed by the Threat Exchange platform. Make sure enough logging is done which helps the Ops team in troubleshooting. Make sure any sensitive data is not logged or leaked in the notification.</p></li><li class="listitem"><p>Have a meaningful name and proper type of plugin configuration parameters. Proxy configuration dict and SSL certificate validation flag is passed by the Threat Exchange platform.</p></li></ul></div></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-57e2bbbc-230e-22d6-8dad-9b5c75a6a72d" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-eee42748-19e1-6ee3-b612-6a356a0e0cb0"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-eee42748-19e1-6ee3-b612-6a356a0e0cb0_body" data-parent="#UUID-eee42748-19e1-6ee3-b612-6a356a0e0cb0"><div><div class="title"><h6 class="title">Writing a Plugin</h6></div></div></a></div></div><div class="panel-body collapse" id="UUID-eee42748-19e1-6ee3-b612-6a356a0e0cb0_body"><p>This section explains the process of writing a plugin from scratch.</p><p>Download the sample plugin from the <a class="link" href="https://github.com/netskopeoss/ta_cloud_exchange" target="_blank" rel="noopener">NetskopeOSS public Github repository.</a></p><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46361832755840"><div class="titlepage"><div><div class="title"><h6 class="title">Development Setup</h6></div></div></div><h8 id="idm46361832755152" class="bridgehead">Python</h8><p>Threat Exchange utilizes Python3 (v3.7 and above). Make sure to set up python3 in your development environment. Pytest is used to run unit tests.</p><h8 id="idm46361832754480" class="bridgehead">Included Python Libraries</h8><p>Following Python libraries are included within the Netskope Threat Exchange platform.</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Library Name</p></th><th class="th leftcol" data-priority="1"><p>Version</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>aiofiles</p></td><td class="td leftcol"><p>0.4.0</p></td></tr><tr><td class="td leftcol"><p>amqp</p></td><td class="td leftcol"><p>2.5.2</p></td></tr><tr><td class="td leftcol"><p>attrs</p></td><td class="td leftcol"><p>19.3.0</p></td></tr><tr><td class="td leftcol"><p>bcrypt</p></td><td class="td leftcol"><p>3.1.7</p></td></tr><tr><td class="td leftcol"><p>billiard</p></td><td class="td leftcol"><p>3.6.1.0</p></td></tr><tr><td class="td leftcol"><p>celery</p></td><td class="td leftcol"><p>4.3.0</p></td></tr><tr><td class="td leftcol"><p>celerybeat-mongo</p></td><td class="td leftcol"><p>0.1.0</p></td></tr><tr><td class="td leftcol"><p>certifi</p></td><td class="td leftcol"><p>2019.11.28</p></td></tr><tr><td class="td leftcol"><p>cffi</p></td><td class="td leftcol"><p>1.13.2</p></td></tr><tr><td class="td leftcol"><p>chardet</p></td><td class="td leftcol"><p>3.0.4</p></td></tr><tr><td class="td leftcol"><p>fastapi</p></td><td class="td leftcol"><p>0.44.0</p></td></tr><tr><td class="td leftcol"><p>idna</p></td><td class="td leftcol"><p>2.8</p></td></tr><tr><td class="td leftcol"><p>importlib-metadata</p></td><td class="td leftcol"><p>1.1.0</p></td></tr><tr><td class="td leftcol"><p>jsonschema</p></td><td class="td leftcol"><p>3.2.0</p></td></tr><tr><td class="td leftcol"><p>kombu</p></td><td class="td leftcol"><p>4.6.6</p></td></tr><tr><td class="td leftcol"><p>mongoengine</p></td><td class="td leftcol"><p>0.18.2</p></td></tr><tr><td class="td leftcol"><p>more-itertools</p></td><td class="td leftcol"><p>8.0.0</p></td></tr><tr><td class="td leftcol"><p>passlib</p></td><td class="td leftcol"><p>1.7.2</p></td></tr><tr><td class="td leftcol"><p>pycparser</p></td><td class="td leftcol"><p>2.19</p></td></tr><tr><td class="td leftcol"><p>pydantic</p></td><td class="td leftcol"><p>1.2</p></td></tr><tr><td class="td leftcol"><p>PyJWT</p></td><td class="td leftcol"><p>1.7.1</p></td></tr><tr><td class="td leftcol"><p>pymongo</p></td><td class="td leftcol"><p>3.9.0</p></td></tr><tr><td class="td leftcol"><p>pyrsistent</p></td><td class="td leftcol"><p>0.15.6</p></td></tr><tr><td class="td leftcol"><p>python-multipart</p></td><td class="td leftcol"><p>0.0.5</p></td></tr><tr><td class="td leftcol"><p>pytz</p></td><td class="td leftcol"><p>2019.3</p></td></tr><tr><td class="td leftcol"><p>requests</p></td><td class="td leftcol"><p>2.22.0</p></td></tr><tr><td class="td leftcol"><p>six</p></td><td class="td leftcol"><p>1.13.0</p></td></tr><tr><td class="td leftcol"><p>starlette</p></td><td class="td leftcol"><p>0.12.9</p></td></tr><tr><td class="td leftcol"><p>urllib3</p></td><td class="td leftcol"><p>1.25.7</p></td></tr><tr><td class="td leftcol"><p>vine</p></td><td class="td leftcol"><p>1.3.0</p></td></tr><tr><td class="td leftcol"><p>zipp</p></td><td class="td leftcol"><p>0.6.0</p></td></tr><tr><td class="td leftcol"><p>requests-mock</p></td><td class="td leftcol"><p>1.7.0</p></td></tr></tbody></table></div><h8 id="idm46361832750912" class="bridgehead">Including Custom Plugin Libraries</h8><p>Netskope advises bundling any of the third party python libraries your plugin will need with the plugin package itself. To achieve this bundling use the pip installer; it provides a switch which takes a directory as an input. If it is provided, pip will install the packages into that directory.</p><p>For example, the command shown below will install the <span class="emphasis"><em>cowsay</em></span> package into the directory <span class="emphasis"><em>packages</em></span>.</p><pre class="programlisting">&gt; pip install cowsay --target ./packages</pre><p>For the official documentation on this, refer <a class="link" href="https://pip.pypa.io/en/stable/reference/pip_install/#cmdoption-t" target="_blank" rel="noopener">https://pip.pypa.io/en/stable/reference/pip_install/#cmdoption-t</a>.</p><h8 id="idm46361833116608" class="bridgehead">IDE</h8><p>Recommended IDEs are PyCharm or Visual Studio Code.</p></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-d1c5bc42-a41c-c897-bd73-7ca919fe70ae" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-d41b6f67-385b-2537-9867-e4cf56d75a20"><div class="titlepage"><div><div class="title"><h6 class="title">Plugin Directory Structure</h6></div></div></div><p>This section describes the typical directory structure for the Threat Exchange plugin.</p><pre class="programlisting">/sample_plugin/
  ├── __init__.py
  ├── icon.png
  ├── main.py
  └── manifest.json</pre><h8 id="idm46361832711264" class="bridgehead">Sample Plugin Contents</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>README.md: README file contains the documentation for the Plugin integration use-case.</p></li><li class="listitem"><p>__init__.py: Every plugin package is considered a python module by the Threat Exchange code. Make sure every plugin package contains the empty “__init__.py” file.</p></li><li class="listitem"><p>icon.png: Plugin icon logo, this will be visible in the plugin chiclet and configuration cards on the UI. The logo should have a transparent background with recommended size of 300*50 pixels or a similar aspect ratio.</p></li><li class="listitem"><p>main.py: This python file contains the Plugin class containing the concrete implementation for the pull, push and validate method.</p></li><li class="listitem"><p>manifest.json: Manifest file for the plugin package containing information about all the configurable parameters and their data types. This file has more information about the plugin integration as well.</p></li></ul></div><p>The listed files here are mandatory for any plugin integration, but you can add other files based on specific integration requirements.</p><p><span class="strong strong"><strong>Note:</strong></span> Make sure the plugin directory name (e.g sample_plugin) matches with the manifest.json’s id field.</p><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643393353294"><div class="titlepage"><div><div class="title"><h6 class="title">Manifest.json</h6></div></div></div><p>This is a JSON file that stores the meta-information related to the plugin, which is then read by the Threat Exchange module to render the plugin in the UI as well as enabling the Threat Exchange module to know more about the plugin, including required configuration parameters, the plugin-id, the plugin-name, etc.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Every plugin must contain this file with the required information so that Threat Exchange can instantiate the Plugin object properly.</p></li><li class="listitem"><p>Common parameters for manifest.json include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>name: (string) Name of the plugin. (Required)</p></li><li class="listitem"><p>id: (string) Id of the plugin package. Make sure it is unique across all the plugin installed in the Cloud Exchange. The ID has to match the directory name of the plugin package. (Required)</p></li><li class="listitem"><p>version: (string) Version of the plugin. Usage of a MAJOR.MINOR.PATCH (ex. 1.0.1) versioning scheme is encouraged although there are no restrictions. (Required)</p></li><li class="listitem"><p>description: (string) Description of the plugin. Provide a detailed description which mentions the capabilities and instructions to use the plugin, (ex. This plugin works with product foo and extracts both md5 and sha256 hashes as well as malURL to Threat Exchange and pushes the same to product foo.) This description would appear on the Plugin Configuration card. (Required)</p></li><li class="listitem"><p>push_supported: (boolean) This flag indicates whether the plugin supports the push method or not. If it is set to false then sharing related fields will not be displayed in the UI. (optional, defaults to true)</p></li><li class="listitem"><p>patch_supported: (boolean) This flag indicates whether the integrated product supports incrementally reporting indicators. Certain products (e.g. Netskope features using RESTAPIv1) expect that all the indicators have to be reported each time. In such cases “patch_supported” is required to be set as ‘False’. Alternatively, ServiceNow allows sharing indicators one at a time and retains the previously shared indicators. In its a case, patch_supported was required to be set as ‘True’. (Required)</p></li><li class="listitem"><p>configuration: (array) Array of JSON objects that contains information about all the parameters required by the plugin - their name, type, id, etc. The common parameters for the nested JSON objects are explained below.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>label: Name of the parameter. This will be displayed on the plugin configuration page. (Required)</p></li><li class="listitem"><p>key: Unique parameter key, which will be used as a key in the python dict object where the plugin configuration is used. (Required)</p></li><li class="listitem"><p>type: Value type of the parameter. Allowed values are 'text', 'password', 'number' and 'choice'. (Required) Refer to Plugin Configuration parameter types below for more details.</p></li><li class="listitem"><p>default: The default value for this parameter. This value will appear in the plugin configuration page on Threat Exchange UI. Supported data-types are "text", "number", and “list” (for multichoice type). (Required)</p></li><li class="listitem"><p>mandatory: Boolean which indicates whether this parameter is mandatory or not. If a parameter is mandatory Threat Exchange UI won't let you pass an empty value for the parameter. Allowed values are `true` and `false`. (Required)</p></li><li class="listitem"><p>description: Help text level description for the parameter which can give more details about the parameter and expected value. This string will appear in the plugin configuration page as a help-text. (Required)</p></li><li class="listitem"><p>choices: A list of JSON objects containing key and value as JSON keys. This parameter is only supported by <span class="emphasis"><em><span class="emphasis"><em>'type': 'choice`</em></span></em></span>.</p></li></ul></div></li></ul></div></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46361832706496"><div class="titlepage"><div><div class="title"><h6 class="title">Plugin Configuration Parameter types</h6></div></div></div><p>Make sure all the required plugin configuration parameters are listed under the configuration section of manifest.json for the plugin.</p><h8 id="UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_bridgehead-idm4543162154784032866747984694" class="bridgehead">Password Parameter</h8><p>Use this parameter for storing any secrets/passwords for authentication with API endpoints. Parameters with type as the password will have a password text box in the Plugin configuration page and will be obfuscated and encrypted by the platform.</p><p>Sample JSON</p><pre class="programlisting">"configuration": [
    {
        "label": "Api token",
        "key": "api_token",
        "type": "password"
    },
]</pre><p>Plugin configuration view:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-2ceb4ebf-c0da-3644-4ef7-847d3eaca653.png" style="max-width: 450px; " alt="image1.png" title="image1.png"></img></td></tr></table></div><h8 id="idm46361832689504" class="bridgehead">Text Parameter</h8><p>Use this parameter for storing any string information such as base-url, username, etc. This parameter will have a normal text input on the plugin configuration page.</p><p>Sample JSON</p><pre class="programlisting">"configuration": [
    {
        "label": "User Name",
        "key": "user_name",
        "type": "text"
    },
]</pre><p>Plugin configuration view:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:450px;
                            "><tr><td style="padding:0;"><img src="image/uuid-6a6e868d-1715-e1a0-c3b5-5109ed144095.png" style="max-width: 450px; " alt="image2.png" title="image2.png"></img></td></tr></table></div><h8 id="idm46361832685104" class="bridgehead">Number Parameter</h8><p>Use this parameter for storing number/float values. This parameter will have a number input field on the plugin configuration page.</p><p>Sample JSON</p><pre class="programlisting">"configuration": [
    {
        "label": "Maximum IOC count",
        "key": "max_ioc_count",
        "type": "number"
    },
]
</pre><p>Plugin configuration view:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-6938e5d3-27a0-b271-3bae-c19a98c6fd53.png" style="max-width: 585px; " alt="image3.png" title="image3.png"></img></td></tr></table></div><h8 id="idm46361832680608" class="bridgehead">Choice Parameter</h8><p>Use this parameter for storing any enumeration parameter values. This parameter will have a dropdown on the plugin configuration page.</p><p>Sample JSON</p><pre class="programlisting">"configuration": [
    {
        "label": "Select Type of IOC to pull",
        "key": "ioc_type",
        "type": "choice",
        "choices": [
            {
                "key": "Malware",
                "value": "malware"
            },
            {
                "key": "Malsite",
                "value": "malsite"
            }
        ]
    },
]</pre><p>Plugin configuration view:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-5f70f1e2-18b0-e311-619f-34591bfb2157.png" style="max-width: 585px; " alt="image4.png" title="image4.png"></img></td></tr></table></div><p>After selecting the input.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-e800a64f-7131-3bb7-51d4-14f0659f0a1d.png" style="max-width: 585px; " alt="image5.png" title="image5.png"></img></td></tr></table></div><h8 id="idm46361832673472" class="bridgehead">Multichoice Parameter</h8><p>Use this parameter for storing multiple choice values. This parameter will have a dropdown on the plugin configuration page with ability to select multiple values.</p><p>Sample JSON</p><pre class="programlisting">"configuration": [
    {
        "label": "Severity",
        "key": "severity",
        "type": "multichoice",
        "choices": [
            {
                "key": "Unknown",
                "value": "unknown"
            },
            {
                "key": "Low",
                "value": "low"
            },
            {
                "key": "Medium",
                "value": "medium"
            },
            {
                "key": "High",
                "value": "high"
            },
            {
                "key": "Critical",
                "value": "critical"
            }
        ],
        "default": [
            "critical",
            "high",
            "medium",
            "low",
            "unknown"
        ],
        "mandatory": false,
        "description": "Only indicators with matching severity will be saved."
    }
]</pre><p>Plugin Configuration View:</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-ef21e115-2a6a-20ca-cd8b-4c9deddc5a1a.png" style="max-width: 585px; " alt="image6.png" title="image6.png"></img></td></tr></table></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46361832695168"><div class="titlepage"><div><div class="title"><h6 class="title">main.py</h6></div></div></div><p>This python file contains the core implementation of the plugin.</p><h8 id="idm46361832669008" class="bridgehead">Standard Imports</h8><pre class="programlisting">from netskope.integrations.cte.plugin_base import PluginBase, ValidationResult, PushResult
from netskope.integrations.cte.models import Indicator, IndicatorType
from netskope.integrations.cte.models.business_rule import Action, ActionWithoutParams</pre><h8 id="idm46361832667760" class="bridgehead">PluginBase Variables</h8><p>PluginBase provides access to variables which can be used during the plugin lifecycle</p><p>Methods. Below is the list of variables.</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Variable Name</p></th><th class="th leftcol" data-priority="1"><p>Usage</p></th><th class="th leftcol" data-priority="1"><p>Description</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>self.logger</p></td><td class="td leftcol"><p>self.logger.error(“Message”)</p><p>self.logger.warn(“Message”)</p><p>self.logger.info(“Message”)</p></td><td class="td leftcol"><p>Logger handle provided by core. Use this object to log important events. The logs would be visible in Threat Exchange Audit logs. Refer the <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-0d317a39-ccb9-2ed9-0885-8aa68b8ca57d" title="Logging"><span class="xreftitle">Logging</span></a> documentation.</p></td></tr><tr><td class="td leftcol"><p>self.configuration</p></td><td class="td leftcol"><p>self.configuration.get(&lt;attribute-key-name&gt;)</p></td><td class="td leftcol"><p>JSON representation of the configuration object of Plugin instance. Use this to access the configuration attributes like authentication credentials, server details, etc. Use the key name of the attribute mentioned in manifest.json.</p></td></tr><tr><td class="td leftcol"><p>self.last_run_at</p></td><td class="td leftcol"><p>If self.last_run_at:</p><p>self.last_run_at.timestamp()</p><p>Use this format to convert the last run time in epoch format.</p></td><td class="td leftcol"><p>Provides the timestamp of last successful run time of the Plugin’s pull method. Threat Exchange core maintains the checkpoint time after each successful pull() execution. For the first execution, the value would be None. The datatype of the object is datetime.</p></td></tr><tr><td class="td leftcol"><p>self.storage</p></td><td class="td leftcol"></td><td class="td leftcol"><p>Threat Exchange provides the plugin a mechanism to maintain state. Use this object to persist any state that would be required during subsequent calls. The datatype of this object is python dict.</p></td></tr><tr><td class="td leftcol"><p>self.notifier</p></td><td class="td leftcol"><p>self.notifier.info(“message”)</p><p>self.notifier.warn(“message”)</p><p>self.notifier.error(“message”)</p></td><td class="td leftcol"><p>This object provides handle of Threat Exchange core’s notifier. Use this object to push any notification to the platform. The notifications would be visible on Threat Exchange UI. Make sure the message contains summarized information for user to read and take necessary actions.</p><p>For example, a used notifier in Netskope plugin if the push() method exceeds 8MB limit of the product.</p></td></tr><tr><td class="td leftcol"><p>self.proxy</p></td><td class="td leftcol"><p>requests.get(url=url, proxies=self.proxy)</p></td><td class="td leftcol"><p>Handle of system’s proxy settings if configured, else {}.</p></td></tr><tr><td class="td leftcol"><p>self.ssl_validation</p></td><td class="td leftcol"><p>requests.get(url=url, verify=self.ssl_validation)</p></td><td class="td leftcol"><p>Boolean value which mentions if ssl validation be enforced for REST API calls.</p></td></tr></tbody></table></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46361832669648"><div class="titlepage"><div><div class="title"><h6 class="title">Plugin Class</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Plugin class has to be inherited from the PluginBase class. PluginBase class is defined in <span class="emphasis"><em><span class="emphasis"><em>netskope.integrations.cte.plugin_base</em></span></em></span>.</p></li><li class="listitem"><p>Make sure Plugin class provides implementation for the pull, push and validate method.</p></li><li class="listitem"><p>Plugin class will contain all the necessary params to establish connection and authentication with the 3rd-party API.</p></li></ul></div><pre class="programlisting">"""Sample plugin implementation.

This is a sample implementation of base PluginBase class. Which explains the concrete implemetation
of the base class.
"""

from netskope.integrations.cte.plugin_base import PluginBase, ValidationResult, PushResult
from netskope.integrations.cte.models import Indicator, IndicatorType
from typing import List
from datetime import datetime
import requests


class SamplePlugin(PluginBase):
   """SamplePlugin class having concrete implementation for pulling and pushing threat information.

   This class is responsible for implementing pull, push and validate methods with proper return types,
   so that it's lifecycle execution can be scheduled by the CTE core engine.
   """
</pre><h8 id="idm46361832645520" class="bridgehead">Def Pull()</h8><p>This is an abstract method of PluginBase Class.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method implements the logic to pull the Threat IOCs (Malware &amp; Malsites) from the API endpoints. This method is invoked periodically.</p></li><li class="listitem"><p>Make sure its unit-testable.</p></li><li class="listitem"><p>Use the checkpoint passed by Threat Exchange platform by invoking <span class="emphasis"><em><span class="emphasis"><em>self.last_run_at</em></span></em></span> It returns the datetime.datetime Python object containing timestamp when this method was last executed successfully.</p></li><li class="listitem"><p>Use the proxy configuration passed by the Threat Exchange platform by invoking <span class="emphasis"><em><span class="emphasis"><em>self.proxy</em></span></em></span>. It returns the python dict object which can be used directly with requests module.</p></li><li class="listitem"><p>All the configuration parameters for API authentication are passed as python dict receives them by invoking <span class="emphasis"><em><span class="emphasis"><em>self.configuration.</em></span></em></span></p></li><li class="listitem"><p>All the logs be logged by the <span class="emphasis"><em><span class="emphasis"><em>self.logger</em></span></em></span> object with proper log level (info, warn, error). This object logs the logs to MongoDB and can be accessed via API calls.</p></li><li class="listitem"><p>Use <span class="emphasis"><em><span class="emphasis"><em>self.ssl_validation</em></span></em></span> bool to enable/disable validation of the SSL server certificate.</p></li><li class="listitem"><p>Return the list of Indicator objects (Refer to <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643392971963" title="Indicator Data Model"><span class="xreftitle">Indicator Data Model</span></a>) which contain the data received from the API endpoint.</p></li><li class="listitem"><p>In the case of failure raise an error or exception of appropriate type with proper message.</p></li></ul></div><pre class="programlisting">def pull(self):
"""Pull the Threat information from the 3rd part Threat Intel systems.

Implement the logic of pulling Threat data from 3rd party apis and return the list of objects netskope.integrations.cte.models.Indicators on successful pull otherwise raises an exception.

Returns:
    List[netskope.integrations.cte.models.Indicators]: List of indicator objects received from the   3rd party Threat Intel Systems.
"""
# Load all the configured plugin parameters as python dict object.
# Use the key name provided in the manifest.json file for the configuration parameters to
# get the value of that particular parameter.
config = self.configuration
# get proxy settings dict, just the way requests module requires.
proxy_dict = self.proxy
# get the ssl_validation bool for enabling/disabling validation of SSL server certificates.
ssl_validation = self.ssl_validation
start_time = self.last_run_at  # datetime.datetime object.
# How to use proxy dict and ssl_validation flag.
resp = requests.get("www.example.com", proxies=proxy_dict, verify=ssl_validation)  # noqa: F841
# Get the logger object for logging purpose. This logger object logs all the logs to mongodb
# under the cte database logs collection. Log timestamp is automatically recorded by the logger library.
# Supported logging levels are info, warn and error.
logger = self.logger
logger.info("Sample Plugin: Starting Pulling data for sample plugin.")
indicator_list = self.pull_data_from_3rd_party_api(config, logger)
logger.info("Sample Plugin: Finished pulling data")
return indicator_list
</pre><h8 id="idm46361832649488" class="bridgehead">Def Push()</h8><p>This is an abstract method of PluginBase Class.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method implements the logic to push the Threat IOC information shared by the Threat Exchange platform to the product API endpoints.</p></li><li class="listitem"><p>It receives all the parameters that the Pull method receives in addition to that it receives the List of Indicator objects from the Threat Exchange platform as method argument which are to be shared with the integrating product.</p></li><li class="listitem"><p>This method will be invoked when the Threat Exchange platform receives a new indicator from a source and sharing of indicators is configured with the current plugin configuration.</p></li><li class="listitem"><p>If the API supports the PATCH method to share the indicators then this method will receive only one indicator object in the list otherwise it will receive all the indicator objects which are returned after applying the sharing filters on all the indicators in the Threat Exchange platform database.</p></li><li class="listitem"><p>Make sure to handle the case when the maximum payload size supported by API endpoint is exceeded. There can be multiple ways to handle this case.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>If the API endpoint supports multiple requests with a fixed payload size, send the data in chunks.</p></li><li class="listitem"><p>If the API endpoint does not support multiple requests (i.e. we can push it in one API call only) either plugin can skip the remaining indicators and raise a notification to the user to adjust the sharing filters or it can fail with the error of exceeded payload size.</p></li></ul></div></li><li class="listitem"><p>Return the PushResult object (Refer to <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643341113668" title="PushResult Class"><span class="xreftitle">PushResult Class</span></a> with a success flag indicating whether the Push operation was successful or not.</p></li><li class="listitem"><p>Handle all the Exceptions with connection and HTTP response code.</p></li></ul></div><pre class="programlisting">def push(self, indicators: List[Indicator]):
    """Push the Indicator list to the 3rd party Threat Intel systems.

    Implement the logic of spliting the indicators list according to their type and push the data
    to the 3rd party APIs. This method will be invoked while sharing the Threat information with 3rd party.
    Args:
        indicators (List[netskope.integrations.cte.models.Indicators]): List of Indicator objects to be pushed.
    Returns:
        netskope.integrations.cte.plugin_base.PushResult: PushResult object with success flag and Push result message.
    """
    # Load all the configured plugin parameters as python dict object.
    # Use the key name provided in the manifest.json file for the configuration parameters to
    # get the value of that particular parameter.
    config = self.configuration
    # get proxy settings dict, just the way requests module requires.
    proxy_dict = self.proxy
    # get the ssl_validation bool for enabling/disabling validation of SSL server certificates.
    ssl_validation = self.ssl_validation
    # How to use proxy dict and ssl_validation flag.
    resp = requests.get("www.example.com", proxies=proxy_dict, verify=ssl_validation)   # noqa: F841
    # Get the logger object for logging purpose. This logger object logs all the logs to mongodb
    # under the cte database logs collection. Log timestamp is automatically recorded by the logger library.
    # Supported logging levels are info, warn and error.
    logger = self.logger
    logger.info("Sample Plugin: Starting Pushing data for sample plugin.")
    push_result = self.push_data_to_3rd_party_api(config, logger, indicators)
    logger.info("Sample Plugin: Finished Pushing data for sample plugin.")
    return push_result
</pre><h8 id="idm46361832626320" class="bridgehead">Def Validate()</h8><p>This is an abstract method of PluginBase Class.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method validates the plugin configuration and authentication parameters passed while creating a plugin configuration.</p></li><li class="listitem"><p>This method will be called only when a new configuration is created or updated.</p></li><li class="listitem"><p>Validate against all the mandatory parameters are passed with the proper datatype.</p></li><li class="listitem"><p>Validate the authentication parameters and the API endpoint to ensure the smooth execution of the plugin lifecycle.</p></li><li class="listitem"><p>Return the object of ValidationResult (Refer to <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643341232881" title="ValidationResult Class"><span class="xreftitle">ValidationResult Class</span></a>) with a success flag indicating validation success or failure and the validation message containing validation failure reason.</p></li></ul></div><pre class="programlisting">def validate(self, data):      
     """Validate the Plugin configuration parameters.

  Validation for all the parameters mentioned in the manifest.json for the existence and
  data type. Method returns the netskope.integrations.cte.plugin_base.ValidationResult object with success = True in the case
  of successful validation and success = False and a error message in the case of failure.
  Args:
      data (dict): Dict object having all the Plugin configuration parameters.
  Returns:
      netskope.integrations.cte.plugin_base.ValidateResult: ValidateResult object with success flag and message.
  """
  self.logger.info("Sample Plugin: Executing validate method for Sample plugin")
  if (
      "secret_field_id1" not in data
      or not data["secret_field_id1"]
      or type(data["secret_field_id1"]) != str
  ):
      self.logger.error(
          "Sample Plugin: Validation error occurred Error: Secret Field1 is required with type string."
      )
      return ValidationResult(
          success=False, message="Invalid Secret Field 1 provided.",
      )
else:
return ValidationResult(
        success=True, message="Validation Successful for Sample plugin"
   )
</pre><h8 id="idm46361832620288" class="bridgehead">Def get_actions()</h8><p>This is an abstract method of PluginBase Class.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method should return a list of all the supported actions (displayed as <span class="emphasis"><em>Targets</em></span> in the UI) if the plugin supports sharing of indicators (i.e. manifest has push_supported=true) otherwise it should return an empty list.</p></li><li class="listitem"><p>Add all the supported actions in the ActionWithoutParams class and return a list of objects of ActionWithoutParams class.</p></li><li class="listitem"><p>If the plugin supports sharing of indicators then this method should return at least one action.</p></li></ul></div><p>If manifest has push_supported=false:</p><pre class="programlisting">def get_actions(self):
"""Get available actions.
Returns:
 List[ActionWithoutParams]: List of ActionWithoutParams objects that are supported by the plugin.
"""
 return []</pre><p>If manifest has push_supported=true:</p><pre class="programlisting">def get_actions(self): 
"""Get available actions.
Returns:
	List[ActionWithoutParams]: List of ActionWithoutParams objects that are supported by the plugin.
"""
	return [
		ActionWithoutParams(label=”Share Indicators”, value=”share”)
		ActionWithoutParams(label=”Add to Group”, value=”add”)
	]</pre><h8 id="idm46361832615104" class="bridgehead">Def get_action_fields():</h8><p>This is an abstract method of PluginBase Class.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method should return the list of fields to be rendered in the UI when a target is selected from dropdown.</p></li><li class="listitem"><p>This method should be called after the user selects any of the actions.</p></li><li class="listitem"><p>If the selected action requires any parameters then return a list of dictionaries (where each dictionary is a configurable input) otherwise return an empty list.</p></li><li class="listitem"><p>Go to <a class="link" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643393353294" title="Manifest.json">Manifest.json</a> to see how fields are defined.</p></li></ul></div><p>If manifest has push_supported=false:</p><pre class="programlisting">def get_action_fields(self, action: Action):
"""Get fields required for an action.

Args: 
 action (Action): Action object which is selected as Target.
Return:
 List[Dict]: List of configurable fields based on selected action.
"""
 return []</pre><p>If manifest has push_supported=true:</p><pre class="programlisting">def get_action_fields(self, action: Action):
"""Get fields required for an action.

Args: 
 action (Action): Action object which is selected as Target.
Return:
 List[Dict]: List of configurable fields based on selected action.
"""
 if action.value == “add”:
         return [
     {
       “label”: “Group Name”,
       “key”: “group_name”,
       “type”: “text”,
       “default”: “”,
       “mandatory”: True,
       “description”: “Name of group.”
     }
 ]
else:
 return []
</pre><h8 id="idm46361832608992" class="bridgehead">Def validate_action():</h8><p>This is an abstract method of PluginBase Class.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This method validates the action and their parameters.</p></li><li class="listitem"><p>This method will be called only when the new sharing configuration is created or existing sharing configuration is updated.</p></li><li class="listitem"><p>Validate against all the mandatory parameters are passed with the proper datatype.</p></li><li class="listitem"><p>Return the object of ValidationResult (Refer to <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643341232881" title="ValidationResult Class"><span class="xreftitle">ValidationResult Class</span></a>) with a success flag indicating validation success or failure and the validation message containing validation failure reason.</p></li><li class="listitem"><p>If the plugin is not push supported then return ValidationResult object with a success flag otherwise check for validations.</p></li></ul></div><p>If manifest has push_supported=false:</p><pre class="programlisting">def validate_action(self, action: Action):
"""Validate Action Parameters.

Args: 
	action (Action): Action object having all the configurable parameters.
Return:
	netskope.integrations.cte.plugin_base.ValidateResult: ValidateResult object with success flag and message.
"""
	return ValidationResult(success=True, message=”Validation successful.”)
</pre><p>If manifest has push_supported=true:</p><pre class="programlisting">def validate_action(self, action: Action):
"""Validate Action Parameters.

Args: 
	action (Action): Action object having all the configurable parameters.
Return:
	netskope.integrations.cte.plugin_base.ValidateResult: ValidateResult object with success flag and message.
"""
	if action.value not in [“share”, “add”]:
		return ValidationResult(
 		success=False, message=”Unsupported action provided.”
       )
if action.value == “add”:
	if action.parameters.get(“group_name”) is None:
		return ValidationResult(
 			success=False, message=”Group Name should not be empty.”
       	)
return ValidationResult(
 	success=True, message=”Validation successful.”
 )
</pre></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46361832649248"><div class="titlepage"><div><div class="title"><h6 class="title">Data Models</h6></div></div></div><p>This section lists down the Data Models and their properties.</p><h8 id="UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643392971963" class="bridgehead">Indicator Data Model</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This class provides the Python data model for an Indicator object.</p></li><li class="listitem"><p>Pull method returns the list of objects of Indicator class with the information received from API calls.</p></li><li class="listitem"><p>Supported values for type field is <span class="emphasis"><em><span class="emphasis"><em>IndicatorType.MD5, IndicatorType.SHA256 and IndicatorType.URL.</em></span></em></span> MD5 and SHA256 types are used to represent malware indicators and URL type is used to represent malsite indicators.</p></li><li class="listitem"><p>The value of the reputation field has to be in the range of 1-10. The default value of the reputation fields is 5, if not supplied. If it is supplied (within that range) Threat Exchange will accept and display it.</p></li></ul></div><p>Data Model Properties</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Name</p></th><th class="th leftcol" data-priority="1"><p>Type</p></th><th class="th leftcol" data-priority="1"><p>Description</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>value</p></td><td class="td leftcol"><p>string</p></td><td class="td leftcol"><p>Indicator value. It can be MD5/SHA256 hash value in the case of Malware indicators, and domain-name/url in case of Malsite indicators.</p></td></tr><tr><td class="td leftcol"><p>type</p></td><td class="td leftcol"><p>Enum (IndicatorType)</p></td><td class="td leftcol"><p>It can be IndicatorType.MD5 or IndicatorType.SHA256 in the case of Malware indicators, IndicatorType.URL in case of Malsite indicators.</p></td></tr><tr><td class="td leftcol"><p>test</p></td><td class="td leftcol"><p>bool</p></td><td class="td leftcol"><p>Indicates whether it's a test indicator or not.</p><p>Default - False</p></td></tr><tr><td class="td leftcol"><p>reputation</p></td><td class="td leftcol"><p>int</p></td><td class="td leftcol"><p>Reputation score of indicator.</p><p>Default - 5</p></td></tr><tr><td class="td leftcol"><p>expiresAt</p></td><td class="td leftcol"><p>datetime.datetime</p></td><td class="td leftcol"><p>Time after which Indicator will be marked as inactive by the Threat Exchange.</p></td></tr><tr><td class="td leftcol"><p>firstSeen</p></td><td class="td leftcol"><p>datetime.datetime</p></td><td class="td leftcol"><p>datetime.datetime object indicating when the indicator was discovered for the first time.</p><p>Default - Current System time when Indicator object was created.</p></td></tr><tr><td class="td leftcol"><p>lastSeen</p></td><td class="td leftcol"><p>datetime.datetime</p></td><td class="td leftcol"><p>datetime.datetime object indicating when the indicator was discovered for last time.</p><p>Default - Current System time when Indicator object was created.</p></td></tr><tr><td class="td leftcol"><p>comments</p></td><td class="td leftcol"><p>string</p></td><td class="td leftcol"><p>Comment string which gives more information about the indicator.</p></td></tr><tr><td class="td leftcol"><p>severity</p></td><td class="td leftcol"><p>Enum (SeverityType)</p></td><td class="td leftcol"><p>Severity of the indicator. Possible values are:</p><p>SeverityType.LOW</p><p>SeverityType.MEDIUM</p><p>SeverityType.HIGH</p><p>SeverityType.CRITICAL</p><p>SeverityType.UNKNOWN</p></td></tr><tr><td class="td leftcol"><p>extendedInformation</p></td><td class="td leftcol"><p>string</p></td><td class="td leftcol"><p>A link leading to an external source for extended information regarding the indicator. The value in this field will be rendered as a clickable URL in the UI. URL scheme must be either HTTP or HTTPS.</p></td></tr></tbody></table></div><pre class="programlisting">from netskope.integrations.cte.models import Indicator, IndicatorType  
Indicator(
      value="md5hash",         # md5 hash value of the indicator.
      type=IndicatorType.MD5,  # Type of indicator.
      test=True,               # Indicates whether it's test indicator or not. Defaults to False.
      reputation=7,            # Reputation score of Indicator. Defaults to 5.
      # Time after which Indicator will be marked as inactive.
      expiresAt=datetime.datetime(2022, 12, 23, 15, 22, 52, 667126),
      # Time when the Indicator was discovered first time. Defaults to current time.
      firstSeen=datetime.datetime(2017, 1, 11, 15, 22, 52, 667126),
      # Time when the Indicator was discovered last time. Defaults to current time.
      lastSeen=datetime.datetime(2019, 12, 23, 15, 22, 52, 667126),
      # Comment which gives more information about the indicator.
      comments="Indicator explanation",
  ),</pre><h8 id="UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643341113668" class="bridgehead">PushResult Class</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This class contains the result of Push operation of indicators to the product API endpoint.</p></li><li class="listitem"><p>The success flag indicates the push operation result and the message flag should have proper error message in the case of failure. (In a case of success a simple success message with success flag True should be returned)</p></li></ul></div><p>Data Model Properties</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Name</p></th><th class="th leftcol" data-priority="1"><p>Type</p></th><th class="th leftcol" data-priority="1"><p>Description</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>success</p></td><td class="td leftcol"><p>bool</p></td><td class="td leftcol"><p>success flag indicates the result of push operation, whether it succeeded or failed.</p></td></tr><tr><td class="td leftcol"><p>message</p></td><td class="td leftcol"><p>string</p></td><td class="td leftcol"><p>Message field denotes the error in case of failure. In case of success it can be a simple success message.</p></td></tr></tbody></table></div><pre class="programlisting">from netskope.integrations.cte.plugin_base import PushResult

PushResult(
    success=True, 
    message=" Successfully pushed data to 3rd party."
)</pre><h8 id="UUID-d41b6f67-385b-2537-9867-e4cf56d75a20_N1643341232881" class="bridgehead">ValidationResult Class</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This class contains the result of the validation process on the plugin configuration parameters passed to the Plugin object while creating a new configuration for the plugin.</p></li><li class="listitem"><p>Make sure that all the parameters passed to the validate method are validated against the data-type and value.</p></li><li class="listitem"><p>Validate method returns the object of this class with a success flag indicating the result of validation operation and message field contains the proper error message in the case of validation failure. (In a case of success a simple success message with success flag True has to be returned)</p></li></ul></div><p>Data Model Properties</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>Name</p></th><th class="th leftcol" data-priority="1"><p>Type</p></th><th class="th leftcol" data-priority="1"><p>Description</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>success</p></td><td class="td leftcol"><p>bool</p></td><td class="td leftcol"><p>success flag indicates the result of validation operation, whether it succeeded or failed.</p></td></tr><tr><td class="td leftcol"><p>message</p></td><td class="td leftcol"><p>string</p></td><td class="td leftcol"><p>Message field denotes the error in case of failure. In case of success it can be a simple success message.</p></td></tr></tbody></table></div><pre class="programlisting">from netskope.integrations.cte.plugin_base import ValidationResult

ValidationResult(
           success=True,
           message="Validation Successfull for Sample plugin"
       )</pre></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-8abd38c6-cc0e-e5a9-d88b-ef24acb3ea29" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-0d317a39-ccb9-2ed9-0885-8aa68b8ca57d"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-0d317a39-ccb9-2ed9-0885-8aa68b8ca57d_body" data-parent="#UUID-0d317a39-ccb9-2ed9-0885-8aa68b8ca57d"><div><div class="title"><h6 class="title">Logging</h6></div></div></a></div></div><div class="panel-body collapse" id="UUID-0d317a39-ccb9-2ed9-0885-8aa68b8ca57d_body"><div class="panel-inner"><p>Threat Exchange provides a handle of logger object for logging.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Avoid print statements in the code.</p></li><li class="listitem"><p>This object logs to the central Threat Exchange database with the timestamp field. Supported log levels are <code class="literal">info</code>, <code class="literal">warn</code> and <code class="literal">error</code>.</p></li><li class="listitem"><p>Make sure any API authentication secret or any sensitive information is not exposed in the log messages.</p></li></ul></div><pre class="programlisting">self.logger.error(
               "Sample Plugin: Error log-message goes here."
 )

 self.logger.warn(
               "Sample Plugin: Warning log-message goes here."
 )

 self.logger.info(
               "Sample Plugin: Info log-message goes here."
 )</pre></div></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-c10e1360-a38d-2567-b177-ab33ee875eb9" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-a7e812f1-ec6b-217d-c582-83b2f836a6e8"><div class="titlepage"><div><div class="title"><h6 class="title">Notifications</h6></div></div></div><p>Threat Exchange provides a handle of the notification object, which can be used to generate notifications on Threat Exchange UI.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>This object is passed from Threat Exchange to the plugin object. Every plugin integration can use this object whenever there is a case of failure, which has to be notified to the user immediately. The notification timestamp is managed by Threat Exchange.</p></li><li class="listitem"><p>This object will raise the notification in the UI with a color-coding for the severity of the failure. Supported notification severities are <code class="literal">info</code>, <code class="literal">warn</code>, and <code class="literal">error</code>.</p></li><li class="listitem"><p>Make sure any API authentication secret or any sensitive information is not exposed in the notification messages.</p></li></ul></div><pre class="programlisting">self.notifier.info(
              "Sample Plugin: Info notification-message goes here."
)

self.notifier.error(
              "Sample Plugin: Error notification-message goes here."
)

self.notifier.warn(
              "Sample Plugin: Warning notification-message goes here."
)
</pre></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-ecafcda4-9e46-c50e-0f99-0e03e484f270" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-7dc0912f-0736-47b4-e660-0734f5499487"><div class="titlepage"><div><div class="title"><h6 class="title">Tagging</h6></div></div></div><p>Threat Exchange provides a utility class to handle tagging related functionalities from the plugin push/pull/validate methods. Below are some of the examples of what it can be used for.</p><h8 id="idm46361832524208" class="bridgehead">Create a New Tag</h8><pre class="programlisting">from netskope.integrations.cte.models import TagIn
from netskope.integrations.cte.utils import TagUtils

utils = TagUtils()

utils.create_tag(Tag(name="Tag Name", color="#FF0000"))</pre><h8 id="idm46361832522992" class="bridgehead">Find if a Tag with a Given Name Already Exists</h8><pre class="programlisting">utils = TagUtils()

if utils.exists("Tag Name"):
    pass  # tag already exists</pre><h8 id="idm46361832521936" class="bridgehead">Remove a Tag from Some Indicators</h8><pre class="programlisting">utils = TagUtils()

utils.on_indicators({
    "source": "Test"
}).remove("Tag Name")</pre><p>This removes the Tag Name tag from all the indicators with source=”Test”. The first and only argument to `on_indicators` is a `dict` object. This has to be a valid mongo query.</p><h8 id="idm46361832520384" class="bridgehead">Add a Tag to Some Indicators</h8><pre class="programlisting">utils = TagUtils()

utils.on_indicators({
    "source": "Test"
}).add("Tag Name")</pre></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-2940be76-8d25-6128-3b3c-9e856d9a56e7" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-b209d576-71f4-a201-69d8-aca083faa5ea"><div class="titlepage"><div><div class="title"><h6 class="title">Plugin Packaging</h6></div></div></div><p>Threat Exchange expects the developed plugin to be in zip or tar.gz format.</p><p>Execute the below command to zip the package:</p><pre class="programlisting">zip -r sample_plugin.zip sample_plugin</pre><p>Execute the below command to generate tar.gz package:</p><pre class="programlisting">tar -zcvf sample_plugin.tar.gz sample_plugin</pre></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-73e4f803-e5a1-ec83-eced-4d2edd0c08e1" data-time-modified="January 28, 2022" data-publication-date="" id="UUID-f0e2cbe2-9167-9e72-9c86-bf8c2ff81691"><div class="titlepage"><div><div class="title"><h6 class="title">Testing</h6></div></div></div><h8 id="idm46361832503776" class="bridgehead">Linting</h8><p>As part of the build process, we run a few linters to catch common programming errors, stylistic errors, and possible security issues.</p><h8 id="idm46361832503056" class="bridgehead">Flake8</h8><p>This is a basic linter. It can be run without having all the dependencies available and will catch common errors. We also use this linter to enforce the standard python pep8 formatting style. On rare occasions, you may encounter a need to disable an error/warning returned from this linter. Do this by adding an inline comment of the sort on the line you want to disable the error:</p><pre class="programlisting"># # noqa: &lt;error-id&gt;</pre><p>For example:</p><pre class="programlisting">example = lambda: 'example' # example = lambda: 'example' # noqa: E731</pre><p>When adding an inline comment always also include the error code you are disabling for. That way if there are other errors on the same line they will be reported.</p><p>Refer to: <a class="link" href="https://flake8.pycqa.org/en/latest/user/violations.html#in-line-ignoring-errors" target="_blank" rel="noopener">https://flake8.pycqa.org/en/latest/user/violations.html#in-line-ignoring-errors</a></p><p>PEP8 style docstring check is also enabled with the flake8 linter. So make sure every function/module has a proper docstring added.</p><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idm46361832498848"><div class="titlepage"><div><div class="title"><h6 class="title">Unit Testing</h6></div></div></div><p>Ensure unit testing to test small units of code in an isolated and deterministic fashion. Make sure that unit tests avoid performing communication with external APIs and use mocking. Make sure unit tests ensure the code coverage is more than 70%.</p><h8 id="idm46361832496896" class="bridgehead">Environment Setup</h8><p>In order to work with unit testing, the integration or automation script needs to be developed following the <a class="xref" href="netskope-threat-exchange-developers-guide.html#UUID-d41b6f67-385b-2537-9867-e4cf56d75a20" title="Plugin Directory Structure"><span class="xreftitle">Plugin Directory Structure</span></a>. We use PIP to install all the required Python module dependencies required to run the setup. Before running the tests, make sure you install all the required dependencies mentioned in the requirements.txt of the Threat Exchange core repository.</p><h8 id="idm46361832494880" class="bridgehead">Write Your Unit Tests</h8><p>Make sure unit tests are written in a separate Python file named: &lt;your_plugin_name&gt;_test.py. Within the unit test file, each unit test function should be named: test_&lt;your test case&gt;. More information on writing unit tests and their format is available at the <a class="link" href="https://docs.pytest.org/en/latest/contents.html" target="_blank" rel="noopener">PyTest Docs</a>.</p><h8 id="idm46361832493408" class="bridgehead">Mocking</h8><p>We use <a class="link" href="https://github.com/pytest-dev/pytest-mock/" target="_blank" rel="noopener">pytest-mock</a> for mocking. pytest-mock is enabled by default and installed in the base environment mentioned above. To use a mocker object simply pass it as a parameter to your test function. The mocker can then be used to mock both the plugin class object and also external APIs.</p><p>Ex.</p><pre class="programlisting">def test_netskope_pull_success(mocker):
   mocker.patch("cte.plugins.netskope.main.NetskopePlugin.pull")
   pull_return_result = [
       Indicator(value="ind1", type=IndicatorType.MD5),
       Indicator(value="ind2", type=IndicatorType.SHA256),
       Indicator(value="ind3", type=IndicatorType.URL),
   ]

   NetskopePlugin.pull.return_value = pull_return_result
   ns = NetskopePlugin(None, None, None, logger)
   actual_pull = ns.pull()
   assert pull_return_result == actual_pull</pre><p>To mock request module response for API calls (requests_mock Pytest plugin is installed with all the dependencies):</p><pre class="programlisting">def test_fetch_threat_data_malware(requests_mock):
   endpoint_url = "https://example-api.com"
   mock_response_json = {
       'status': 'success',
       'data': [
           {
               'local_md5': 'ind1',
           },
           {
               'local_md5': 'ind2',
           },
           {
               'local_md5': 'ind3',
           },
       ]
   }
   requests_mock.get(endpoint_url, json=mock_response_json)
   config_dict = {
       "api_token": "abc",
       "tenant_name": "partners",
       "file_list": "test",
       "url_list": "sample",
       "threat_data_type": "URL",
       "is_pull_required": "Yes",
       "max_file_hash_cap": 8,
       "max_url_list_cap": 8,
   }
   ns = NetskopePlugin(config_dict, None, None, logger)
   actual_ind_list = ns.fetch_threat_data(
       endpoint_url,
       config_dict['api_token'],
       datetime.datetime.now(),
       time.time(),
       "malware"
   )
   indicator_list = [
       Indicator(value="ind1", type=IndicatorType.MD5),
       Indicator(value="ind2", type=IndicatorType.MD5),
       Indicator(value="ind3", type=IndicatorType.MD5),
   ]
   assert len(actual_ind_list) == len(indicator_list)
   for i in range(len(actual_ind_list)):
       assert actual_ind_list[i].value == indicator_list[i].value</pre><h8 id="idm46361832504704" class="bridgehead">Run Your Unit Tests</h8><pre class="programlisting">$ PYTHONPATH=. pytest</pre></section></section></div></div></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-abc521af-3e0d-4430-fe7f-8a9151690a93">Netskope Threat Exchange Developers Guide</a></li><li><a href="#UUID-d85193ff-740d-b945-4e22-b267afaec57a">Netskope Threat Exchange Module</a></li><li><a href="#UUID-e1ea2f86-5ef4-3038-b333-5bd2db8b3a9f">Development Guidelines</a></li><li><a href="#UUID-eee42748-19e1-6ee3-b612-6a356a0e0cb0">Writing a Plugin</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Netskope%20Threat%20Exchange%20Developers%20Guide%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Netskope%20Threat%20Exchange%20Developers%20Guide%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="select-and-modify-tags.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-threat-exchange-developers-guide.html#UUID-d85193ff-740d-b945-4e22-b267afaec57a">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2022 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">January 28, 2022</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div><!--Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W56WJ8S" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!--End Google Tag Manager (noscript)--></body></html>
