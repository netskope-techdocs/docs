<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Setting Up AWS Instances using Old UI</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="setting-up-multiple-aws-accounts-using-the-new-ui.html" title="Setting Up Multiple AWS Accounts using the New UI"></link><link rel="next" href="continuous-security-assessment-for-google-cloud-platform.html" title="Continuous Security Assessment for Google Cloud Platform"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script async="" src="https://www.googletagmanager.com/gtag/js?id=256425220"></script><script type="text/javascript">var propertyid = '256425220';

						window.dataLayer = window.dataLayer || [];
						function gtag(){dataLayer.push(arguments)};
						gtag('js', new Date());
						
						gtag('config', propertyid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="network-security.html">Network Security</a></li><li class="breadcrumb-link"><a href="netskope-public-cloud-security.html"><span class="phrase">Netskope Public Cloud Security</span></a></li><li class="breadcrumb-link"><a href="continuous-security-assessment-for-amazon-web-services.html">Continuous Security Assessment for Amazon Web Services</a></li><li class="breadcrumb-node">Setting Up AWS Instances using Old UI</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="setting-up-multiple-aws-accounts-using-the-new-ui.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="continuous-security-assessment-for-google-cloud-platform.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-502e40b0-5650-185b-6f84-5b846f779402" data-permalink="setting-up-aws-instances-using-old-ui.html" data-topic-level="1" data-relative-prefix="" data-time-modified="May 28, 2020" data-publication-date="" id="UUID-facbce07-5fed-8074-472e-5efc41157211"><div class="titlepage"><div><div class="title"><h5 class="title">Setting Up AWS Instances using Old UI</h5></div></div></div><p>In release 74, Netskope revised the AWS account setup process that allows you to configure multiple AWS accounts with Netskope’s Public Cloud Security features. For information about the new set up process, see <a class="xref" href="setting-up-multiple-aws-accounts-using-the-new-ui.html" title="Setting Up Multiple AWS Accounts using the New UI"><span class="xreftitle">Setting Up Multiple AWS Accounts using the New UI</span></a>.</p><p>If you are using the old UI, then follow the instructions in the following sections to configure your AWS accounts for Security Assessment, DLP, and Threat Protection.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-54b7ce96-11d9-6562-3299-4377b02bb884" title="Configure AWS for Continuous Security Assessment"><span class="xreftitle">Configure AWS for Continuous Security Assessment</span></a></p></li><li class="listitem"><p><a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-938c06ed-eab8-e9ed-7d9d-b9333b351e44" title="Setting up Multiple AWS Instances"><span class="xreftitle">Setting up Multiple AWS Instances</span></a></p></li><li class="listitem"><p><a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd" title="Configure AWS CloudTrail for Audit Reports"><span class="xreftitle">Configure AWS CloudTrail for Audit Reports</span></a></p></li><li class="listitem"><p><a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3" title="Configure AWS S3 for DLP Scanning and Threat Protection"><span class="xreftitle">Configure AWS S3 for DLP Scanning and Threat Protection</span></a></p></li></ul></div><p>You can migrate existing instances of AWS accounts configured in your Netskope tenant to the new set up. For instructions to migrate to the new set up, see <a class="xref" href="setting-up-multiple-aws-accounts-using-the-new-ui.html#UUID-ff88d934-8f56-2761-8744-ca46615deedd" title="Migrate existing AWS accounts to the new set up"><span class="xreftitle">Migrate existing AWS accounts to the new set up</span></a>.</p><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-5701cbb9-fe6f-2f66-8ebf-6957df505159" data-time-modified="May 28, 2020" data-publication-date="" id="UUID-54b7ce96-11d9-6562-3299-4377b02bb884"><div class="titlepage"><div><div class="title"><h6 class="title">Configure AWS for Continuous Security Assessment</h6></div></div></div><div dir="ltr" class="tip"><h3 class="title">Tip</h3><p>If you have already set up an instance for CloudTrail and want to scan an S3 bucket or Security Assessment, simply attach the permissions required for CloudTrail or Security Assessment to the existing role, and then enable the CloudTrail or Security Assessment check-boxes in the Netskope UI.</p></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Netskope normalizes the term "Account" to help with cross CSP summaries. Netskope normalized “Account” field maps to AWS Account.</p></div><p>To configure AWS for continuous security assessment:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the Netskope tenant UI: <code class="literal">https://<span class="emphasis"><em>&lt;tenant hostname&gt;</em></span>.goskope.com</code> and navigate to <span class="bold bold"><strong>Settings &gt; <span class="phrase">API-enabled Protection</span> &gt; Cloud Infrastructure</strong></span>.</p></li><li class="listitem"><p>Select the <span class="bold bold"><strong>AWS</strong></span> icon, and then click <span class="bold bold"><strong>SETUP</strong></span>.</p><p>The <span class="bold bold"><strong>New Setup</strong></span> window opens.</p></li><li class="listitem"><p>Under <span class="bold bold"><strong>AWS Role</strong></span>, note the <span class="bold bold"><strong>Netskope Account ID</strong></span> and <span class="bold bold"><strong>Netskope External ID</strong></span>. You need to enter these into the AWS console in steps 8-9.</p></li><li class="listitem"><p>Log in to <a class="link" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS console</a>.</p></li><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Services &gt; Security, Identity &amp; Compliance</strong></span> and click <span class="bold bold"><strong>IAM</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Roles</strong></span> and then <span class="bold bold"><strong>Create role</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Select type of trusted entity</strong></span> page, select <span class="bold bold"><strong>Another AWS account</strong></span>.</p></li><li class="listitem"><p>Enter the account ID you noted from the Netskope UI in step 3.</p></li><li class="listitem"><p>Select the <span class="bold bold"><strong>Require external ID</strong></span> checkbox and enter the external ID you noted from the Netskope UI in step 3.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Leave the <span class="bold bold"><strong>Require MFA</strong></span> checkbox unchecked.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Next: Permissions</strong></span>.</p></li><li class="listitem" id="UUID-54b7ce96-11d9-6562-3299-4377b02bb884_listitem-idm43116640670348"><p>In the <span class="bold bold"><strong>Attach permissions policies</strong></span> page, add the <span class="bold bold"><strong>SecurityAudit</strong></span> policy and click <span class="bold bold"><strong>Next: Tags</strong></span>.</p></li><li class="listitem" id="UUID-54b7ce96-11d9-6562-3299-4377b02bb884_listitem-idm43116640710454"><p>In the <span class="bold bold"><strong>Add tags (optional)</strong></span> page, do not add any IAM tags and click <span class="bold bold"><strong>Next: Review</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Review</strong></span> page, enter a role name and then click <span class="bold bold"><strong>Create role</strong></span>.</p></li><li class="listitem"><p>After creating a role, you need to attach a policy to it. In the <span class="bold bold"><strong>Roles</strong></span> page, click on the role you just created.</p></li><li class="listitem"><p>On the <span class="bold bold"><strong>Permissions</strong></span> tab, click <span class="bold bold"><strong>+ Add inline policy</strong></span>. In the <span class="bold bold"><strong>Create Policy</strong></span> page, enter the following details:</p><div class="orderedlist" id="UUID-54b7ce96-11d9-6562-3299-4377b02bb884_orderedlist-idm43121835435468"><ol class="orderedlist" type="a"><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>DynamoDB</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>ListTagsOfResource</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Services</strong></span> drop-down list, select <span class="bold bold"><strong>SES</strong></span>.</p></li><li class="listitem"><p>From the Actions drop-down list, select <span class="bold bold"><strong>ListIdentityPolicies</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>Lambda</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select all actions starting with <span class="bold bold"><strong>Get</strong></span> (8 actions) and <span class="bold bold"><strong>List</strong></span> (7 actions) strings.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>S3</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>GetBucketLocation</strong></span>, <span class="bold bold"><strong>GetObject</strong></span>, <span class="bold bold"><strong>GetObjectAcl</strong></span>, <span class="bold bold"><strong>ListAllMyBuckets</strong></span>, and <span class="bold bold"><strong>ListBucket</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>SQS</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>ListDeadLetterSourceQueues</strong></span>, <span class="bold bold"><strong>ListQueues</strong></span>, <span class="bold bold"><strong>GetQueueAttributes</strong></span>, and <span class="bold bold"><strong>GetQueueUrl</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li></ol></div><p>The inline policy definition should look like this in JSON format. You can click the <span class="bold bold"><strong>JSON</strong></span> tab to view the policy script.</p><pre class="programlisting">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "lambda:ListVersionsByFunction",
                "lambda:GetLayerVersion",
                "dynamodb:ListTagsOfResource",
                "s3:ListBucket",
                "lambda:GetAccountSettings",
                "lambda:GetFunctionConfiguration",
                "lambda:GetLayerVersionPolicy",
                "s3:GetObjectAcl",
                "lambda:ListLayerVersions",
                "lambda:ListLayers",
                "lambda:GetAlias",
                "sqs:ListQueues",
                "sqs:GetQueueUrl",
                "lambda:ListFunctions",
                "lambda:GetEventSourceMapping",
                "lambda:GetFunction",
                "lambda:ListAliases",
                "sqs:GetQueueAttributes",
                "s3:GetBucketAcl",
                "ses:ListIdentityPolicies",
                "s3:GetObject",
                "sqs:ListDeadLetterSourceQueues",
                "s3:ListAllMyBuckets",
                "lambda:ListEventSourceMappings",
                "s3:GetBucketLocation",
                "lambda:GetPolicy"
            ],
            "Resource": "*"
        }
    ]
}</pre></li><li class="listitem"><p>Click <span class="bold bold"><strong>Review policy</strong></span>.</p></li><li class="listitem"><p>Enter the name of the policy and click <span class="bold bold"><strong>Create Policy</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Summary</strong></span> page, copy the <span class="bold bold"><strong>Role ARN</strong></span> value. You need to enter this in the Netskope UI when you create your AWS instance.</p></li></ol></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp139372"><div class="titlepage"><div><div class="title"><h6 class="title">Create an AWS Instance in <span class="phrase">API-enabled Protection</span></h6></div></div></div><p>To create an AWS instance in <span class="phrase">API-enabled Protection</span>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the Netskope tenant UI.</p></li><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Settings &gt; <span class="phrase">API-enabled Protection</span> &gt; Cloud Infrastructure &gt; AWS &gt; SETUP</strong></span>.</p></li><li class="listitem"><p>The <span class="bold bold"><strong>New Setup</strong></span> window opens. Enter the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>AWS Account Name: Enter a unique name of the AWS account.</p></li><li class="listitem"><p>Admin email: Enter the email address to receive email notification when a policy is triggered.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You can set a notification on the <span class="bold bold"><strong>Policies &gt; <span class="phrase">API-enabled Protection</span> &gt; NEW POLICY</strong></span> wizard page.</p></div></li><li class="listitem"><p>Connection Type:</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Few of the instance type options may be disabled. Contact your Netskope sales representative for additional information.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Security Assessment: Select this option to assess your AWS resources. Also, you have the option to run the policy at intervals (30 minutes, 60 minutes, 2 hours, 6 hours, and 24 hours).</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Netskope recommends setting the interval to 60 minutes or more.</p></div></li></ul></div></li><li class="listitem"><p>Role: Enter the AWS resource name of IAM role you copied in step 19.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>CloudTrail name and region are not required for Security Assessment.</p></div></li></ul></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Save</strong></span>, then click <span class="bold bold"><strong>Grant Access</strong></span> for the AWS instance you just created.</p></li></ol></div><p>Refresh your browser, and you should see a green check icon next to the instance name. Navigate to the <span class="bold bold"><strong>Policies &gt; Security Assessment</strong></span> page to create a security assessment policy, profile, and rule. Once you create a policy, Netskope accesses and analyzes the posture of the AWS resources and alerts the administrator for risk and possible remediation. You can view the AWS security assessment dashboard by navigating to the <span class="bold bold"><strong>Cloud Infrastructure</strong></span> page.</p></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-a5e69d90-3eef-5dea-5751-242a825f49fd" data-time-modified="October 29, 2020" data-publication-date="" id="UUID-938c06ed-eab8-e9ed-7d9d-b9333b351e44"><div class="titlepage"><div><div class="title"><h6 class="title">Setting up Multiple AWS Instances</h6></div></div></div><p>You can setup multiple AWS instances to perform Continuous Security Assessments (CSA) on an AWS account using the Netskope platform. The process requires the following two steps.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The customer AWS account needs to be configured to provide Netskope with the appropriate permissions to scan the resources in the account.</p></li><li class="listitem"><p>An <span class="phrase">API-enabled Protection</span> Cloud Infrastructure account (instance) needs to be set up in the Netskope UI.</p></li></ol></div><p>More details about this setup procedure and the required permissions are available .</p><p>This CLI-based script allows you to set up multiple AWS instances for CSA without having to perform the above two steps individually (in the Netskope UI) for each AWS account.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>With this script, Netskope currently supports the creation of instances configured for CSA only.</p></div><p>The input to this script is provided via a JSON configuration file that contains the list of AWS accounts to be configured for CSA and the configuration details of those AWS accounts/<span class="phrase">API-enabled Protection</span> instances. This script reads the configuration file created by the customer and performs the two setup steps:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Configures the AWS accounts listed the configuration file to provide permission for Netskope to scan the resources in those accounts. This configuration is done by generating and executing an AWS Cloud Formation Template (CFT) to create the appropriate resources and policies.</p></li><li class="listitem"><p>Sets up the corresponding <span class="phrase">API-enabled Protection</span> accounts (instances) in the Netskope UI.</p></li></ul></div><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-537b3ccb-6559-28bc-07f9-d3fdc9f2da0e" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-ead7b166-6501-b70f-3066-e12ccde65bb3"><div class="titlepage"><div><div class="title"><h6 class="title">Terminology</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="strong strong"><strong>Sub-account(s)</strong></span>: The set of accounts in the customer's AWS environment that need to be configured for CSA.</p></li><li class="listitem"><p><span class="strong strong"><strong>Master account</strong></span>: The primary or central account (could be the master account of the customer’s AWS organization) used to configure all the sub-accounts. Using a master account is optional, but if used, the master account needs to have appropriate privileges to perform the necessary actions on the sub-accounts.</p></li></ul></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-a2df26d1-34f8-d952-d9fa-33d6891c611e" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-de88689a-fb13-590c-d43d-f14633c432a7"><div class="titlepage"><div><div class="title"><h6 class="title">Prerequisites</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Netskope tenant host name and API token. Refer to the Netskope REST API documentation located .</p></li><li class="listitem"><p>Permissions for the script to create resources/policies in the sub-accounts. An AWS sub-account can be configured for CSA in a couple of ways:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Using a role that belongs to the sub-account and can be assumed from the master account. In this case, the role details (ARN and External ID) and the master account credentials (access key and secret key) must be populated in the “<span class="strong strong"><strong>assume_role</strong></span>” section in the <a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-cb9e026b-9761-b29e-5e8a-0cbcf85aec03" title="JSON Configuration File Template"><span class="xreftitle">JSON Configuration File Template</span></a>. The role must be configured with an external ID (even though both master and sub-account belong to the same customer/organization) and is recommended to have "AdministratorAccess" policy attached.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The AdministratorAccess permission is granted only to the master account within the customer’s organization, not to Netskope. If a role with lower privileges is preferred, refer to <a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-3290629c-b55b-99db-34c0-eccd1d7266bb" title="Lower Privilege for Sub-Account Role that Trusts Master Account"><span class="xreftitle">Lower Privilege for Sub-Account Role that Trusts Master Account</span></a>.</p></div></li><li class="listitem"><p>Using the access token for a user that exists in the sub-account itself. In this case, the access key ID and secret access key of that user must be populated in the “<span class="strong strong"><strong>token</strong></span>” section in the <a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-cb9e026b-9761-b29e-5e8a-0cbcf85aec03" title="JSON Configuration File Template"><span class="xreftitle">JSON Configuration File Template</span></a>. The user must have "AdministratorAccess" policy permission. For lower privileges, refer to the <a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-3290629c-b55b-99db-34c0-eccd1d7266bb" title="Lower Privilege for Sub-Account Role that Trusts Master Account"><span class="xreftitle">Lower Privilege for Sub-Account Role that Trusts Master Account</span></a>.</p></li></ol></div></li></ul></div><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-2bd0b5d8-f1f8-7070-c4dc-c1cf9b7d8e81" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-cb9e026b-9761-b29e-5e8a-0cbcf85aec03"><div class="titlepage"><div><div class="title"><h6 class="title">JSON Configuration File Template</h6></div></div></div><p>The name of the configuration file can be anything as long as it matches the name specified in the script arguments. For each AWS account to be set up, create one entry in the “instances” JSON array.</p><pre class="programlisting">{
    "instances":
    [  
        {  
            "config":
            {  
                "instance_name":"...",
                "securityscan_interval":60,
                "email_id":"...",
                "use_for":
                [           
                    "securityscan"
                ]
            },
            "credentials":
            {  
                "assumeRole":{  
                "role_arn":"...",
                "external_id":"...",
                "access_key_id":"...",
                "secret_access_key":"..."
            },
            "token":
            {  
                "access_key_id":"...",
                "secret_access_key":"..."
            }
        }
    ]
}
</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="strong strong"><strong>instance_name</strong></span>: [REQUIRED] Name of Instance. Instance name should only have alphanumeric characters without any special characters or spaces. It is recommended to have the instance_name be the same as the AWS account name.</p></li><li class="listitem"><p><span class="strong strong"><strong>securityscan_interval</strong></span>: [REQUIRED] Selected interval to run Security Scan in minutes. Allowed values are 30, 60, 120, 360, 1440.</p></li><li class="listitem"><p><span class="strong strong"><strong>email_id</strong></span>: [REQUIRED] Email of the User. It is recommended that this email is the owner of the Account, but you can use a single email for all the sub-accounts.</p></li><li class="listitem"><p><span class="strong strong"><strong>use_for</strong></span>: [REQUIRED] Netskope feature to be used. For CSA scans only use “securityscan”.</p></li><li class="listitem"><p><span class="strong strong"><strong>credentials:</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="strong strong"><strong>assumeRole</strong></span>: [OPTIONAL] Details of role with required privileges to run CFT template.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><span class="strong strong"><strong>role_arn</strong></span>: [REQUIRED] ARN of the role in the sub-account that has a trust relationship with the master account. The role should be set up with an external ID and permission should have "AdministratorAccess" policy.</p></li><li class="listitem"><p><span class="strong strong"><strong>external_id</strong></span>: [REQUIRED] External ID provided in the IAM role above.</p></li><li class="listitem"><p><span class="strong strong"><strong>access_key_id</strong></span>: [REQUIRED] The access key ID of the user in the master account which has STS policy with read/write permissions for all resources.</p></li><li class="listitem"><p><span class="strong strong"><strong>secret_access_key</strong></span>: [REQUIRED] Secret access key of the user in the master account</p></li></ul></div></li><li class="listitem"><p><span class="strong strong"><strong>token</strong></span>: [OPTIONAL] Credentials of an AWS user with required privileges to run CFT template.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p><span class="strong strong"><strong>access_key_id</strong></span>: [REQUIRED] IAM access key ID for the account to be added to Netskope IaaS</p></li><li class="listitem"><p><span class="strong strong"><strong>secret_access_key</strong></span>: [REQUIRED] IAM secret access key for the account to be added to Netskope IaaS</p></li></ul></div></li></ul></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p id="UUID-cb9e026b-9761-b29e-5e8a-0cbcf85aec03_para-idm43143443521880">Either <span class="bold bold"><strong>assumeRole</strong></span> or <span class="bold bold"><strong>token</strong></span> is mandatory.</p></div></li></ul></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-dc69e12b-9d32-f5d1-aab9-28870c48b590" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-30a6ef83-820a-791c-2de6-46b6277705ac"><div class="titlepage"><div><div class="title"><h6 class="title">Configuration File Example</h6></div></div></div><p>The example file below configures &lt;sub-account 1&gt; using roles and &lt;sub-account 2&gt; using user access tokens.</p><pre class="programlisting">{
    "instances":
    [  
        {  
            "config":
            {  
                "instance_name":"&lt;sub-account 1 name&gt;",
                "securityscan_interval":60,
                "email_id":"&lt;account1_admin@company.com&gt;",
                "use_for":
                [
                    "securityscan"
                ]
            },
            "credentials":
            {  
                "assumeRole":
                {  
                    "role_arn":"arn:aws:iam::&lt;id&gt;:role/master-admin-role",
                    "external_id":"&lt;external id string&gt;",
                    "access_key_id":"&lt;access key id of master account&gt;",
                    "secret_access_key":"&lt;secret access key of master account&gt;"
                }
            }
        },
        {  
            "config":
            {  
                "instance_name":"&lt;AWS sub-account 2&gt;",
                "securityscan_interval":60,
                "email_id":"&lt;account2_admin@company.com&gt;",
                "use_for":
                [  
                    "securityscan"
                ]
            },
            "credentials":
            {  
                "token":
                {  
                    "access_key_id":"&lt;access key id of sub-account 2&gt;",
                    "secret_access_key":"&lt;secret access key of sub-account 2&gt;"
                }
            }
        }
    ]
}
</pre></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-dd662498-c4de-9116-d2bf-40822e29e7c5" data-time-modified="February 5, 2020" data-publication-date="" id="UUID-4565356a-f76a-113a-bb79-f18531ef915e"><div class="titlepage"><div><div class="title"><h6 class="title">Steps to Run the Script</h6></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Install the following:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Python2.7 - <code class="code">sudo apt install python2.7</code></p></li><li class="listitem"><p>Pip - <code class="code">sudo apt install python-pip</code></p></li><li class="listitem"><p>Virtual Environment - <code class="code">pip install virtualenv</code></p></li></ol></div></li><li class="listitem"><p>Download <span class="emphasis"><em>nsiaastools-0.0.2.tar.gz</em></span> package from the <a class="link" href="https://support.netskope.com/hc/en-us/article_attachments/360049653093/nsiaastools-0.0.2.tar.gz" target="_blank" rel="noopener">Netskope Support Portal</a>.</p></li><li class="listitem"><p>Move the package to any desired location where it can be installed.</p><p><code class="code">mv nsiaastools-&lt;version&gt;.tar.gz &lt;package installation path&gt;</code></p></li><li class="listitem"><p>Change directory to location where nsiaastools package is located.</p><p><code class="code">cd &lt;package installation path&gt;</code></p></li><li class="listitem"><p>Create a virtual environment to install the package in.</p><p><code class="code">sudo virtualenv &lt;virtual environment name&gt;</code></p></li><li class="listitem"><p>Activate the newly created virtual environment.</p><p id="UUID-4565356a-f76a-113a-bb79-f18531ef915e_para-idm43143451959338"><code class="code">sudo virtualenv &lt;virtual environment name&gt;</code></p></li><li class="listitem"><p>Install nsiaastools package inside the virtual environment.</p><p><code class="code">pip install nsiaastools-&lt;version&gt;.tar.gz</code></p></li><li class="listitem"><p>Run the script to create new <span class="phrase">API-enabled Protection</span> AWS instances in the Netskope UI.</p><p><code class="code">aws_instance_setup.py [-h] -i CONF_FILE -c TOKEN -t TENANT</code></p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p>-i, --instances</p></th><th class="th leftcol" data-priority="1"><p><a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-cb9e026b-9761-b29e-5e8a-0cbcf85aec03" title="JSON Configuration File Template"><span class="xreftitle">JSON Configuration File Template</span></a> for Netskope instances to be created</p></th></tr></thead><tbody><tr><td class="td leftcol"><p>-c, --token</p></td><td class="td leftcol"><p>Netskope API Token</p></td></tr><tr><td class="td leftcol"><p>-t, --tenant</p></td><td class="td leftcol"><p>Netskope tenant hostname</p></td></tr></tbody></table></div></li></ol></div><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-4569df98-df52-c29d-b9c3-c170479bf6e7" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-0f0a75bf-e3f4-ab8a-7f2e-f07d21948298"><div class="titlepage"><div><div class="title"><h6 class="title">CloudFormation Template Output After the Execution of the Script</h6></div></div></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-0ce05f26-5d4f-e0cb-d0ff-355e324e420f-en.png" style="max-width: 585px; " alt="image1.png"></img></td></tr></table></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-b8e1dcbc-91a9-d23b-db5f-a8b1b3ebe17f" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-acf268fe-b806-9ec5-733d-869c93456770"><div class="titlepage"><div><div class="title"><h6 class="title">Sample AWS Account Configuration</h6></div></div></div><p>Role ARN for assumeRole.role_arn</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-0c0903e5-fea7-d474-5feb-5225435a2150-en.png" style="max-width: 585px; " alt="image2.png"></img></td></tr></table></div></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-1321d0fa-17d0-aeaa-1992-16994bcd406e" data-time-modified="February 5, 2020" data-publication-date="" id="UUID-4b50aaab-020c-a665-4bfd-9ec44ec5d58c"><div class="titlepage"><div><div class="title"><h6 class="title">Troubleshooting</h6></div></div></div><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col align="left"></col><col align="left"></col><col align="left"></col></colgroup><thead><tr><th class="th leftcol" data-priority="1"><p><span class="strong strong"><strong>Error Message</strong></span></p></th><th class="th leftcol" data-priority="1"><p><span class="strong strong"><strong>Reason</strong></span></p></th><th class="th leftcol" data-priority="1"><p><span class="strong strong"><strong>Remediation</strong></span></p></th></tr></thead><tbody><tr><td class="td leftcol"><p>Maximum &lt;number&gt; of combined &lt;list&gt; instances has reached. Cannot create more instances.</p></td><td class="td leftcol"><p>Instance creation limit reached.</p></td><td class="td leftcol"><p>Maximum instances created hence stop creating any new instances.</p></td></tr><tr><td class="td leftcol"><p>Invalid REST API Token. Please contact administrator.</p></td><td class="td leftcol"><p>Invalid Netskope token supplied.</p></td><td class="td leftcol"><p>Check the Netskope token applied.</p></td></tr></tbody></table></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-4358210d-1ebe-50f2-6c63-a39bae652b75" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-9b17f398-3d82-16e9-ab3e-693f6df90b01"><div class="titlepage"><div><div class="title"><h6 class="title">Appendix</h6></div></div></div><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-21254d1d-7f87-a74d-167b-45a2b3d7b13e" data-time-modified="October 22, 2019" data-publication-date="" id="UUID-3290629c-b55b-99db-34c0-eccd1d7266bb"><div class="titlepage"><div><div class="title"><h6 class="title">Lower Privilege for Sub-Account Role that Trusts Master Account</h6></div></div></div><p>If you do not intend to configure the sub-account role that trusts the master account with AdministratorAccess policy, the role can be configured with a policy equivalent to the following:</p><pre class="programlisting">{
    "Version": "2012-10-17",
    "Statement":
    [
        {
            "Action":
            [
                “s3:*",
                "cloudtrail:*",
                "sns:*",
                "iam:*",
                "cloudformation:*"
            ],
            "Resource": "*",
            "Effect": "Allow"
        }
    ]
}</pre></section></section></section><section xml:lang="en" lang="en" dir="ltr" class="section internal internal" data-origin-id="UUID-adc00d45-091b-63e1-ea92-83304e47962b" data-time-modified="May 28, 2020" data-publication-date="" id="UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd"><div class="titlepage"><div><div class="title"><h6 class="title">Configure AWS CloudTrail for Audit Reports</h6></div></div></div><p>Adding the Netskope app to your AWS account has these requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create or have access to an existing S3 bucket, SNS topic, and CouldTrail service.</p></li><li class="listitem"><p>Create a role for Netskope to grant permissions.</p></li></ul></div><p>To configure AWS CloudTrail for Netskope:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the Netskope tenant UI: <code class="literal">https://<span class="emphasis"><em>&lt;tenant hostname&gt;</em></span>.goskope.com</code> and navigate to <span class="bold bold"><strong>Settings &gt; <span class="phrase">API-enabled Protection</span> &gt; Cloud Infrastructure</strong></span>.</p></li><li class="listitem"><p>Select the <span class="bold bold"><strong>AWS</strong></span> icon, and then click <span class="bold bold"><strong>Setup</strong></span>.</p><p>The <span class="bold bold"><strong>New Setup</strong></span> window opens.</p></li><li class="listitem" id="UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd_TenantAccountDetails"><p>Under <span class="bold bold"><strong>Follow these instructions before proceeding:</strong></span>, note the <span class="bold bold"><strong>Netskope Account ID</strong></span> and <span class="bold bold"><strong>Netskope External ID</strong></span>. You need to enter these into the AWS console in steps 11-12.</p></li><li class="listitem"><p>Log in to the <a class="link" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS console</a>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>AWS Management Console</strong></span>, navigate to <span class="bold bold"><strong>Services &gt; Management &amp; Governance</strong></span> and click <span class="bold bold"><strong>CloudTrail</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Trails</strong></span>, and then click <span class="bold bold"><strong>Create trail</strong></span> (or select an existing trail).</p></li><li class="listitem"><p>For a new trail, enter these parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Trail name: Enter a unique name.</p></li><li class="listitem"><p>Apply trail to all regions: <span class="bold bold"><strong>Yes</strong></span></p></li><li class="listitem"><p>Management events &gt; Read/Write events: <span class="bold bold"><strong>All</strong></span></p></li><li class="listitem"><p>Data events: Keep the setting unchanged.</p></li><li class="listitem"><p>Create a new S3 bucket: <span class="bold bold"><strong>Yes</strong></span></p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You can use an existing S3 bucket as an option.</p></div></li><li class="listitem"><p>S3 bucket: New S3 bucket where you would like your logs delivered. CloudTrail creates the bucket and applies the appropriate policy.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Advanced</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>(Optional) Encrypt log files with SSE-KMS: <span class="bold bold"><strong>Yes</strong></span></p><p>This step is optional. You can keep the default setting to <span class="bold bold"><strong>No</strong></span>. However, it is recommended you encrypt your CloudTrail log files to avoid CSA benchmark noncompliance.</p></li><li class="listitem"><p>(Optional) Create a new KMS key: You can either create a new KMS key or use an existing one.</p></li><li class="listitem"><p>(Optional) KMS key: Based on the selection from the earlier step, you can either enter a new KMS key or select an existing key from the drop-down list.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you use an existing KMS key, you should edit the policy of the customer managed key (CMK) to decrypt a CloudTrail log file. For more information, see <a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd_section-5ce368e2cfb14-idm45390841353040" title="Permissions Required to Decrypt a CloudTrail Log File"><span class="xreftitle">Permissions Required to Decrypt a CloudTrail Log File</span></a>.</p></div></li><li class="listitem"><p>Enable log file validation: <span class="bold bold"><strong>Yes</strong></span></p></li><li class="listitem"><p>Send SNS notification for every log file delivery: <span class="bold bold"><strong>Yes</strong></span></p></li><li class="listitem"><p>Create a new SNS topic: If you select <span class="bold bold"><strong>Yes</strong></span>, enter the new SNS topic name in the <span class="bold bold"><strong>SNS topic</strong></span> field in the next step. If you select <span class="bold bold"><strong>No</strong></span>, select an existing topic from the <span class="bold bold"><strong>SNS topic </strong></span> drop-down list in the next step.</p></li><li class="listitem"><p>SNS topic: Based on the selection from the earlier step, you can either enter a new SNS topic name or select an existing topic from the drop-down list.</p></li></ul></div><p>When finished, click <span class="bold bold"><strong>Create</strong></span>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Note the CloudTrail name and region you just created. You need to enter these in the Netskope UI when you create your AWS instance.</p></div></li></ul></div></li><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Services &gt; Security, Identity &amp; Compliance</strong></span> and click <span class="bold bold"><strong>IAM</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Roles</strong></span> and then <span class="bold bold"><strong>Create role</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Select type of trusted entity</strong></span> page, select <span class="bold bold"><strong>Another AWS account</strong></span>.</p></li><li class="listitem"><p>Enter the account ID you noted from the Netskope UI in step 3.</p></li><li class="listitem"><p>Select the <span class="bold bold"><strong>Require external ID</strong></span> checkbox and enter the external ID you noted from the Netskope UI in step 3.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Leave the <span class="bold bold"><strong>Require MFA</strong></span> checkbox unchecked.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Next: Permissions</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Attach permissions policies</strong></span> page, add the <span class="bold bold"><strong>SecurityAudit</strong></span> policy and click <span class="bold bold"><strong>Next: Tags</strong></span>.</p></li><li class="listitem" id="UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd_listitem-idm43116639757380"><p>In the <span class="bold bold"><strong>Add tags (optional)</strong></span> page, do not add any IAM tags and click <span class="bold bold"><strong>Next: Review</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Review</strong></span> page, enter a role name and then click <span class="bold bold"><strong>Create role</strong></span>.</p></li><li class="listitem"><p>After creating a role, you need to attach a policy to it. In the <span class="bold bold"><strong>Roles</strong></span> page, click on the role you just created.</p></li><li class="listitem"><p>On the <span class="bold bold"><strong>Permissions</strong></span> tab, click <span class="bold bold"><strong>+ Add inline policy</strong></span>. In the <span class="bold bold"><strong>Create Policy</strong></span> page, enter the following details:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>SNS</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>ComfirmSubscription</strong></span>, <span class="bold bold"><strong>Subscribe</strong></span>, and <span class="bold bold"><strong>Unsubscribe</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>S3</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>GetObject</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>CloudTrail</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>DescribeTrails</strong></span> and <span class="bold bold"><strong>LookupEvents</strong></span>.</p></li></ol></div><p>The inline policy definition should look like this in JSON format. You can click the <span class="bold bold"><strong>JSON</strong></span> tab to view the policy script.</p><pre class="programlisting">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "cloudtrail:LookupEvents",
                "sns:Unsubscribe",
                "sns:Subscribe",
                "sns:ConfirmSubscription",
                "cloudtrail:DescribeTrails"
            ],
            "Resource": "*"
        }
    ]
}</pre></li><li class="listitem"><p>Click <span class="bold bold"><strong>Review Policy</strong></span>.</p></li><li class="listitem"><p>Enter the name of the policy and click <span class="bold bold"><strong>Create Policy</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Summary</strong></span> page, note the <span class="bold bold"><strong>Role ARN</strong></span> value. You need to enter this in the Netskope UI when you create your AWS instance.</p></li></ol></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd_section-5ce368e2cfb14-idm45390841353040"><div class="titlepage"><div><div class="title"><h6 class="title">Permissions Required to Decrypt a CloudTrail Log File</h6></div></div></div><p>You should edit the policy of the customer managed key (CMK) to ensure Netskope can decrypt the CloudTrail log files. Follow the instructions below.</p><div class="orderedlist" id="UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd_orderedlist-idm43116814847660"><ol class="orderedlist" type="1"><li class="listitem"><p>Sign in to the AWS Management Console and open the AWS Key Management Service (AWS KMS) console at <a class="link" href="https://console.aws.amazon.com/kms" target="_blank" rel="noopener">https://console.aws.amazon.com/kms</a>.</p></li><li class="listitem"><p>To change the AWS Region, use the Region selector in the upper-right corner of the page.</p></li><li class="listitem"><p>In the navigation pane, choose <span class="bold bold"><strong>Customer managed keys</strong></span>.</p></li><li class="listitem"><p>Click the key that you used while creating a CloudTrail.</p></li><li class="listitem"><p>Under the <span class="bold bold"><strong>Key policy</strong></span> tab, click <span class="bold bold"><strong>Edit</strong></span>.</p></li><li class="listitem"><p>Enter the following piece of code to decrypt a CloudTrail log:</p><pre class="programlisting">{
    "Sid": "Enable cross account log decryption",
    "Effect": "Allow",
    "Principal": 
    {
        "AWS": "*"
    },
    "Action": 
    [
        "kms:Decrypt",
	"kms:ReEncryptFrom"
    ],
    "Resource": "*",
    "Condition": 
    {
        "StringEquals": 
	{
	    "kms:CallerAccount": "[account-id]"
	},
	"StringLike": 
	{
	    "kms:EncryptionContext:aws:cloudtrail:arn": "arn:aws:cloudtrail:*:[account-id]:trail/*"
	}
    }
}</pre><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Replace the <span class="emphasis"><em>[account-id]</em></span> parameter with the AWS account ID number. To find your AWS account ID number on the AWS Management Console, choose <span class="bold bold"><strong>Support</strong></span> on the navigation bar on the upper-right, and then choose <span class="bold bold"><strong>Support Center</strong></span>. Your currently signed-in account number (ID) appears in the <span class="bold bold"><strong>Support Center</strong></span> title bar.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Save changes</strong></span>.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp139862"><div class="titlepage"><div><div class="title"><h6 class="title">Create an AWS Instance in <span class="phrase">API-enabled Protection</span></h6></div></div></div><p>To create an AWS instance in <span class="phrase">API-enabled Protection</span>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the Netskope tenant UI.</p></li><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Settings &gt; <span class="phrase">API-enabled Protection</span> &gt; Cloud Infrastructure &gt; AWS &gt; Setup</strong></span>.</p></li><li class="listitem"><p>The <span class="bold bold"><strong>New Setup</strong></span> window opens. Enter the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>AWS Account Name: Enter a unique name of the AWS account.</p></li><li class="listitem"><p>Admin email: Enter the email address to receive email notification when a policy is triggered.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You can set a notification on the <span class="bold bold"><strong>Policies &gt; <span class="phrase">API-enabled Protection</span> &gt; NEW POLICY</strong></span> wizard page.</p></div></li><li class="listitem"><p>Connection Type:</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Few of the instance type options may be disabled. Contact your Netskope sales representative for additional information.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Audit Log Collection: Select this option to use your AWS CloudTrail to scan audit logs.</p></li></ul></div></li><li class="listitem"><p>Role: Enter the AWS resource name of IAM role you noted in step 21.</p></li><li class="listitem"><p>CloudTrail Name: To scan audit reports, enter the name of the CloudTrail created in step 7.</p></li><li class="listitem"><p>CloudTrail Region: To scan audit reports, enter the region code for the CloudTrail. To identify the region in the AWS console:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Log in to the <a class="link" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS console</a>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>AWS services</strong></span> page, go to <span class="bold bold"><strong>All Services &gt; Management Tools</strong></span> and click <span class="bold bold"><strong>CloudTrail</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Trails</strong></span>.</p></li><li class="listitem"><p>Hover the mouse over <span class="bold bold"><strong>All</strong></span> and note the region name.</p><div class="informalfigure"><div class="mediaobject image-center" style="text-align:center;"><img src="image/uuid-355bbc0e-d6d1-f6cf-f3a8-1d4fe6327314-en.png" style="" alt="AWSCloudTrailRegion.png"></img></div></div></li><li class="listitem"><p>Use this URL to determine the code associated with the region name:</p><p><a xml:lang="en" lang="en" dir="ltr" class="link" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions" target="_blank" rel="noopener">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions</a></p></li></ol></div></li></ul></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Save</strong></span>, then click <span class="bold bold"><strong>Grant Access</strong></span> for the AWS instance you just created.</p></li></ol></div><p>Refresh your browser, and you should see a green check icon next to the instance name. Netskope creates a subscription to the topic you created, and start receiving logs.</p></section></section><section xml:lang="en" lang="en" dir="ltr" class="section internal internal" data-origin-id="UUID-44ed26a0-a442-a9c5-ac0b-f363a736b035" data-time-modified="January 12, 2021" data-publication-date="" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3"><div class="titlepage"><div><div class="title"><h6 class="title">Configure AWS S3 for DLP Scanning and Threat Protection</h6></div></div></div><p>Adding the Netskope app to your AWS account has these requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create or have access to an existing S3 bucket, SNS topic, and CloudTrail service.</p></li><li class="listitem"><p>Create a role for Netskope to grant permissions.</p></li></ul></div><div dir="ltr" class="important"><h3 class="title">Important</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Till release 49, an S3 bucket would use the SNS topic to send S3 bucket-related notifications to Netskope. Starting from release 50, CloudTrail subscription uses the SNS topic to send S3 bucket-related notifications to Netskope. Due to this change, it is necessary to create or use an existing CloudTrail subscription. For more information, read the KB article located <a class="link" href="https://support.netskope.com/hc/en-us/articles/360002651454-Summary-of-the-AWS-Introspection-Configuration-Changes" target="_blank" rel="noopener">here</a>.</p></li><li class="listitem"><p>IaaS Storage Scan (DLP and Threat Protection) feature does not support quarantine and legal hold functionalities. If you have configured a DLP or Malware quarantine profile with an external storage provider such as OneDrive, the file would be copied to that location. However, the file would not be removed from its original location in the public cloud storage, AWS S3.</p></li></ul></div></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm45403305419792"><div class="titlepage"><div><div class="title"><h6 class="title">Configure an S3 Bucket, SNS Topic, and CloudTrail Service</h6></div></div></div><p>To configure AWS S3/CloudTrail for DLP scanning:</p><div class="orderedlist" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_orderedlist-idm43084328162530"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the Netskope tenant UI: <code class="literal">https://<span class="emphasis"><em>&lt;tenant hostname&gt;</em></span>.goskope.com</code> and navigate to <span class="bold bold"><strong>Settings &gt; <span class="phrase">API-enabled Protection</span> &gt; Cloud Infrastructure</strong></span>.</p></li><li class="listitem"><p>Select the <span class="bold bold"><strong>AWS</strong></span> icon, and then click <span class="bold bold"><strong>SETUP</strong></span>.</p><p>The <span class="bold bold"><strong>New Setup</strong></span> window opens.</p></li><li class="listitem"><p>Under <span class="bold bold"><strong>AWS Role</strong></span>, note the <span class="bold bold"><strong>Netskope Account ID</strong></span> and <span class="bold bold"><strong>Netskope External ID</strong></span>. You need to enter these into the AWS console in steps 11-12.</p></li><li class="listitem"><p>Log in to the <a class="link" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS console</a>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>AWS services</strong></span> page, navigate to <span class="bold bold"><strong>All Services &gt; Management Tools</strong></span> and click <span class="bold bold"><strong>CloudTrail</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Trails</strong></span>, and then click <span class="bold bold"><strong>Create trail</strong></span> (or select an existing trail).</p></li><li class="listitem"><p>For a new trail, enter these parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Trail name: Enter a unique name.</p></li><li class="listitem"><p>Apply trail to all regions: <span class="bold bold"><strong>Yes</strong></span></p></li><li class="listitem"><p>Management events &gt; Read/Write events: <span class="bold bold"><strong>All</strong></span></p></li><li class="listitem"><p>Enable data events for S3 bucket(s). To do so:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Navigate to the <span class="bold bold"><strong>Data events</strong></span> section and select the <span class="bold bold"><strong>S3</strong></span> tab.</p></li><li class="listitem"><p>Either select all S3 buckets in your account or add a specific S3 bucket.</p></li><li class="listitem"><p>Enable the <span class="bold bold"><strong>Read</strong></span> and <span class="bold bold"><strong>Write</strong></span> checkbox.</p></li></ol></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Additional charges may apply once you enable data events for S3 buckets. <a class="link" href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/logging-management-and-data-events-with-cloudtrail.html?icmpid=docs_cloudtrail_console#logging-data-events" target="_blank" rel="noopener">Learn more</a>. </p></div></li><li class="listitem"><p>Create a new S3 bucket: <span class="bold bold"><strong>Yes</strong></span></p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You can use an existing S3 bucket as an option.</p></div></li><li class="listitem"><p>S3 bucket: New S3 bucket where you would like your logs delivered. CloudTrail creates the bucket and applies the appropriate policy.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Advanced</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>(Optional) Encrypt log files with SSE-KMS: <span class="bold bold"><strong>Yes</strong></span></p><p id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_para-idm43121507090950">This step is optional. You can keep the default setting to <span class="bold bold"><strong>No</strong></span>. However, it is recommended you encrypt your CloudTrail log files to be CIS compliant.</p></li><li class="listitem"><p>(Optional) Create a new KMS key: You can either create a new KMS key or use an existing one.</p><div dir="ltr" class="note" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_note-idm43116644414226"><h3 class="title">Note</h3><p>If you use an existing KMS key, you should edit the policy of the customer managed key (CMK) to decrypt a CloudTrail log file. For more information, see <a class="xref" href="setting-up-aws-instances-using-old-ui.html#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm43121831236464" title="Permissions Required to Decrypt a CloudTrail Log File"><span class="xreftitle">Permissions Required to Decrypt a CloudTrail Log File</span></a>.</p></div></li><li class="listitem"><p>(Optional) KMS key: Based on the selection from the earlier step, you can either enter a new KMS key or select an existing key from the drop-down list.</p></li><li class="listitem"><p>Enable log file validation: <span class="bold bold"><strong>Yes</strong></span></p></li><li class="listitem"><p>Send SNS notification for every log file delivery: <span class="bold bold"><strong>Yes</strong></span></p></li><li class="listitem"><p>Create a new SNS topic: If you select <span class="bold bold"><strong>Yes</strong></span>, enter the new SNS topic name in the <span class="bold bold"><strong>SNS topic</strong></span> field in the next step. If you select <span class="bold bold"><strong>No</strong></span>, select an existing topic from the <span class="bold bold"><strong>SNS topic </strong></span> drop-down list in the next step.</p></li><li class="listitem"><p>SNS topic: Based on the selection from the earlier step, either enter a new SNS topic name or select an existing topic from the drop-down list.</p></li></ul></div><p>When finished, click <span class="bold bold"><strong>Create</strong></span>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Note the CloudTrail name and region you just created. You need to enter these in the Netskope UI when you create your AWS instance.</p></div></li></ul></div><p>Next, create a role for Netskope to grant permissions.</p></li><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Services &gt; Security, Identity &amp; Compliance</strong></span> and click <span class="bold bold"><strong>IAM</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Roles</strong></span> and then <span class="bold bold"><strong>Create role</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Select type of trusted entity</strong></span> page, select <span class="bold bold"><strong>Another AWS account</strong></span>.</p></li><li class="listitem"><p>Enter the account ID you noted from the Netskope UI in step 3.</p></li><li class="listitem"><p>Select the <span class="bold bold"><strong>Require external ID</strong></span> checkbox and enter the external ID you noted from the Netskope UI in step 3.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Leave the <span class="bold bold"><strong>Require MFA</strong></span> checkbox unchecked.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Next: Permissions</strong></span>.</p></li><li class="listitem" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_listitem-idm43116640877378"><p>In the <span class="bold bold"><strong>Attach permissions policies</strong></span> page, add the <span class="bold bold"><strong>SecurityAudit</strong></span> policy and click <span class="bold bold"><strong>Next: Tags</strong></span>.</p></li><li class="listitem" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_listitem-idm43116640897670"><p>In the <span class="bold bold"><strong>Add tags (optional)</strong></span> page, do not add any IAM tags and click <span class="bold bold"><strong>Next: Review</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Review</strong></span> page, enter a role name and then click <span class="bold bold"><strong>Create role</strong></span>.</p></li><li class="listitem"><p>After creating a role, you need to attach a policy to it. In the <span class="bold bold"><strong>Roles</strong></span> page, click on the role you just created.</p></li><li class="listitem"><p>On the <span class="bold bold"><strong>Permissions</strong></span> tab, click <span class="bold bold"><strong>+ Add inline policy</strong></span>. In the <span class="bold bold"><strong>Create Policy</strong></span> page, enter the following details:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>SNS</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>ConfirmSubscription</strong></span>, <span class="bold bold"><strong></strong></span><span class="bold bold"><strong>Subscribe</strong></span>, and <span class="bold bold"><strong>Unsubscribe</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>S3</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>GetBucketLocation</strong></span>, <span class="bold bold"><strong>GetObject</strong></span>, <span class="bold bold"><strong>GetObjectAcl</strong></span>, <span class="bold bold"><strong>ListAllMyBuckets</strong></span>, <span class="bold bold"><strong>ListBucket</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Resources</strong></span> field, select <span class="bold bold"><strong>All resources</strong></span>.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Add additional permissions</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Service</strong></span> drop-down list, select <span class="bold bold"><strong>CloudTrail</strong></span>.</p></li><li class="listitem"><p>From the <span class="bold bold"><strong>Actions</strong></span> drop-down list, select <span class="bold bold"><strong>DescribeTrails</strong></span> and <span class="bold bold"><strong>LookupEvents</strong></span>.</p></li></ol></div><p>The inline policy definition should look like this in JSON format. You can click the <span class="bold bold"><strong>JSON</strong></span> tab to view the policy script.</p><pre class="programlisting">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "VisualEditor0",
            "Effect": "Allow",
            "Action": [
                "s3:GetObjectAcl",
                "s3:GetObject",
                "cloudtrail:LookupEvents",
                "s3:ListAllMyBuckets",
                "sns:Unsubscribe",
                "s3:ListBucket",
                "sns:Subscribe",
                "sns:ConfirmSubscription",
                "s3:GetBucketLocation",
                "cloudtrail:DescribeTrails"
            ],
            "Resource": "*"
        }
    ]
}</pre></li><li class="listitem"><p>Click <span class="bold bold"><strong>Review policy</strong></span>.</p></li><li class="listitem"><p>Enter the name of the policy and click <span class="bold bold"><strong>Create Policy</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Summary</strong></span> page, copy the <span class="bold bold"><strong>Role ARN</strong></span> value. You need to enter this in the Netskope UI when you create your AWS instance.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm43121831236464"><div class="titlepage"><div><div class="title"><h6 class="title">Permissions Required to Decrypt a CloudTrail Log File</h6></div></div></div><p>You should edit the policy of the customer managed key (CMK) to ensure Netskope can decrypt the CloudTrail log files. Follow the instructions below.</p><div class="orderedlist" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_orderedlist-idm43116814847660"><ol class="orderedlist" type="1"><li class="listitem"><p>Sign in to the AWS Management Console and open the AWS Key Management Service (AWS KMS) console at <a class="link" href="https://console.aws.amazon.com/kms" target="_blank" rel="noopener">https://console.aws.amazon.com/kms</a>.</p></li><li class="listitem"><p>To change the AWS Region, use the Region selector in the upper-right corner of the page.</p></li><li class="listitem"><p>In the navigation pane, choose <span class="bold bold"><strong>Customer managed keys</strong></span>.</p></li><li class="listitem"><p>Click the key that you used while creating a CloudTrail.</p></li><li class="listitem"><p>Under the <span class="bold bold"><strong>Key policy</strong></span> tab, click <span class="bold bold"><strong>Edit</strong></span>.</p></li><li class="listitem"><p>Enter the following piece of code to decrypt a CloudTrail log:</p><pre class="programlisting">{
    "Sid": "Enable cross account log decryption",
    "Effect": "Allow",
    "Principal": 
    {
        "AWS": "*"
    },
    "Action": 
    [
        "kms:Decrypt",
	"kms:ReEncryptFrom"
    ],
    "Resource": "*",
    "Condition": 
    {
        "StringEquals": 
	{
	    "kms:CallerAccount": "[account-id]"
	},
	"StringLike": 
	{
	    "kms:EncryptionContext:aws:cloudtrail:arn": "arn:aws:cloudtrail:*:[account-id]:trail/*"
	}
    }
}</pre><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Replace the <span class="emphasis"><em>[account-id]</em></span> parameter with the AWS account ID number. To find your AWS account ID number on the AWS Management Console, choose <span class="bold bold"><strong>Support</strong></span> on the navigation bar on the upper-right, and then choose <span class="bold bold"><strong>Support Center</strong></span>. Your currently signed-in account number (ID) appears in the <span class="bold bold"><strong>Support Center</strong></span> title bar.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Save changes</strong></span>.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm45403303583472"><div class="titlepage"><div><div class="title"><h6 class="title">Handle Encrypted S3 Bucket</h6></div></div></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Netskope only supports SSE-S3 and SSE-KMS encryption modes for S3 buckets. This procedure should be followed only if your S3 buckets are encrypted with customer managed Key Management Service (KMS).</p></div><p>If your S3 buckets are encrypted with customer managed KMS, you should add the Netskope role (that you created in steps 8-18 above) to the key users. To do so, follow the steps below:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the <a class="link" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS console</a>.</p></li><li class="listitem"><p>In the AWS services page, navigate to <span class="bold bold"><strong>Services &gt; Security, Identity &amp; Compliance</strong></span> and click <span class="bold bold"><strong>IAM</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Encryption Keys</strong></span>.</p></li><li class="listitem"><p>On the left navigation bar, click <span class="bold bold"><strong>Customer managed keys</strong></span>.</p></li><li class="listitem"><p>Locate the KMS key used to encrypt the S3 bucket.</p></li><li class="listitem"><p>Add the Netskope role (that you created in step 16 above) to the key users.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140206"><div class="titlepage"><div><div class="title"><h6 class="title">Create an AWS Instance in <span class="phrase">API-enabled Protection</span></h6></div></div></div><p>To create an AWS instance in <span class="phrase">API-enabled Protection</span>:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to the Netskope tenant UI.</p></li><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Settings &gt; <span class="phrase">API-enabled Protection</span> &gt; Cloud Infrastructure &gt; AWS &gt; SETUP</strong></span>.</p></li><li class="listitem"><p>The <span class="bold bold"><strong>New Setup</strong></span> window opens. Enter the following parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>AWS Account Name: Enter a unique name of the AWS account.</p></li><li class="listitem"><p>Admin email: Enter the email address to receive email notification when a policy is triggered.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You can set a notification on the <span class="bold bold"><strong>Policies &gt; <span class="phrase">API-enabled Protection</span> &gt; NEW POLICY</strong></span> wizard page.</p></div></li><li class="listitem"><p>Connection Type:</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Few of the instance type options may be disabled. Contact your Netskope sales representative for additional information.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>DLP for S3: Select this option to scan files in your S3 buckets.</p></li><li class="listitem"><p>Threat Protection: Select this option to scan S3 buckets for malware. You can select this option only if you have selected <span class="bold bold"><strong>DLP for S3</strong></span>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The Threat Protection feature is optional. Select this option if you intend to scan S3 buckets for malware. You can view the malware alerts in <span class="bold bold"><strong>SkopeIT &gt; Alerts</strong></span> and <span class="bold bold"><strong>Incidents &gt; Malware</strong></span> pages.</p></div></li></ul></div></li><li class="listitem"><p>Role: Enter the AWS resource name of IAM role you copied in step 21.</p></li><li class="listitem"><p>CloudTrail Name: To scan audit reports, enter the name of the CloudTrail created in step 7.</p></li><li class="listitem"><p>CloudTrail Region: To scan audit reports, enter the region code for the CloudTrail. To identify the region in the AWS console:</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Log in to the <a class="link" href="https://aws.amazon.com/console/" target="_blank" rel="noopener">AWS console</a>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>AWS services</strong></span> page, navigate to <span class="bold bold"><strong>All Services &gt; Management Tools</strong></span> and click<span class="bold bold"><strong>CloudTrail</strong></span>.</p></li><li class="listitem"><p>In the left navigation bar, click <span class="bold bold"><strong>Trails</strong></span>.</p></li><li class="listitem"><p>Hover the mouse over <span class="bold bold"><strong>All</strong></span> and note the region name.</p><div class="mediaobject image-left" style="text-align:left;"><img src="image/uuid-355bbc0e-d6d1-f6cf-f3a8-1d4fe6327314-en.png" style="" alt="AWSCloudTrailRegion.png"></img></div></li><li class="listitem"><p>Use this URL to determine the code associated with the region name:</p><p><a xml:lang="en" lang="en" dir="ltr" class="link" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions" target="_blank" rel="noopener">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions</a></p></li></ol></div></li></ul></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>Save</strong></span>, then click <span class="bold bold"><strong>Grant Access</strong></span> for the AWS instance you just created.</p></li></ol></div><p>Refresh your browser, and you should see a green check icon next to the instance name. <span class="phrase">API-enabled Protection</span> DLP scans can be performed in AWS S3 buckets. Navigate to the <span class="bold bold"><strong>Policies &gt; <span class="phrase">API-enabled Protection</span></strong></span> page, and from here you can select the AWS instance created and perform DLP for all regions, specific regions, or targeted to specific buckets in a region.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>AWS S3 DLP violations do not have a dedicated <span class="phrase">API-enabled Protection</span> dashboard; administrators and select users receive email alerts specified in the policy, as well as SkopeIT alerts and through Incident Management.</p></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-5d75cfe0bca10-idm45107321580000"><div class="titlepage"><div><div class="title"><h6 class="title">What Triggers a Scan and Billing of AWS S3 Bucket?</h6></div></div></div><p>Storage scan is billed against number of bytes scanned by DLP and/or malware services. In case of AWS S3 bucket, scanning of an object is triggered in the following scenarios:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Uploading and/or reuploading a file to an S3 bucket which has policies configured for DLP and/or malware scans, using AWS CLI, AWS console, or API call <code class="code">({{'PostObject', 'RestoreObject', 'PutObject', 'PutObjectAcl', 'CopyObject', 'CreateMultipartUpload', 'UploadPart', 'UploadPartCopy', 'CompleteMultipartUpload' }})</code> programmatically.</p></li><li class="listitem"><p>Renaming a file in an S3 bucket which has policies configured for DLP and/or malware scans, using AWS CLI, or AWS console.</p></li></ul></div><p>In the above cases, scan occurs irrespective of whether the file/object has changed or not.</p><p>For an S3 bucket, there is no other case when a scan is performed. Cases where scan is not performed include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Changing object metadata like tags or access control policies.</p></li><li class="listitem"><p>Deleting an object from an S3 bucket.</p></li><li class="listitem"><p>Reading object using AWS CLI, console or API call (like <code class="code">GetObject API</code>) programmatically.</p></li><li class="listitem"><p>Uploading and/or reuploading a file to an S3 bucket which has no policies configured for DLP and/or malware scans.</p></li></ul></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-51ecdfec-5adf-0cad-8c00-9a87195045bd" data-time-modified="September 30, 2020" data-publication-date="" id="UUID-f9459cb2-a7e4-4641-46f3-58f1648b9faa"><div class="titlepage"><div><div class="title"><h6 class="title">Create an <span class="phrase">API-enabled Protection</span> Policy</h6></div></div></div><p>To discover existing data residing within your sanctioned cloud services, create an <span class="phrase">API-enabled Protection</span> policy with the desired options and actions. The Netskope UI guides you through the process of configuring policies for each of your cloud apps on a single web page.</p><p>Cloud apps have unique features, so the policy options vary depending on the app you select on the top of the page. Choose the topic below for the app API connector you have configured.</p><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-2da3424b-6fe8-40d9-60a1-f04e204bcfa8" data-time-modified="June 20, 2019" data-publication-date="" id="UUID-df8c50eb-27b9-ea2c-3e80-b8468c9306f8"><div class="titlepage"><div><div class="title"><h6 class="title">Application</h6></div></div></div><p>To configure an <span class="phrase"></span><span class="phrase">API-enabled Protection</span> policy:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In the Netskope UI, go to <span class="bold bold"><strong>Policies &gt; <span class="phrase"></span><span class="phrase">API-enabled Protection</span></strong></span> and click <span class="bold bold"><strong>New Policy</strong></span>.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong>Application</strong></span> section, select the app. </p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you select <span class="bold bold"><strong>Google Drive</strong></span> as the application type, the administrator has an option to scan Content or Connected Apps/Plugins.</p></div></li><li class="listitem"><p>In the <span class="bold bold"><strong>Instance</strong></span> section, select the app instance for the policy.</p></li><li class="listitem"><p>Click <span class="bold bold"><strong>Next</strong></span>, and then go to the topic in this guide that matches the section you're configuring on the New <span class="phrase"></span><span class="phrase">API-enabled Protection</span> Policy page.</p></li></ol></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-df8c50eb-27b9-ea2c-3e80-b8468c9306f8_section-5ce745415675d-idm45444631317136"><div class="titlepage"><div><div class="title"><h6 class="title">Office 365 SharePoint Limitation</h6></div></div></div><p>For Office 365 SharePoint application, when a policy is created on a parent site, it is not applied on the content in a sub-site under the parent site. If a policy has to be applied on sub-sites, you have to explicitly select in the policy.</p></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-52ad15db-3402-78a8-888f-9fabe8a30117" data-time-modified="June 21, 2019" data-publication-date="" id="UUID-b6d492a6-9e0b-cf2e-bcd2-b1c5c18ce31c"><div class="titlepage"><div><div class="title"><h6 class="title">Resource</h6></div></div></div><p>This section of the <span class="phrase"></span><span class="phrase">API-enabled Protection</span> Policy page specifies the AWS and Microsoft Azure resources that will be scanned for a policy violation. The section is only for the AWS and Azure apps. </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Select <span class="bold bold"><strong>All S3 Buckets</strong></span> or <span class="bold bold"><strong>Subset of S3 Buckets</strong></span> from the <span class="bold bold"><strong>Resources</strong></span> section.</p></li><li class="listitem"><p>Select <span class="bold bold"><strong>All Storage Accounts</strong></span> or <span class="bold bold"><strong>Subset of Storage Accounts</strong></span> from the <span class="bold bold"><strong>Resources</strong></span> section.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Netskope supports General-purpose v2 (GPv2) and Blob storage accounts for Azure. If you select the <span class="bold bold"><strong>Subset of Storage Accounts</strong></span> option, only the GPv2 and Blob storage accounts are listed. General-purpose v1 (GPv1) accounts are not listed.</p></div></li><li class="listitem"><p>For a subset of S3 buckets, first select the region from the drop-down list, and then select the bucket(s). When finished, click <span class="bold bold"><strong>Next</strong></span>.</p></li><li class="listitem"><p>For a subset of storage accounts, first select the storage account from the drop-down list, and then select the resource(s). When finished, click <span class="bold bold"><strong>Next</strong></span>.</p></li></ol></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-b47d653d-0485-6d5c-e051-692ac6783252" data-time-modified="January 21, 2021" data-publication-date="" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535"><div class="titlepage"><div><div class="title"><h6 class="title">Content</h6></div></div></div><p>This section of the <span class="phrase">API-enabled Protection</span> Policy page specifies files, objects, and messages that trigger a policy violation.</p><p>For AWS, select <span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p><p>For Azure, select <span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p><p>For Box, you can select one of the following options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public, shared internally, and shared externally.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Public, Shared Internally, or Shared Externally.</p><p>For Shared Externally, you can select all or specific external domains if they have been configured for the app chosen on the instance page. To set thresholds for when content sharing triggers a policy violation, select <span class="bold bold"><strong>Advanced Options</strong></span> and enter the number of internal or external collaborators that need to be detected for a policy violation to occur.</p></li><li class="listitem"><p><span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>For Cisco Webex Teams, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094877302220"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, shared internally, and shared externally.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Shared Internally, or Shared Externally.</p><p>For Shared Externally, you can select all or specific organizations if they have been configured for the app chosen on the instance page.</p></li></ul></div><p>For Dropbox, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094880722344"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public, shared internally, and shared externally.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Public, Shared Internally, or Shared Externally.</p><p>For Shared Externally, you can select all or specific external domains if they have been configured for the app chosen on the instance page. To set thresholds for when content sharing triggers a policy violation, select <span class="bold bold"><strong>Advanced Options</strong></span> and enter the number of internal or external collaborators that need to be detected for a policy violation to occur.</p></li><li class="listitem"><p><span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>For Workplace by Facebook, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094881395282"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans internally and externally shared posts, comments, replies, chat messages, and attachments.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, internal and/or external.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Internal: Scans posts, comments, replies, chat messages, and attachments shared within the workplace organization.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The Internal sharing option is not available for multi-company groups.</p></div></li><li class="listitem"><p>External: Scans posts, comments, replies, chat messages, and attachments shared outside the workplace organization like a multi-company group. For external sharing type, you can select all or specific external domains if they have been configured.</p></li></ul></div></li><li class="listitem"><p><span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>For Google Drive, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094882945082"><p>FILES SHARING OPTIONS TO SCAN</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public, shared internally, shared externally, and enterprise shared.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Public, Shared Internally, Shared Externally, Enterprise Shared, or Anyone at Enterprise wirth the Link.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><div class="itemizedlist"><ul style="list-style-type: circle; " class="itemizedlist"><li class="listitem"><p>What is Enterprise Shared? Any file that is shared within the same organization but belongs to different sub-domain(s).</p></li><li class="listitem"><p>What is Anyone at Enterprise with the Link? Any file that is shared with any user within an organization but belonging to a different sub-domain(s) of an enterprise.</p></li><li class="listitem"><p>The Private and Shared Internally options are not available for Google Team Drive.</p></li></ul></div></div><p>For Public, you can select:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094883324614"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Public - Indexed and Unlisted: Any file that is shared publicly be it indexed or unlisted.</p></li><li class="listitem"><p>Public - Indexed Only: Any file that is shared publicly and searchable on Google search.</p></li><li class="listitem"><p>Public - Unlisted Only: Any file that is has a public sharing link but not listed on Google search.</p></li></ul></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>In Google Drive, files that are publicly shared may not be opened if the Google administrator has set the sharing setting to off in the Google admin console. This setting is located under <span class="bold bold"><strong>Apps &gt; Google Workspace &gt; Drives and Docs &gt; Sharing Settings &gt; Sharing options &gt; Sharing outside of &lt;organization&gt;</strong></span>. This discrepancy occurs because the Google API tags the file exposure as public, however the file has access restrictions due to the <span class="bold bold"><strong>Sharing outside of &lt;organization&gt;</strong></span> setting set to off.</p></div><p>For Shared Externally, you can select all or specific external domains if they have been configured for the app chosen on the instance page.</p><p>To set thresholds for when content sharing triggers a policy violation, select <span class="bold bold"><strong>Advanced Options</strong></span> and enter the number of internal or external collaborators that need to be detected for a policy violation to occur.</p></li></ul></div><div class="itemizedlist"><p>FILE TYPES TO SCAN</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>For Microsoft Office 365 <span class="phrase">OneDrive for Business</span><span class="phrase">SharePoint Sites</span>, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094884634428"><p>FILES SHARING OPTIONS TO SCAN</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public, shared internally, shared externally, and cross-geo.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_listitem-idm43181144274826"><p>Private: A file not shared with anyone.</p></li><li class="listitem"><p>Public: A file that is shared or open to public.</p></li><li class="listitem" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_listitem-idm43181144410298"><p>Shared internally: A file shared specifically with users within the same sub-domain of the organization.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you share a file with an internal user who is in a different geo location, the file will be classified as 'Cross-geo' instead of 'Internal'.</p></div></li><li class="listitem" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_listitem-idm43181144443804"><p>Shared externally: A file shared specifically with users outside the organization. You can select all or specific external domains if they have been configured for the app. You can create a new domain by selecting the <span class="bold bold"><strong>Create New</strong></span> option.</p></li><li class="listitem" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_listitem-idm43181144488488"><p>Cross-geo: A file shared between geo locations in an Office 365 multi-geo environment.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you do not see the cross-geo file sharing option, ensure that the multi-geo capability is enabled on your Microsoft Office 365 account.</p></div></li><li class="listitem"><p>Shared with Group(s): A file shared directly with a specific named group. A shared group can be a combination of internal and external users. This list is fetched from your Microsoft Office 365 Admin Center's <span class="bold bold"><strong>Groups &gt; Active Groups</strong></span>. Only Microsoft 365, mail-enabled security, and security group types are supported.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you share a file with individual users in the selected group, <span class="phrase">API-enabled Protection</span> will not count it as a match.</p></div></li></ul></div><p>To set thresholds for when content sharing triggers a policy violation, select <span class="bold bold"><strong>Advanced Options</strong></span> and enter the number of internal, cross-geo, or external collaborators that need to be detected for a policy violation to occur. If you share a file with a Microsoft 365 group, <span class="phrase">API-enabled Protection</span> can expand the group, identify the number of users and apply the threshold limit. However, there are a few important points to note:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="phrase">API-enabled Protection</span> does not support expansion of a distribution group.</p></li><li class="listitem"><p><span class="phrase">API-enabled Protection</span> does not support the expansion of a sub-group. If a Microsoft 365 group contains a sub-group (group within a group), <span class="phrase">API-enabled Protection</span> does not expand the sub-group. The sub-group is considered as a single internal or external user.</p></li><li class="listitem"><p>Owner of a group does not get access to the files shared to the group, and hence <span class="phrase">API-enabled Protection</span> does not count an owner as a member.</p></li><li class="listitem"><p>If a file is shared with two groups and user 'x' belongs to both the groups, <span class="phrase">API-enabled Protection</span> counts this user only once.</p></li><li class="listitem"><p>Cross-geo users in any group will be treated as internal users. If a Microsoft 365 group contains a cross-geo user (user in another satellite location), <span class="phrase">API-enabled Protection</span> treats such a user as an internal user during group expansion.</p></li></ul></div></li></ul></div><div class="itemizedlist"><p>FILE TYPES TO SCAN</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>Microsoft Office 365 does not trigger events notification for sharing link activities. Netskope retrieves these via polling mechanism after subsequent events. This may cause delays in processing shared links in <span class="phrase">OneDrive</span><span class="phrase">SharePoint</span>.</p><p>For Salesforce, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094884955612"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public, and shared internally.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Public, and Shared Internally.</p><p>To set thresholds for when content sharing triggers a policy violation, select <span class="bold bold"><strong>Advanced Options</strong></span> and enter the number of internal collaborators that need to be detected for a policy violation to occur.</p></li><li class="listitem"><p><span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>For ServiceNow, click <span class="bold bold"><strong>SELECT OBJECTS</strong></span> to select the object to scan. Then, select the data type; <span class="bold bold"><strong>Fields</strong></span> and/or <span class="bold bold"><strong>Attachment</strong></span>. You must select select object(s) if you check the <span class="bold bold"><strong>Fields</strong></span> checkbox. The following table lists the fields that support and do not support DLP scans:</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><thead><tr><th class="th" data-priority="1"><p>ServiceNow Table</p></th><th class="th" data-priority="1"><p>Supported Fields</p></th><th class="th" data-priority="1"><p>Non-Supported Fields*</p></th></tr></thead><tbody><tr><td class="td"><p>Incident</p></td><td class="td"><p>Short description</p></td><td class="td"><p>Additional comments</p></td></tr><tr><td rowspan="3" class="td"><p>Problem</p></td><td class="td"><p>Short description</p></td><td class="td"><p>Workaround</p></td></tr><tr><td class="td"><p>Description</p></td><td class="td"><p>Work notes</p></td></tr><tr><td class="td"><p>Close notes</p></td><td class="td"><p>-</p></td></tr></tbody></table></div><p>*Due to the ServiceNow API limitations, Netskope cannot perform DLP scans on the non-supported fields.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Netskope can perform DLP scan on files attached to the ServiceNow Incident and Problem tables.</p></div><p>For Slack, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094886663298"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public (files only), shared internally, and shared externally.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Public (files only), Shared Internally, or Shared Externally (All External Domains).</p></li><li class="listitem"><p>Under <span class="bold bold"><strong>Content Type</strong></span>, select <span class="bold bold"><strong>Messages</strong></span> and/or <span class="bold bold"><strong>Files</strong></span>. If you select the <span class="bold bold"><strong>Files</strong></span> option, you can select <span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><p>For Slack for Enterprise, you can select one of the following options:</p><div class="itemizedlist" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_itemizedlist-idm43094887567418"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>All Sharing Options</strong></span>: Scans all sharing options like private, public (files only), shared internally, and shared externally.</p></li><li class="listitem"><p><span class="bold bold"><strong>Specific Sharing Options</strong></span>: With specific sharing options, you can choose all or specific sharing types, like Private, Public (files only), Shared Internally, or Shared Externally (All External Domains).</p></li><li class="listitem"><p>Under <span class="bold bold"><strong>Content Type</strong></span>, select <span class="bold bold"><strong>Messages</strong></span> and/or <span class="bold bold"><strong>Files</strong></span>. If you select the <span class="bold bold"><strong>Files</strong></span> option, you can select <span class="bold bold"><strong>All File Types</strong></span> or <span class="bold bold"><strong>Specific File Types</strong></span> to scan.</p></li></ul></div><section dir="ltr" class="section internal internal" data-origin-id="" data-publication-date="" id="UUID-68d06d68-fe73-75e4-f030-c16baa094535_section-idm43094881080674"><div class="titlepage"><div><div class="title"><h6 class="title">Support Folder-based Policies for Egnyte</h6></div></div></div><p>In Egnyte, shared/team folders can be created by an administrator only. An administrator can add collaborators to folders. Folders are separated in two categories:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Team folder: Can be created by an administrator only.</p></li><li class="listitem"><p>Personal folder: Can be created by a user. This folder is the private folder of a user.</p></li></ul></div><p>With this feature, administrators can create policies to handle either team, personal folder, or both.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>In <span class="phrase">API-enabled Protection</span>, shared folder (in Egnyte) is termed as team folder.</p></div><p>Following are the use cases for Egnyte:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A policy can be applied to all users, all folders, or select team or all personal folders.</p></li><li class="listitem"><p>A policy can be applied to a subset of users and all team folders or subset of folders. When you choose subset of folders, team folders and personal folders are shown separately. List of team folders have all the team folders irrespective of users selected; for personal folders, only the selected users' folders are shown.</p></li><li class="listitem"><p>A policy can be applied based on a matching folder name. You can enter a matching string. If the string matches with the folder name, the policy is triggered. For example, if a user has applied a policy on the folder name called <span class="italic italic">Case</span>, the policy will be triggered for all folders in the Egnyte app with the name <span class="italic italic">Case</span>. The policy will not be triggered for a folder name <span class="italic italic">Case Sensitive</span>.</p></li></ul></div><p>Prior to release 48, folder selection was part of Users &gt; Subset of Users policy workflow. In release 48, folder selection is separated out from users. Folders to Scan option is part of Content policy workflow. This option has the following choices:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>All Folders: With this option, all folders irrespective of team or personal are scanned.</p></li><li class="listitem"><p>Select Folders: With this option, additional options are available; Team Folders and Personal Folders. You can select team, personal folders, or both for scanning.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you select <span class="bold bold"><strong>All Users</strong></span>, <span class="bold bold"><strong>User Profiles</strong></span>, or <span class="bold bold"><strong>User Groups</strong></span> from the Users policy workflow, you can only select all personal folders. You cannot select subset of personal folders.</p></div></li><li class="listitem"><p>Match Folder Name In: With this option, you can enter a string matching the Egnyte app folder name. The string is matched with the folder name in either all folders, all team folders, or all personal folders. Based on a folder name match, the policy is triggered.</p></li></ul></div><p>When finished, click <span class="bold bold"><strong>Next</strong></span>, and then go to the topic in this guide that matches the section you're configuring on the New <span class="phrase">API-enabled Protection</span> Policy page.</p></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-618977bb-4d93-0ec2-c38d-0ff6311293ef" data-time-modified="December 10, 2020" data-publication-date="" id="UUID-9646990c-3f74-1c77-54e2-2c0797682c81"><div class="titlepage"><div><div class="title"><h6 class="title">DLP</h6></div></div></div><p>This section of the <span class="phrase">API-enabled Protection</span> Policy page specifies the type of DLP profile that triggers a policy violation.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>To use a data loss prevention (DLP) profile, select <span class="bold bold"><strong>DLP</strong></span> and click <span class="bold bold"><strong>Select Profile</strong></span>. Search for a DLP profile or choose one from the list, which includes both predefined and custom profiles. After selecting a DLP profile, click <span class="bold bold"><strong>Save</strong></span>.</p></li><li class="listitem"><p>When finished, click <span class="bold bold"><strong>Next</strong></span>.</p></li></ol></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Enabling DLP will evaluate files only. All structured data will be ignored for this policy. To evaluate all structured data, disable DLP.</p></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Microsoft does not provide any webhook notification for files uploaded through the files and wiki tab of Microsoft Teams. Due to this limitation, Netskope does not support DLP scanning for such file uploads. However, Netskope detects files sent as an attachment from a channel's chat window.</p></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Netskope does not scan emails in deleted/trash folder. Netskope will continue to scan emails in sent folder.</p></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-39d9b237-362b-f38f-0943-55714e2713b5" data-time-modified="August 20, 2020" data-publication-date="" id="UUID-1f86af4d-d769-4dff-9659-4db2f2269e4b"><div class="titlepage"><div><div class="title"><h6 class="title">Action</h6></div></div></div><p>This section of the <span class="phrase">API-enabled Protection</span> Policy page specifies the action to be taken when a policy violation occurs. The actions vary depending on the app chosen. For some apps, the only action is alert. Similarly, restrict access options vary depending on the app chosen.</p><p></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Select the action you want to take from the drop-down list, like Alert, Block, Change Ownership, Restrict Access, Encrypt, Delete, Quarantine, Legal Hold, Restrict Sharing to View, Apply Azure RMS Template, Data Classification, Disable Print and Download, or IRM Protect. </p><div dir="ltr" class="note"><h3 class="title">Note</h3><div class="itemizedlist"><ul style="list-style-type: disc; " class="itemizedlist"><li class="listitem"><p>Alert and Block Access actions are available for Microsoft Office 365 Teams.</p></li><li class="listitem"><p>The <span class="bold bold"><strong>Disable Print and Download</strong></span> action applies to Google users who have comment and view file permissions. Users with edit permissions on a file can continue to print and download the file.</p></li><li class="listitem"><p>Alert, Delete, Legal Hold, and Quarantine actions are available for Slack for Enterprise.</p></li><li class="listitem"><p>The alert action is available for ServiceNow.</p></li><li class="listitem"><p id="UUID-1f86af4d-d769-4dff-9659-4db2f2269e4b_para-idm43071192016752">In case of Workplace by Facebook, <span class="bold bold"><strong>Delete</strong></span> action applies to posts/comments only.</p></li><li class="listitem"><p>The <span class="bold bold"><strong>Data Classification</strong></span> option is disabled by default. To enable this option, contact Netskope Support. To know more about this option, refer to the <span class="bold bold"><strong>Security Classification on Box</strong></span> section below.</p></li><li class="listitem"><p id="UUID-1f86af4d-d769-4dff-9659-4db2f2269e4b_para-idm43071192117380">For a list of supported actions per cloud app, refer to <a class="xref" href="api-enabled-protection-overview.html#UUID-2c337e74-97f2-fb84-34c2-3a452731341d" title="API-enabled Protection Policy Actions per Cloud App"><span class="xreftitle"><span class="phrase">API-enabled Protection</span> Policy Actions per Cloud App</span></a>. </p></li></ul></div></div><p>For some actions, like Restrict Access, you can select additional options from the adjacent drop-down list. For example, if you selected Specific Sharing Options and Shared Externally in the Content section, then the option to <span class="phrase">allowlist</span> or <span class="phrase">blocklist</span>an External Domain appears in the drop-down list.</p><p>For Microsoft Office 365 OneDrive for Business and SharePoint Sites apps, you can select the <span class="bold bold"><strong>Restrict Access</strong></span> option from the adjacent drop-down list. The <span class="bold bold"><strong>Restrict Access Levels</strong></span> are Owner, Remove Public Links, Remove Individual Users, and Remove Organization Wide Link.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>In SharePoint, the <span class="bold bold"><strong>Restrict Access to Owner</strong></span> action retains access to site owner(s) and site member(s). All other visitors and shared users/groups access are revoked.</p></div></li><li class="listitem"><p>Select the action as <span class="bold bold"><strong>IRM Protect</strong></span> from the drop-down list and select <span class="bold bold"><strong>Vera</strong></span> <span class="phrase">or <span class="bold bold"><strong>MIP</strong></span></span> as the IRM vendor.<span class="phrase"> If you select MIP, you have to select an <span class="bold bold"><strong>MIP Profile</strong></span>.</span></p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Before you create an IRM policy, you should create a Vera<span class="phrase"> or MIP</span> instance. For more information, see ???<span class="phrase"> or ???</span>.</p></div></li><li class="listitem"><p>Select the available action and click <span class="bold bold"><strong>Next</strong></span>.</p><p></p></li><li class="listitem"><p>For Quarantine, select an existing quarantine profile from list, or create a new one. Click <span class="bold bold"><strong>New Quarantine Profile</strong></span> from the drop-down list to create a new quarantine profile for this policy. A DLP profile must be selected in section to use Quarantine. In Create Quarantine Profile wizard, complete the Settings, Customize, and Set Profile pages. When finished, click <span class="bold bold"><strong>Create Quarantine Profile</strong></span>. When finished, click <span class="bold bold"><strong>Next</strong></span>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Encrypted files sent to the quarantine folder is limited to 20 MB in size.</p></div><p>When a file is sent to the quarantine folder, an email is sent to the approver and another is sent to the user with the appropriate coaching messages. </p></li><li class="listitem"><p>For Legal Hold, choose an existing profile from the drop-down list or click <span class="bold bold"><strong> Create New</strong></span>. The <span class="bold bold"><strong>CREATE LEGAL HOLD PROFILE</strong></span> wizard opens. For more information, refer to the Legal Hold section of <a class="link" href="profiles.html" title="Profiles">Profiles</a>. When files are placed in legal hold, emails are sent to the custodian and the users who created the files. When finished, click <span class="bold bold"><strong>Next</strong></span>.</p></li></ol></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140773"><div class="titlepage"><div><div class="title"><h6 class="title">Security Classification on Box</h6></div></div></div><p>Security classification on Box is a feature that enables customers to classify files based on their confidentiality and enforce security policies associated with that confidentiality level. This helps organizations protect sensitive information and encourage smarter user behavior when handling that content.</p><p><span class="phrase">API-enabled Protection</span> helps in automating the content classification for organizations. The feature leverages Netskope's DLP engine to identify sensitive data and classify the user's content automatically. Netskope introduces a new policy action called <span class="bold bold"><strong>Data Classification</strong></span>. Like any other policy action, a user can set up the data classification, to classify sensitive files. There are three file classification options: confidential, internal only, and unrestricted. You can drill further down and set priority for the file classification. There are three priority options: P0, P1, and P2. Priorities can be set in order of importance with P0 being the highest priority followed by P1 and P2. This option is disabled by default as it requires <span class="phrase">API-enabled Protection</span> to make additional API calls to Box for each file classification. To enable this feature, there are two steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Make sure you enable the file classification feature on your Box account. Refer to this article to enable this feature on Box: <a class="link" href="https://community.box.com/t5/Using-Box-Governance-Features/Using-Security-Classifications-with-Box-Governance/ta-p/21276" target="_blank" rel="noopener">https://community.box.com/t5/Using-Box-Governance-Features/Using-Security-Classifications-with-Box-Governance/ta-p/21276</a>.</p></li><li class="listitem"><p>Once activated on your Box account, contact Netskope Support to enable on your Netskope tenant.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140787"><div class="titlepage"><div><div class="title"><h6 class="title">File Collaboration on Box</h6></div></div></div><p>To improve collaboration, Box supports inviting collaborators to edit individual files. Previously, users needed to be invited to the file's parent folder to edit a single file. There is a new invite/add collaborators option at the file level. Once invited, the collaborator has editor or viewer permission. All enterprise and folder-level settings related to collaboration are inherited to file-level collaboration.</p><p>If a file has an internal collaborator, Box tags the file as internally shared. Similarly, if a file has external collaborators i.e., a user outside the Box enterprise, Box tags the file as externally shared. Netskope calculates the file exposure based on the file and parent-level collaboration.</p><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-1f86af4d-d769-4dff-9659-4db2f2269e4b_section-5cb53d42695bf-idm45410781617440"><div class="titlepage"><div><div class="title"><h6 class="title">Impact on Restrict Access Policy Action</h6></div></div></div><p>If the administrator applies the restrict access policy action, Netskope removes the folder and file-level collaborators.</p></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-1f86af4d-d769-4dff-9659-4db2f2269e4b_section-5cb547d78824a-idm45410781584304"><div class="titlepage"><div><div class="title"><h6 class="title">Impact on Restrict Sharing to View Policy Action</h6></div></div></div><p>If the administrator applies the restrict sharing to view policy action, Netskope restricts the access level of a collaborator of the file and the collaborator inherited from the parent folder to view only.</p></section></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140797"><div class="titlepage"><div><div class="title"><h6 class="title">Restrict Access to Domain and User Profiles</h6></div></div></div><p>Up until release 47, <span class="phrase">allowlist</span> and <span class="phrase">blocklist</span> domain profiles under Restrict Access were linked to the domain profiles under <span class="bold bold"><strong>Content &gt; File Sharing Options to Scan</strong></span> policy workflow. These two are independent of each other. An administrator access based on domain profiles. In addition, administrators can now allow (<span class="phrase">allowlist</span>) or deny (<span class="phrase">blocklist</span>) certain users (user profile) from accessing files and folders.</p><p>Before restricting access to a domain or user profile, you need to create the profile from the <span class="bold bold"><strong>Policies &gt; Profiles</strong></span> page. Once the profile is created, they get listed as part of the Restrict Access action. Restrict Access is available as part of the Action policy workflow. You must select <span class="bold bold"><strong>Restrict</strong></span> to select <span class="bold bold"><strong><span class="phrase">Allowlist</span> Domains</strong></span>, <span class="bold bold"><strong><span class="phrase">Blocklist</span> Domains</strong></span>, <span class="bold bold"><strong><span class="phrase">Allowlist</span> User </strong></span>, or <span class="bold bold"><strong><span class="phrase">Blocklist</span> User </strong></span> from the Restrict Access Level drop-down list. Based on the choice, the Domain Profile or User Profile dropdown list is displayed.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>In <span class="bold bold"><strong>Contents &gt; File Sharing Options to Scan</strong></span>, if you select <span class="bold bold"><strong>Specific Sharing Options &gt; Private</strong></span>, the <span class="bold bold"><strong>Restrict Access</strong></span> option is not available under <span class="bold bold"><strong>Actions</strong></span>.</p></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140822"><div class="titlepage"><div><div class="title"><h6 class="title">Azure RMS Template</h6></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Go to <span class="bold bold"><strong> Policies &gt; <span class="phrase">API-enabled Protection</span></strong></span> and click <span class="bold bold"><strong>New Policy</strong></span>.</p></li><li class="listitem"><p>Configure the policy workflow till DLP.</p></li><li class="listitem"><p>In the <span class="bold bold"><strong> Action </strong></span> section, select <span class="bold bold"><strong> Apply Azure RMS Template </strong></span> from the Action drop-down list and <span class="bold bold"><strong> RMS template </strong></span> from the Azure RMS Template drop-down list.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>In Azure, if a template is created with scope, RMS super user should be part of the scope, if not, the RMS template will not populate under the Azure RMS Template drop-down list.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong> Next </strong></span> and then go to the topic in this guide that matches the section you're configuring on the <span class="phrase">API-enabled Protection</span> Policy page.</p></li></ol></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140843"><div class="titlepage"><div><div class="title"><h6 class="title">Egnyte Policy Action</h6></div></div></div><p>Admin and power users can use a link to share one or more files users. When you share a file link in Egnyte, the recipient receives containing the URL of the file. Clicking the URL downloads the file. need not be an Egnyte user. If a user belongs to a <span class="phrase">blocklist</span> user profile, Netskope removes the shared link for all users irrespective user/domain profile. A couple of used cases to be noted:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If a user has shared a file with <span class="italic italic">a.com</span>, followed by <span class="italic italic">b.com</span> domain users at a time difference, restrict access to <span class="phrase">blocklist</span> <span class="italic italic">a.com</span> domain denies access to <span class="italic italic">a.com</span> domain users only. <span class="italic italic">B.com</span> domain users can continue to access the file.</p></li><li class="listitem"><p>If a user has shared a file with <span class="italic italic">a.com</span> and <span class="italic italic">b.com</span> domain users at the same time using a single URL, restrict access to <span class="phrase">blocklist</span> <span class="italic italic">a.com</span> domain denies access to both <span class="italic italic">a.com</span> and <span class="italic italic">b.com</span> domain users. Netskope changes the exposure of the file to private.</p></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140864"><div class="titlepage"><div><div class="title"><h6 class="title">Google Drive Connected Apps/Plugins</h6></div></div></div><p>If you select Google Drive application to scan Connected Apps/Plugins, only two actions are available: Alert and Revoke.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Alert</strong></span>: If the policy is triggered, based on the policy definition, an alert will be generated.</p></li><li class="listitem"><p><span class="bold bold"><strong>Revoke</strong></span>: If the policy is triggered, based on the policy definition, the selected Google app/plugin will be revoked.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>Apps that are revoked can be reinstalled by the user. However, if the policy is active, the apps will be revoked again.</p></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If the policy to revoke an app applies to a user <span class="italic italic">A</span>, user <span class="italic italic">B</span> can continue to install the app.</p></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>After revoking, the app is visible in the but on running the app, the user must grant access again.</p></div></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140882"><div class="titlepage"><div><div class="title"><h6 class="title">SharePoint Restrict Access to Owner Behavior</h6></div></div></div><p>In SharePoint, a site owner is the owner of the files and folders of the site. This is the default behavior. In the following scenarios the owner of the site becomes the owner of the uploaded file by default:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The site is owned by an administrator and other groups.</p></li><li class="listitem"><p>The site is shared with select users.</p></li><li class="listitem"><p>A folder or file is uploaded on the site by one of the site member users.</p></li></ul></div><p>When there is an access restriction to an owner of such a file, users are restricted to access from the shared list apart from the author of the file and the owner(s) of the site.</p></section></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-007af3a8-5896-a6cd-1a25-582763e89341" data-time-modified="August 5, 2020" data-publication-date="" id="UUID-4994f67c-b76d-e4bb-d48f-d4793ebb565f"><div class="titlepage"><div><div class="title"><h6 class="title">Notification</h6></div></div></div><p>This section of the <span class="phrase">API-enabled Protection</span> Policy page specifies who and when to notify users about a policy violation.</p><p>With Slack for Enterprise, you can send notifications to an owner or user through direct messaging using a Netskope bot.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Select the <span class="bold bold"><strong>Notify once every</strong></span> option to specify how often to notify recipients and who to notify. Click on the adjacent toggle to specify a frequency, or choose to send notifications after each event.</p></li><li class="listitem"><p>To send multiple notifications, select the recipients to notify, and then choose the email template you want to use and enter the email address of the recipient(s). To create custom email templates for each recipient, enable the checkbox for the recipient types, and then select <span class="bold bold"><strong>Create New</strong></span> from the drop-down list. Enter the needed info in the <span class="bold bold"><strong>Create Email Notification Template</strong></span> window, and then select components to include in the email. When finished, click <span class="bold bold"><strong>Save</strong></span>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The <span class="bold bold"><strong>Create New</strong></span> email template is not available for GitHub.</p></div></li><li class="listitem"><p>Optionally, you can enter your email address so the recipients know who set up this policy. </p><p>For Cisco Webex Teams, when you select <span class="bold bold"><strong>Notify after each event</strong></span>, options for sending a notification through the app appear under a <span class="bold bold"><strong>Notify by</strong></span> section.</p><p>For Slack for Enterprise, when you select <span class="bold bold"><strong>Notify after each event</strong></span>, options for sending a notification through the app appear under a <span class="bold bold"><strong>Notify by</strong></span> section.</p><p>With GitHub, if an administrator needs to be notified by email, you have to explicitly use the <span class="bold bold"><strong>Select Users - Email Template</strong></span> option and specify the email address.</p></li><li class="listitem"><p>When finished, click <span class="bold bold"><strong>Next</strong></span>.</p></li></ol></div></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-5c1ef539-84b7-3d8b-d391-b29c3cba4c21" data-time-modified="June 21, 2019" data-publication-date="" id="UUID-4094bc56-dec5-ca2c-ade6-4f83bb04d9df"><div class="titlepage"><div><div class="title"><h6 class="title">Set Policy</h6></div></div></div><p>This section of the <span class="phrase"></span><span class="phrase">API-enabled Protection</span> Policy page specifies the name of the policy and allows you to add a description if desired.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Enter the name of the policy.</p></li><li class="listitem"><p>Optionally, you can enter a short description of the policy.</p></li></ol></div><p>When finished, click <span class="bold bold"><strong>Save</strong></span>. The policy that you just created will scan the files and folders specified based on your selections, and the action chosen occurs when there is a policy violation.</p></section><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-ebc70da5-c849-f435-2758-9b846c194c2f" data-time-modified="January 31, 2020" data-publication-date="" id="UUID-142098c7-d927-81a2-a897-e21de846f809"><div class="titlepage"><div><div class="title"><h6 class="title">Retroactive Scan</h6></div></div></div><div dir="ltr" class="important"><h3 class="title">Important</h3><p>Netskope supports one active retroactive scan per application instance. If you intend to scan the same content against multiple policies, you can do so by combining these policies together under a single retroactive scan.</p></div><p>From release 50, a retroactive scan is decoupled from ongoing (a.k.a future transaction) scan. A retroactive policy scans all the files and folders for the app instance right from the inception of the SaaS app.</p><h8 id="idp140940" class="bridgehead">Limitations in Earlier Approach</h8><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Creating a retroactive scan was part of the same policy wizard as the ongoing scan. A retroactive scan could be created on a single policy.</p></li><li class="listitem"><p>There were no SLAs defined to complete a retroactive scan.</p></li><li class="listitem"><p>There was no apparent indication of the status of the scan.</p></li><li class="listitem"><p>As part of the policy wizard, most customers selected the retroactive scan by default, although they used for testing purpose. Once a retroactive scan was triggered, the administrator could not stop until the scan was complete, even if the administrator disabled the policy. Such scenarios added a heavy load on <span class="phrase">API-enabled Protection</span> resulting in an overall degradation of performance.</p></li></ul></div><h8 id="idp140951" class="bridgehead">Configuration Workflow</h8><p>This feature separates retroactive scan from the ongoing scan. The configuration workflow is as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="phrase">API-enabled Protection</span> policy wizard is divided into two - ongoing scan and retroactive scan.</p></li><li class="listitem"><p>The administrator creates an ongoing scan using the existing <span class="bold bold"><strong>NEW POLICY</strong></span> wizard. This is the default behavior. </p></li><li class="listitem"><p>The administrator navigates to the <span class="bold bold"><strong>RETROACTIVE SCANS</strong></span> page where all the retroactive scans are listed. The administrator can drill down to each scan to get additional details. </p></li><li class="listitem"><p>The administrator can group multiple ongoing policies for a SaaS app to create a single retroactive scan.</p></li></ul></div><p>A life-cycle of a retroactive scan, in a nutshell, is as follows:</p><p>Create a <span class="emphasis"><em>Retroactive Scan &gt; Fetch Files</em></span> (fetch files from SaaS app based on the ongoing policy) <span class="emphasis"><em>&gt; Fetch Files Phase Complete &gt; Scan Files &gt; Scan Files Phase Complete &gt; Matched Policy</em></span>.</p><p>In the UI, you can see the following status: <span class="emphasis"><em>In-Progress &gt; Completed</em></span>.</p><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp140971"><div class="titlepage"><div><div class="title"><h6 class="title">Retroactive Scan Configuration</h6></div></div></div><p>You can create a retroactive scan for an existing ongoing policy. Ensure that at least one ongoing policy is available for a SaaS app. To configure a retroactive scan, follow the procedure below:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Navigate to <span class="bold bold"><strong>Policies &gt; <span class="phrase">API-enabled Protection</span></strong></span>.</p></li><li class="listitem"><p>On top-right, click <span class="bold bold"><strong>RETROACTIVE SCANS</strong></span>.</p><p>The <span class="bold bold"><strong>Retroactive Scans</strong></span> page opens. This page displays a list of retroactive scans in different states; submitted, scan on-hold, in-progress, stopped, completed. </p></li><li class="listitem"><p>Click <span class="bold bold"><strong>SUBMIT SCAN REQUEST</strong></span>.</p><p>The <span class="bold bold"><strong>Configure Retroactive Scan</strong></span> window opens. Read the note in the UI before proceeding.</p></li><li class="listitem"><p>In <span class="bold bold"><strong>RETROACTIVE SCAN NAME</strong></span>, enter a unique scan name.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>By default, the name is pre-populated in <span class="emphasis"><em>Retro_Name_[AppName]_[InstanceName]_YYYYMMDD</em></span> format. You can overwrite the pre-populated name. However, you should ensure that the name is unique.</p></div></li><li class="listitem"><p>In <span class="bold bold"><strong>SELECT POLICIES</strong></span>, select a SaaS app and instance from the <span class="bold bold"><strong>Application</strong></span> and <span class="bold bold"><strong>Instance</strong></span> drop-down lists respectively.</p><p>A list of ongoing policies for the SaaS app is listed.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>For a list of apps that support retroactive scan, see <a class="xref" href="api-enabled-protection-overview.html#UUID-2c337e74-97f2-fb84-34c2-3a452731341d" title="API-enabled Protection Policy Actions per Cloud App"><span class="xreftitle"><span class="phrase">API-enabled Protection</span> Policy Actions per Cloud App</span></a></p></div></li><li class="listitem"><p>From the ongoing policies list, select the policies for which you plan to create a retroactive scan.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You cannot select an ongoing policy for which a retroactive scan is already in progress. You can select the policy once the retroactive scan is either stopped or completed.</p></div></li><li class="listitem"><p>Click <span class="bold bold"><strong>SCAN</strong></span>.</p></li><li class="listitem"><p>The UI displays the total number of files and users to be scanned and the number of API calls to be made. Click <span class="bold bold"><strong>OK</strong></span> to confirm the retroactive scan.</p></li></ol></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>If you have configured to receive email notifications under <span class="bold bold"><strong>Policies &gt; <span class="phrase">API-enabled Protection</span></strong></span>, Netskope will send alerts to the configured email address.</p></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp141019"><div class="titlepage"><div><div class="title"><h6 class="title">Additional Functions</h6></div></div></div><p>Here are the additional functions that you can perform on the <span class="bold bold"><strong>Retroactive Scans</strong></span> page.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>On the top-right section of the page, there is a scan filer. You can select either <span class="bold bold"><strong>All Scans</strong></span>, <span class="bold bold"><strong>In-Progress Scans</strong></span>, <span class="bold bold"><strong>Stopped Scans</strong></span>, or <span class="bold bold"><strong>Completed Scans</strong></span> option from the drop-down list. The UI filters the list based on the selection.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><span class="bold bold"><strong>All Scans</strong></span>: All retroactive scans including in-progress, stopped, and completed.</p></li><li class="listitem"><p><span class="bold bold"><strong>In-Progress Scans</strong></span>: Retroactive scans that are running presently.</p></li><li class="listitem"><p><span class="bold bold"><strong>Stopped Scans</strong></span>: Retroactive scans that are stopped.</p></li><li class="listitem"><p><span class="bold bold"><strong>Completed Scans</strong></span>: Retroactive scans that are completed.</p></li></ul></div></li><li class="listitem"><p>You can stop or delete a retroactive scan. Click the More Options icon (<span class="bold bold"><strong>...</strong></span>) to the right of the retroactive scan entry and select <span class="bold bold"><strong>Stop Retroactive Scan</strong></span> or <span class="bold bold"><strong>Delete Retroactive Scan</strong></span>.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You need to first stop an in-progress retroactive scan before deleting it.</p></div></li><li class="listitem"><p>You can view the details of a retroactive scan. Click the More Options icon (<span class="bold bold"><strong>...</strong></span>) to the right of the retroactive scan entry and select <span class="bold bold"><strong>View Scan Details</strong></span>. The <span class="bold bold"><strong>Retroactive Scan Details</strong></span> panel appears on the right of the page. The panel displays the status of the scan and other policy details like scan start/end time, policy name, instance, folders scanning, DLP, action, and more.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The policy hits on the <span class="bold bold"><strong>Retroactive Scans</strong></span> page is the total hit counts of all policies. To know the per policy hit count, you can click <span class="bold bold"><strong>View Scan Details</strong></span> and under the <span class="bold bold"><strong>POLICIES TO SCAN</strong></span> section, you can view the per policy hit count.</p></div></li></ul></div></section></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="idp141060"><div class="titlepage"><div><div class="title"><h6 class="title">Important Points to Remember</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Once you start a retroactive scan, <span class="phrase">API-enabled Protection</span> fetches the files from the SaaS app, scans, and completes the scan. You may notice that the scanned files count is not equal to the final matched policy count. This is because <span class="phrase">API-enabled Protection</span> scans all the available objects in the SaaS app based on the policies selected. However, once complete, the matched policy count is the total number of objects that are triggered due to a DLP policy hit.</p></li><li class="listitem"><p>If multiple ongoing policies are clubbed together to create a single retroactive scan, the time taken to complete the scan may be determined by the policy with the maximum number of objects or users.</p></li><li class="listitem"><p>Netskope recommends combining multiple ongoing policies to create a retroactive scan. <span class="phrase">API-enabled Protection</span> creates a super-set of policies, fetch, and scan objects accordingly. Also, <span class="phrase">API-enabled Protection</span> makes live API calls to fetch files for the retroactive scan. If you combine ongoing policies in one retroactive scan, you can save on multiple API calls to the SaaS apps and optimize performance in case of overlapping policies.</p></li><li class="listitem"><p>You cannot edit or delete an ongoing policy which is part of an in-progress retroactive scan. Adding and deleting of an ongoing policy is possible once the retroactive scan is either stopped or complete.</p></li></ul></div></section></section></section></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-facbce07-5fed-8074-472e-5efc41157211">Setting Up AWS Instances using Old UI</a></li><li><a href="#UUID-54b7ce96-11d9-6562-3299-4377b02bb884">Configure AWS for Continuous Security Assessment</a><ul class="nav"><li><a href="#idp139372">Create an AWS Instance in API-enabled Protection</a></li></ul></li><li><a href="#UUID-938c06ed-eab8-e9ed-7d9d-b9333b351e44">Setting up Multiple AWS Instances</a><ul class="nav"><li><a href="#UUID-ead7b166-6501-b70f-3066-e12ccde65bb3">Terminology</a></li><li><a href="#UUID-de88689a-fb13-590c-d43d-f14633c432a7">Prerequisites</a><ul class="nav"></ul></li><li><a href="#UUID-4565356a-f76a-113a-bb79-f18531ef915e">Steps to Run the Script</a><ul class="nav"></ul></li><li><a href="#UUID-4b50aaab-020c-a665-4bfd-9ec44ec5d58c">Troubleshooting</a></li><li><a href="#UUID-9b17f398-3d82-16e9-ab3e-693f6df90b01">Appendix</a><ul class="nav"></ul></li></ul></li><li><a href="#UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd">Configure AWS CloudTrail for Audit Reports</a><ul class="nav"><li><a href="#UUID-9a6ab769-a845-7203-fba2-c83c600f4cfd_section-5ce368e2cfb14-idm45390841353040">Permissions Required to Decrypt a CloudTrail Log File</a></li><li><a href="#idp139862">Create an AWS Instance in API-enabled Protection</a></li></ul></li><li><a href="#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3">Configure AWS S3 for DLP Scanning and Threat Protection</a><ul class="nav"><li><a href="#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm45403305419792">Configure an S3 Bucket, SNS Topic, and CloudTrail Service</a></li><li><a href="#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm43121831236464">Permissions Required to Decrypt a CloudTrail Log File</a></li><li><a href="#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-idm45403303583472">Handle Encrypted S3 Bucket</a></li><li><a href="#idp140206">Create an AWS Instance in API-enabled Protection</a></li><li><a href="#UUID-852c22a7-5a47-9966-a548-1b5495d4cce3_section-5d75cfe0bca10-idm45107321580000">What Triggers a Scan and Billing of AWS S3 Bucket?</a></li><li><a href="#UUID-f9459cb2-a7e4-4641-46f3-58f1648b9faa">Create an API-enabled Protection Policy</a><ul class="nav"></ul></li></ul></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Setting%20Up%20AWS%20Instances%20using%20Old%20UI%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Setting%20Up%20AWS%20Instances%20using%20Old%20UI%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="setting-up-multiple-aws-accounts-using-the-new-ui.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="continuous-security-assessment-for-google-cloud-platform.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">May 28, 2020</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
