<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Netskope IPSec with Cisco Meraki</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/jquery.paligocode.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="configure-business-intent-overlay-policies-305666.html" title="Configure Business Intent Overlay Policies"></link><link rel="next" href="netskope-ipsec-with-cisco-meraki.html#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4557726606950432685059680294" title="Cisco Meraki &amp; Netskope IPSec Tunnel Network"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script type="text/javascript">var containerid = 'GTM-W56WJ8S';

						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer',containerid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link">Â <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="integrations.html">Integrations</a></li><li class="breadcrumb-link"><a href="ipsec-and-gre.html">IPSec and GRE</a></li><li class="breadcrumb-node">Netskope IPSec with Cisco Meraki</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="configure-business-intent-overlay-policies-305666.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-ipsec-with-cisco-meraki.html#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4557726606950432685059680294">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section reused-publication reused-publication" data-origin-id="UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794" data-permalink="netskope-ipsec-with-cisco-meraki.html" data-topic-level="1" data-relative-prefix="" data-time-modified="October 22, 2021" data-publication-date="" id="UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794"><div class="titlepage"><div><div class="title"><h4 class="title">Netskope IPSec with Cisco Meraki</h4></div></div></div><p>Netskope can be deployed in conjunction with the Meraki SD-WAN solution to effectively protect users regardless of their location roaming or network. While there are limitations to the Meraki policy-based steering capability, Netskope can steer traffic directly from a branch to the Netskope cloud, leveraging the third-party IPSec configuration. Availability is achieved using either the Netskope Client or multiple tunnels from each MX device and a PAC script for continuity during failure conditions. In addition, the outbound firewall policy can be used to limit direct access to only include the Netskope tenant, which enables the client to steer directly to the Netskope cloud. This ensures your cloud access risk is effectively controlled while offering your users the best possible experience and reducing the requirement to steer traffic to your organization's HQ to reduce costs related to backhauling cloud-bound traffic.</p><p>Cisco Meraki is a low-cost cloud-managed alternative to the traditional Cisco network equipment. The solution is popular because of its ease of deployment and management. Cisco markets it as a solution that offers SD-WAN capabilities through the Meraki Auto-VPN capabilities. This solution is aimed at small and medium organizations and doesn't offer the full features included with the traditional enterprise-focused solutions.</p><p>The goal of SD-WAN is to lower costs related to expensive MPLS and least line links through the adoption of low-cost internet-based links without impacting user experience negatively or introducing risks by not having the required mitigating controls in place.</p><p>Following are the components for this configuration:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>2x Meraki MX67 deployed in geographically separate locations with separate internet connections</p></li><li class="listitem"><p>Cisco Meraki running version MX 15.39</p></li><li class="listitem"><p>Netskope tenant</p></li><li class="listitem"><p>Netskope Client</p></li></ul></div><p>Both locations have Fiber internet connections, and the MX67 devices were configured with public IP address directly on WAN1 interface.</p><p>Meraki Site-to-Site (Auto) VPN was configured in a hub and spoke methodology to simulate a branch and head quarter deployment scenario. This document refers to the configured MX Hub (mesh) as the HQ or Site 1 and the Spoke as Branch or Site 2.</p><p>Both MX appliances are configured in routed mode, and Netskope established multiple IPSec tunnels from each MX device to the Netskope cloud. In most cases, Netskope recommends deploying VPN concentration mode for the hub. This won't affect the branch side configuration and general capability of the Meraki solution as it relates to traffic steering regarding SD-WAN.</p><p>The MX appliances support up to two WAN uplink interfaces and also a 3G/LTE failover using the supported USB dongle. This allows for load balancing and performance routing and redundancy of desired traffic using a preferred uplink. This configuration example uses a single uplink, but you can use multiple uplinks for increased redundancy.</p><div dir="ltr" class="note"><h3 class="title">Note</h3><p>The Meraki SD-WAN solution doesn't offer the capability of creating policy-based routes to steer/route traffic based on destination port via a specific WAN or third-party IPSec interface.</p></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4557726606950432685059680294"><div class="titlepage"><div><div class="title"><h5 class="title">Cisco Meraki &amp; Netskope IPSec Tunnel Network</h5></div></div></div><p>The following diagram outlines this configuration and defined use cases:</p><div class="mediaobject"><img src="image/uuid-79b46520-45b6-ea5e-298a-a84347c33427.png" style="" alt="image2.png"></img></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4614490334518432685074561341"><div class="titlepage"><div><div class="title"><h6 class="title">Site 1 (HQ)</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Local Networks</strong></span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Default local network 192.168.128.0/24 â Published to Auto-VPN</p></li><li class="listitem"><p>Downstream Transit 192.168.129.0/30</p></li></ul></div></li><li class="listitem"><p><span class="bold bold"><strong>Static Routes</strong></span>: DC Networks 10.0.0.0/8 â published to Auto-VPN</p><div class="mediaobject"><img src="image/uuid-0dce9f3a-822b-80cb-29b1-7bb977146805.png" style="" alt="image3.png"></img></div></li><li class="listitem"><p><span class="bold bold"><strong>Site-to-site-VPN</strong></span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Hub (mesh)</p></li><li class="listitem"><p>Third-party IPSec</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>Netskope JHB</p></li><li class="listitem"><p>Netskope LON</p></li></ul></div></li></ul></div><div class="mediaobject"><img src="image/uuid-75c878ad-2657-31c8-d609-513418d88621.png" style="" alt="image4.png"></img></div></li></ul></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4526428071899232685075259951"><div class="titlepage"><div><div class="title"><h6 class="title">Site 2 (Branch)</h6></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Local Networks</strong></span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>SRV 192.168.1.0/24 â published to Auto-VPN</p></li><li class="listitem"><p>Office 192.168.20.0/24 â published to Auto-VPN</p></li><li class="listitem"><p>Guest 192.168.30.0/244 â published to Auto-VPN</p></li></ul></div><div class="mediaobject"><img src="image/uuid-b290e81a-094a-2acd-edcd-bb448c19cab7.png" style="" alt="image5.png"></img></div></li><li class="listitem"><p><span class="bold bold"><strong>Site-to-site-VPN</strong></span>:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Spoke</p></li><li class="listitem"><p>Third-party IPSec</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: square; "><li class="listitem"><p>Netskope JHB</p></li><li class="listitem"><p>Netskope LON</p></li></ul></div></li></ul></div><div class="mediaobject"><img src="image/uuid-2e98cc1f-77e7-8113-bd52-a45430a3b057.png" style="" alt="image6.png"></img></div><p>In <span class="bold bold"><strong>Hubs</strong></span>, the <span class="bold bold"><strong>Default route</strong></span> option is unselected, which is required for local direct internet breakout (i.e., use case #1). For central breakout (i.e., use case #2), this option must be selected:</p><div class="mediaobject"><img src="image/uuid-4ddd226d-9288-cddc-2b2b-9b7600172cf9.png" style="" alt="image7.png"></img></div></li></ul></div></section></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-c569a276-8dcb-e480-c494-f8acb6c09662" data-time-modified="October 15, 2021" data-publication-date="" id="UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9_body" data-parent="#UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9"><div><div class="title"><h5 class="title">Configure IPSec Tunnels in Cisco Meraki</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9_body"><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9_section-idm4547044670288032685122216597"><div class="titlepage"><div><div class="title"><h6 class="title">Meraki Third-Party VPN Peers</h6></div></div></div><p>Netskope configured an organization wide setting destined to two separate Netskope POPs applied to each of the Meraki MX devices. This configuration will create two IPSec tunnels from each of the MX appliances in the organization to both Netskope gateways. Each MX will then have the exact same connected IP address to each of the Netskope POPs.</p><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:585px;
                            "><tr><td style="padding:0;"><img src="image/uuid-c42a8eed-c47f-6334-77e7-f6b6844cd6f6.png" style="max-width: 585px; " alt="image8.png"></img></td></tr></table></div><p>The Private subnets setting is the locally addressable IP addresses to the Netskope cloud. These addresses can be anything just ensure they don't overlap with anything else. You can then either use policy-based routing or this subnet/IP as an explicit proxy destination in order to route traffic via Netskope. </p><p>Unfortunately, since the MXs can't perform policy-based routing across a target interface, Netskope can't make use of routing. However Netskope can use explicit proxy and PAC/wpad. In this configuration example, Netskope uses an explicit proxy with PAC/wpad deployment to support high availability and steering requirements.</p></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9_section-idm4547044719432032685122392836"><div class="titlepage"><div><div class="title"><h6 class="title">Meraki IPSec Policies</h6></div></div></div><p>To configure the IPSec policies in Cisco Meraki:</p><div class="procedure" id="UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9_procedure-idm460924150977763268513381883"><ol class="procedure" type="1"><li class="step"><p>Select IKEv2. You must have version 15 to use IKEv2. Some MX devices don't support IKEv2.</p></li><li class="step"><p>In the <span class="bold bold"><strong>Phase 1</strong></span> section:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Encryption</strong></span>: AES 256</p></li><li class="listitem"><p><span class="bold bold"><strong>Authentication</strong></span>: SHA256</p></li><li class="listitem"><p><span class="bold bold"><strong>Psuedo-random Function</strong></span>: SHA256</p></li><li class="listitem"><p><span class="bold bold"><strong>Diffie-Helman Group</strong></span>: 14</p></li><li class="listitem"><p><span class="bold bold"><strong>Lifetime</strong></span>: 28800</p></li></ul></div></li><li class="step"><p>In the <span class="bold bold"><strong>Phase 2</strong></span> section:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Encryption</strong></span>: AES 256, AES 128, NULL</p></li><li class="listitem"><p><span class="bold bold"><strong>Authentication</strong></span>: SHA256, SHA1</p></li><li class="listitem"><p><span class="bold bold"><strong>PFS group</strong></span>: Off</p></li><li class="listitem"><p><span class="bold bold"><strong>Lifetime</strong></span>: 7200</p></li></ul></div></li></ol></div><div class="mediaobject"><table class="image-viewport" style="border-collapse:collapse;border:0;
                                width:289px;
                            "><tr><td style="padding:0;"><img src="image/uuid-4151223f-4593-80e5-e887-7ce0e28b7b45.png" style="max-width: 289px; " alt="image9.png"></img></td></tr></table></div></section></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-9c3da102-1bdb-20c8-81ce-b44a655ba5a4" data-time-modified="October 15, 2021" data-publication-date="" id="UUID-c6510577-57ac-53a3-683e-b43650c5c433"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-c6510577-57ac-53a3-683e-b43650c5c433_body" data-parent="#UUID-c6510577-57ac-53a3-683e-b43650c5c433"><div><div class="title"><h5 class="title">Configure IPSec Tunnels in Netskope</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-c6510577-57ac-53a3-683e-b43650c5c433_body"><div class="mediaobject"><img src="image/uuid-f0f714f8-a647-4c81-5090-7ffaa9bf4569.png" style="" alt="image10.png"></img></div><div dir="ltr" class="note"><h3 class="title">Note</h3><p>You must configure at least one IPSec tunnel for every device connecting to the Netskope cloud.</p></div><p>To configure the the IPSec tunnel in Netskope:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="strong strong"><strong>Source IP Address</strong></span>: Leave blank. In this configuration example, Netskope uses WAN interfaces with dynamically assigned public IP addresses.</p></li><li class="listitem"><p><span class="strong strong"><strong>Source Identity</strong></span>: meraki67.local and meraki67b.local</p></li><li class="listitem"><p><span class="strong strong"><strong>Encryption Cipher</strong></span>: AES256-CBC</p></li></ul></div><div class="mediaobject"><img src="image/uuid-d75c2b28-6353-4e7d-ea34-77c1904d3314.png" style="" alt="image11.png"></img></div></div></div></section><section xml:lang="en" lang="en" dir="ltr" class="section accordion accordion" data-origin-id="UUID-be8f808f-11fa-794e-24c0-7e3a203d9e0e" data-time-modified="October 15, 2021" data-publication-date="" id="UUID-f2429165-55dc-28a2-dbb0-87df71e7e320"><div class="accordion-icon"></div><div class="panel panel-default"><div class="panel-heading"><div class="titlepage"><a data-toggle="collapse" href="#UUID-f2429165-55dc-28a2-dbb0-87df71e7e320_body" data-parent="#UUID-f2429165-55dc-28a2-dbb0-87df71e7e320"><div><div class="title"><h5 class="title">Use Cases</h5></div></div></a></div></div><div class="panel-body collapse" id="UUID-f2429165-55dc-28a2-dbb0-87df71e7e320_body"><p>Netskope identified two feasible use cases. The aim is to secure user cloud access through the Netskope cloud while improving user experience, service availability, and lower costs. The Netskope cloud offers numerous steering options, but the following options are useful with regard to the Meraki SD-Wan solution, Netskope Client, and IPSec and Explicit Cloud Proxy.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold bold"><strong>Use Case #1</strong></span>: Direct internet breakout from the branch with Auto-VPN to a central location for access to private apps in a central location.</p></li><li class="listitem"><p><span class="bold bold"><strong>Use Case #2</strong></span>: Default route to VPN Hub and local internet breakout using Netskope proxy via third-party IPSec configuration on branch Meraki.</p></li></ul></div><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-f2429165-55dc-28a2-dbb0-87df71e7e320_section-idm4613160107017632685004386588"><div class="titlepage"><div><div class="title"><h6 class="title">Use Case #1</h6></div></div></div><p>In this configuration, the branch applianceâs default route points directly to the internet. Services in the HQ data center are published via Meraki Site-to-site VPN, and the branches will automatically route any traffic destined there via the Meraki Site-to-Site VPN. In addition, any other service that needs to be routed centrally must be defined centrally via the hub with either OSPF or a static route.</p><p>The Meraki solution allows configuring a firewall for outbound traffic, and you can use this solution to restrict outbound traffic. In this use case, Netskope chose to restrict outbound access to only the Netskope cloud infrastructure. The benefit of this approach is that Netskope can use the Netskope Client to route traffic directly to the Netskope cloud without any dependency on the IPSec tunnel and PAC/proxy configuration if the client is installed. This approach offers great user experience for devices managed by your organization but also allows any other devices that can't use the Netskope Client to route traffic directly over the IPSec tunnel. This configuration applies to non-user devices requiring internet access for specific services, such as guests or contractors. It allows direct breakout using the Netskope Explicit Proxy.</p><div class="mediaobject"><img src="image/uuid-3e352348-199f-d687-adcf-4dd26ce68dfd.png" style="" alt="image12.png"></img></div></section><section dir="ltr" class="section" data-origin-id="" data-publication-date="" id="UUID-f2429165-55dc-28a2-dbb0-87df71e7e320_section-idm4547044718531232685004839912"><div class="titlepage"><div><div class="title"><h6 class="title">Use Case #2</h6></div></div></div><p>If you configure the branch to route all traffic via the hub, all traffic will be routed via the Meraki Site-to-Site (Auto) VPN. If you have the Netskope Client deployed, any traffic from the client destined to the Netskope cloud is automatically routed to the central location. Netskope is unable to create policy-based routes to intelligently steer traffic based on the destination network so this is solved in a different way.</p><div class="mediaobject"><img src="image/uuid-4ddd226d-9288-cddc-2b2b-9b7600172cf9.png" style="" alt="image7.png"></img></div><p>You can configure local internet breakout for traffic based on the destination IP address. You then can configure the MX device to perform local internet breakout for any traffic destined to the Netskope NewEdge infrastructure.</p><p>Following is the consolidated Netskope IP list for whitelisting:</p><div class="informaltable table-responsive"><table class="informaltable frame-box rules-all"><colgroup><col></col><col></col></colgroup><thead><tr><th class="th" data-priority="1"><p>CIDR Notation</p></th><th class="th" data-priority="1"><p>IP Address Range</p></th></tr></thead><tbody><tr><td class="td"><p>8.36.116.0/24</p></td><td class="td"><p>8.36.116.0 - 8.36.116.255</p></td></tr><tr><td class="td"><p>8.39.144.0/24</p></td><td class="td"><p>8.39.144.0 - 8.39.144.255</p></td></tr><tr><td class="td"><p>31.186.239.0/24</p></td><td class="td"><p>31.186.239.0 - 31.186.239.255</p></td></tr><tr><td class="td"><p>45.250.160.0/22</p></td><td class="td"><p>45.250.160.0 - 45.250.163.255</p></td></tr><tr><td class="td"><p>74.217.93.0/24</p></td><td class="td"><p>74.217.93.0 - 74.217.93.255</p></td></tr><tr><td class="td"><p>103.47.244.0/24</p></td><td class="td"><p>103.47.244.0 - 103.47.244.255</p></td></tr><tr><td class="td"><p>103.219.77.0/24</p></td><td class="td"><p>103.219.77.0 - 103.219.77.255</p></td></tr><tr><td class="td"><p>103.219.78.0/24</p></td><td class="td"><p>103.219.78.0 - 103.219.78.255</p></td></tr><tr><td class="td"><p>103.219.79.0/24</p></td><td class="td"><p>103.219.79.0 - 103.219.79.255</p></td></tr><tr><td class="td"><p>163.116.128.0/17</p></td><td class="td"><p>163.116.128.0 - 163.116.255.255</p></td></tr></tbody></table></div><p>You can configure this list in the VPN exclusion rules setting on the SD-WAN &amp; traffic shaping page. This configuration allows all traffic to be routed centrally except for any Netskope-destined traffic, which will break out locally.</p><div class="mediaobject"><img src="image/uuid-3db70e8c-b91c-665b-8d09-e5102bc3a99e.png" style="" alt="image13.png"></img></div><p>This setting allows the Netskope Client to directly break out and work as normal. If you want to use IPSec tunnels, the Netskope Client can automatically detect whether your traffic is steered via IPSec and disable itself. You can still get the benefits of the Netskope Client from a user notification and identity perspective.</p><p>If you want to use IPSec tunnels for localized steering or for situations where using the Netskope Client isn't possible and localized steering is dependent on the Explicit Proxy configuration, you can use PAC/wpad, which also enables seamless failover in an event that the primary Netskope POP is offline.</p><p>PAC files are flexible and, with wpad, allows devices to automatically detect proxy setting on a network. Following is the PAC file used in this configuration example:</p><pre class="programlisting">// Pac file created by Miku ( miku@example.com )

// Last modified: 06/11/2020

// ver: 1.0

// status: beta

function FindProxyForURL(url, host) {

/* Only proxy HTTP and HTTPS */

if (!shExpMatch(url, "https://*") &amp;&amp; !shExpMatch(url, "http://*")) return "DIRECT";

/* Normalize the URL for pattern matching */

url = url.toLowerCase();

host = host.toLowerCase();

/* resolve any host which can be resolved */

/* this is also useful for endpoint attribution of threats later using dns logs */

if (isResolvable(host)) {

var hostIP = dnsResolve(host);

}

// Hosts resolved to RFC 1918 goes direct.

if (isInNet(hostIP, "10.0.0.0", "255.0.0.0") ||

isInNet(hostIP, "172.16.0.0", "255.240.0.0") ||

isInNet(hostIP, "192.168.0.0", "255.255.0.0")) { return "DIRECT"; }

/* Don't proxy local hostnames */

if (isPlainHostName(host)) {

return 'DIRECT';

}

/* Don't proxy local domains */

if (dnsDomainIs(host, ".axefield.co.za") || (host == ".local")) {

return 'DIRECT';

}

/* Don't proxy hosts */

var ExcludeList = [

"*.sub7even.co.za"

];

for (var i=0; i&lt;ExcludeList.length; i++) {

if (shExpMatch(host, ExcludeList[i])) return "DIRECT" ;

}

/* Explicit proxy ports, non-standard ports can be added here */

var PortList = [

"80",

"443"

];

for (var i=0; i&lt;PortList.length; i++) {

if (shExpMatch(url, "*://*:*/") &amp;&amp;

!shExpMatch(url, "*://*:" + PortList[i] + "/")) {

//alert("Non standard port!");

return "DIRECT" ;

}

}

/* Return proxy */

var proxy = "PROXY 192.168.120.1:8080; PROXY 192.168.120.2:8080; DIRECT"

//alert(proxy);

return proxy;</pre><p>This PAC file enables you to steer traffic directly from the HQ or branch MX to the primary Netskope IPSec tunnel using proxy 192.168.120.1:8080 (JHB) and failover using proxy 192.168.120.2:8080 (LON). In this configuration example, a browser fails over to the backup proxy setting in less than 40 seconds if the primary proxy is no longer available.</p><p>Clients can automatically detect proxy configuration by deploying using DHCP option 252 and hosting the wpad.dat file on a web server that resolves to wpad with the following URL: http://wpad/wpad.dat</p><p>Netskope configured DHCP and hosted the wpad file on a web server, which resolved to wpad from local DNS. This enables clients on the network to automatically detect the proxy on the network.</p><p>The following image indicates the DHCP configuration pointing to the PAC.</p><div class="mediaobject"><img src="image/uuid-26ff2de9-4c16-aa3f-29b6-6664d9c63aad.png" style="" alt="image14.png"></img></div><p>For managed devices, Netskope recommends using the Netskope Client as it offers the most seamless configuration. You can use PAC files for non-managed devices or hosts where installing the Netskope Client isn't possible or preferred.</p></section></div></div></section></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><aside class="section-nav-container"><ul class="section-nav nav"><li><a href="#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794">Netskope IPSec with Cisco Meraki</a></li><li><a href="#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4557726606950432685059680294">Cisco Meraki &amp; Netskope IPSec Tunnel Network</a><ul class="nav"><li><a href="#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4614490334518432685074561341">Site 1 (HQ)</a></li><li><a href="#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4526428071899232685075259951">Site 2 (Branch)</a></li></ul></li><li><a href="#UUID-95698ff6-fd55-7cd3-6d2b-7554c6f9d3a9">Configure IPSec Tunnels in Cisco Meraki</a></li><li><a href="#UUID-c6510577-57ac-53a3-683e-b43650c5c433">Configure IPSec Tunnels in Netskope</a></li><li><a href="#UUID-f2429165-55dc-28a2-dbb0-87df71e7e320">Use Cases</a></li></ul></aside><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Netskope%20IPSec%20with%20Cisco%20Meraki%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Netskope%20IPSec%20with%20Cisco%20Meraki%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="configure-business-intent-overlay-policies-305666.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="netskope-ipsec-with-cisco-meraki.html#UUID-8c0d4243-51cb-35bc-63fb-d2f67a14b794_section-idm4557726606950432685059680294">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> Â© 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">October 22, 2021</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div><!--Google Tag Manager (noscript)--><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W56WJ8S" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><!--End Google Tag Manager (noscript)--></body></html>
