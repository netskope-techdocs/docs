<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta http-equiv="x-ua-compatible" content="IE=edge"></meta><meta name="format-detection" content="telephone=no"></meta><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"></meta><meta name="search" content="default"></meta><meta name="use.ic" content="no"></meta><meta name="tocstandalone" content="yes"></meta><meta name="theme" content="1"></meta><meta name="search.placeholder" content="Search"></meta><meta name="search.results" content="Search results"></meta><meta name="no.search.results" content="No results found"></meta><script type="text/javascript">
var theme = '1';

			
			var versionsfile = '';


			var indexDict = new Array();
			var store = {};
			var portalLanguage = 'en';
			var enterKey = 'select';
			
			
				var fuse_threshold = 0.3;
			
					var local_csh = false;
				
					var anchoroption = true;
				
			
			var useanchorlinks = false;
			
				useanchorlinks = true;
				
				var clicktocopy = 'Click to copy link';
				var linkcopied =  'Copied!';</script><title>Add Custom User Attributes</title><link rel="stylesheet" type="text/css" href="../css/docbook.css"></link><link rel="stylesheet" type="text/css" href="../css/font-awesome.css"></link><link rel="stylesheet" type="text/css" href="../css/roboto.font.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1.css"></link><link rel="stylesheet" type="text/css" href="../css/theme1-colors.css"></link><link rel="stylesheet" type="text/css" href="../css/content-theme2.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-core-css.css"></link><link rel="stylesheet" type="text/css" href="../css/sm-simple.css"></link><link rel="stylesheet" type="text/css" href="../css/style-print.css"></link><link rel="stylesheet" type="text/css" href="../css/style-common.css"></link><link rel="stylesheet" type="text/css" href="../css/style-modern-tables.css"></link><link rel="stylesheet" type="text/css" href="../css/rwd-table.min.css"></link><link rel="stylesheet" type="text/css" href="../css/graphical-lists.css"></link><link rel="stylesheet" type="text/css" href="../css/layout-custom-style.css"></link><script src="../js/jquery-3/jquery-3.4.1.min.js" type="text/javascript"></script><script src="../js/jquery-migrate-3.0.1.min.js" type="text/javascript"></script><script src="../js/materialize.min.js" type="text/javascript"></script><script src="../js/bootstrap.min.js" type="text/javascript"></script><script src="../js/purl.js" type="text/javascript"></script><script src="../js/jquery.smartmenus.js" type="text/javascript"></script><script src="js/toc.js" type="text/javascript"></script><script src="../js/create-toc.js" type="text/javascript"></script><script src="../js/html5-2-mp-common.js" type="text/javascript"></script><script src="../js/html5-2.js" type="text/javascript"></script><script src="../js/checklist.js" type="text/javascript"></script><script src="../js/rwd-table.min.js" type="text/javascript"></script><script src="../js/responsive-tables.js" type="text/javascript"></script><script src="../js/clipboard.min.js" type="text/javascript"></script><script src="../js/anchorlinks.js" type="text/javascript"></script><script src="../js/lunr.js" type="text/javascript"></script><script src="../js/jquery.mark.min.js" type="text/javascript"></script><script src="js/data.js" type="text/javascript"></script><script src="../js/search.js" type="text/javascript"></script><script src="../js/csh.js" type="text/javascript"></script><script src="../js/layout-custom-script.js" type="text/javascript"></script><meta name="generator" content="Paligo"></meta><link rel="prev" href="upgrade-the-netskope-adapters.html" title="Upgrade the Netskope Adapters"></link><link rel="next" href="appliances.html" title="Appliances"></link><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" async="async"></script><link rel="icon" href="/favicon.ico" type="image/x-icon"></link><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZT8KHXMB6T"></script><script type="text/javascript">var propertyid = 'G-ZT8KHXMB6T';

						window.dataLayer = window.dataLayer || [];
						function gtag(){dataLayer.push(arguments)};
						gtag('js', new Date());
						
						gtag('config', propertyid);
					</script><script type="text/javascript">
				$(document).ready(function () {
				$(".mediaobject img").addClass('materialboxed');
				//Exclude images with links
				$(".mediaobject a img").removeClass('materialboxed');
				if (!document.documentMode) {
				$('.materialboxed').materialbox();
				}});
			</script></head><body class="theme1 fixed-toolbar colored-top page-toc current-toc-section-focus" data-spy="scroll" data-target=".section-nav-container" data-offset="100" data-link-prefix=""><header class="site-header"><nav class="site-header-navbar navbar navbar-fixed-top"><div class="navbar-container"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div id="logotype-container" class="pull-left"><a class="navbar-brand" href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div></div><div id="navbar" class="navbar-collapse collapse"></div></div></nav></header><div class="site-body"><div class="site-body-container"><div class="site-body-row"><aside class="site-sidebar"><div class="site-sidebar-header"><button type="button" class="navbar-toggle" aria-controls="nav-site-sidebar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../index.html?lang=en"><img id="logotype-pageheader" src="../css/image/corporate-logo.png" alt="Corporate logotype" data-role="logotype" class="logo"></img></a></div><form class="site-sidebar-search" autocomplete="off"><input type="text" class="form-control search-field" placeholder="Search" id="aa-search-input"></input></form><div id="toc-standalone-placeholder"></div></aside><div class="site-content"><h1 class="publication-title">Netskope Help</h1><div class="toolbar"><div class="toolbar-tools"><div id="navbar" class="navbar-collapse collapse"></div><div class="tool-print print-icon"><a onclick="window.print();return false;"><i class="fa fa-print" aria-hidden="true"><span class="print-text">print</span></i></a></div><div class="tool-search"><i class="fa fa-search" aria-hidden="true"></i></div><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".site-sidebar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div class="breadcrumb-container"><ul class="breadcrumb"><li class="breadcrumb-link"> <a href="index-en.html">Netskope Help</a></li><li class="breadcrumb-link"><a href="integrations.html">Integrations</a></li><li class="breadcrumb-link"><a href="netskope-adapters.html">Netskope Adapters</a></li><li class="breadcrumb-node">Add Custom User Attributes</li></ul></div></div><main><div id="top-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="upgrade-the-netskope-adapters.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="appliances.html">Next</a></li></ul></div><article class="topic content-container" id="content-wrapper"><div id="topic-content" class="topic-content"><section xml:lang="en" lang="en" dir="ltr" class="section" data-origin-id="UUID-cace77fe-1dc1-bfdf-57a9-025b0c431b15" data-permalink="add-custom-user-attributes.html" data-topic-level="1" data-relative-prefix="" data-time-modified="September 17, 2019" data-publication-date="" id="UUID-083db596-3827-8d65-87d3-009db9f33bb8"><div class="titlepage"><div><div class="title"><h4 class="title">Add Custom User Attributes</h4></div></div></div><p>Use the REST API to upload custom user attributes like org unit, location, country, manager, and so on, to enrich SkopeIT events. This is an alternate method to using Directory Importer (formerly know as Active Directory {AD} Importer). While Directory Importer fetches attributes directly from a user directory, like AD or other directory, this method allows you to use data from other sources, like an HR tool or any other IAM. The data from such tools is often more accurate than data from an AD.</p><p>The REST API enables you to upload a CSV file with all the custom user attributes directly to the Netskope UI. The file uploaded must be in CSV format with a header row that defines the custom attribute fields. The names in the header fields are used for the field names displayed in SkopeIT events. The first field has to be the user ID, as it appears in the log file or email.</p><p>Field names should not have spaces or double quotes. There is no limit on the number of fields. The custom attributes can be in double quotes, and must be inside double quotes if they have spaces or a comma in the value.</p><div dir="ltr" class="tip"><h3 class="title">Tip</h3><p>If the error, "<code class="literal">Database save failed, error ['Key &lt;INSERT KEY&gt; in the header is a reserved word']"...</code> occurs, that means certain words, like User and Title, cannot be used for header fields. Modify needed header fields. Also,  make sure that values are enclosed in a single pair of quotation marks, not multiple pairs of quotation marks. To troubleshoot, try <code class="literal">$ vim &lt;filename&gt;</code>.</p></div><p>Here is an example CSV file:</p><pre class="programlisting">USER_ID,COMPANY_CODE,ORGANIZATION_UNIT,COUNTRY_CODE,LOCATION,USER_TYPE
"user1",143,"NorCal","US","SC","Internal"
"user2",143,"NorCal","US","SC","Internal"
"user3",143,"SoCal","US","SD","Internal"
</pre><div dir="ltr" class="important"><h3 class="title">Important</h3><p>There is no way to modify the custom attributes via the REST API. You have to upload the complete modified CSV file to change the DB. The previous custom attributes will be overwritten.</p></div><p>Other CSV file factors include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Maximum number of custom attributes supported is 15.</p></li><li class="listitem"><p>There is no limit on the length of the value for the attributes, but it is recommended that the length be kept as short as possible. Maximum recommended length for the values is 40.</p></li><li class="listitem"><p>If the header is in uppercase or mixed case, it will be converted to lowercase in accordance with the other Netskope attributes.</p></li><li class="listitem"><p>If there are duplicate key records, the first one will be the one considered. The duplicates are resolved based on the first field which as mentioned above is considered the unique key field.</p></li><li class="listitem"><p>Extensions allowed for the files are .csv and .txt</p></li></ul></div><p>If the CSV file is larger then 5 MB, the script automatically splits the file into usable chunks. The script to add custom user attributes is located at the end of this topic.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Build your CSV file following the guidelines stated and save it to a local directory.</p></li><li class="listitem"><p>Get your REST API token from the Netskope UI (<span class="bold bold"><strong>Settings &gt; Tools &gt; Rest API</strong></span>).</p></li><li class="listitem"><p>Copy the script to a local directory.</p></li><li class="listitem"><p>Run the script using this command: <code class="literal">sh ns_useratttr_upload.sh [[-u <span class="emphasis"><em>&lt;uiendpoint&gt;</em></span>] [-f <span class="emphasis"><em>&lt;path to csv file&gt;</em></span>][-t <span class="emphasis"><em>&lt;REST API Token&gt;</em></span>] [-h]]</code></p><p>Here's an example of what you should see:</p><pre class="programlisting">user$ sh ns_userattr_upload.sh -u support.goskope.com -f Test.csv -t 6b1763c7ee2f305f4c9d5f8e66
Upload Token fetched=a1f6cc15-6c8c-458a-a935-18ed
UploadFilesize=461
MAXCHUNKSIZE=5242880
CSV file less than/equal to 5 MB. No need to split......
{ "errors": [ "Unable to save the data" ], "status": "error" }
Data successfully Uploaded to Netskope</pre><p>It's important you see the message "Data successfully Uploaded to Netskope". Otherwise, the upload was not successful. Unfortunately, there is no way the verify in the Netskope UI whether the upload was successful. The only way is to parse a log file and verify the SkopeIT events.</p></li></ol></div><div class="example" id="idm45547825133344"><div class="example-title">Example 2. ns_userattr_upload.sh Script</div><div class="example-contents"><pre class="programlisting">#!/bin/bash

# ***********************************************************
# Example Bash script to upload csv files for custom user
# attributes
# Copyright: Netskope Inc/ 2016
# ***********************************************************

UPLOADTOKEN=
UI=
CSVFILE=
RESTTOKEN=
TOKENSTATUS=

function usage
{
    echo "usage: ns_useratttr_upload.sh [[-u &lt;uiendpoint&gt; ] [-f &lt;path of the csv file to upload&gt;] [-t &lt;REST API Token&gt;] [-h]]"
}

function jsonValue() {
    KEY=$1
    num=$2
    awk -F"[,:}]" '{for(i=1;i&lt;=NF;i++){if($i~/'$KEY'\042/){print $(i+1)}}}' | tr -d '"' | sed -n ${num}p
}

function getToken() {
    RESPONSE=`curl -k --silent "https://$1/api/v1/dataloaderid?token=$2" 2&gt;/dev/null`
    TOKENSTATUS=`echo "$RESPONSE" | jsonValue "status"`

    if [ "$TOKENSTATUS" == "error" ]; then
       echo 'Data Loader Id fetch failed'
       echo 'RESPONSE='$RESPONSE
    else
        UPLOADTOKEN=`echo "$RESPONSE" | jsonValue "data"`
    fi

}

function uploadFile() {
    UPLOADFILE="$1"
    UPLOADTOKEN="$2"
    declare -i UPLOADFILESIZE=`wc -c ${UPLOADFILE} | awk '{print $1}'`
    echo 'UploadFilesize='$UPLOADFILESIZE

    # MAXCHUNKSIZE
    declare -i MAXUPLOADSIZE=`expr 5 \* 1024 \* 1024`
    echo 'MAXCHUNKSIZE='$MAXUPLOADSIZE

    if [ ${UPLOADFILESIZE} -ge ${MAXUPLOADSIZE} ]; then
        UPLOADCHUNKFILE=`echo chunked_${UPLOADFILE}`
        echo "CSV file greater than 5 MB. splitting......"
        echo "Chunked File that will be uploaded is "$UPLOADCHUNKFILE
        if [ -d "./nsuploadtmp" ]; then
            echo 'Deleting the temporary nsuploadtmp directory'
            rm -rf ,/nsuploadtmp
        fi
        # create a working dir
        mkdir -p nsuploadtmp
        # create a temporary file containing the header without
        # the content:
        split -b ${MAXUPLOADSIZE} ${UPLOADFILE} nsuploadtmp/ns_uacsv_

        # loop through the new split files
        # moving the files one by one to the original name and
        # posting them to the upload url with the filename as
        # the UPLOADFILE
        declare -i startbytes=0
        FILELIST=`ls nsuploadtmp/ns_uacsv_*`
        #echo $FILELIST
        for f in $FILELIST
        do
           declare -i chunksize=`wc -c $f | awk '{print $1}'`
           echo 'chunksize='$chunksize
           endbytes=`expr $startbytes + $chunksize - 1`
           echo 'Uploading '$f
           cp $f ${UPLOADCHUNKFILE}
           UPLOAD_RESPONSE=
           UPLOAD_RESPONSE=`curl -k --silent -X POST "https://$UI/api/v1/userattr/replaceall/$UPLOADTOKEN" -F files=@$UPLOADCHUNKFILE -H "Content-Range: bytes $startbytes-$endbytes/$UPLOADFILESIZE"`
           echo $UPLOAD_RESPONSE
           startbytes=`expr $endbytes + 1`
           UPLOADSTATUS=`echo "$UPLOAD_RESPONSE" | jsonValue "status"`
           if [ "$UPLOADSTATUS" == "error" ]; then
                echo 'Upload Failed'
                echo $UPLOAD_RESPONSE
                break
           fi
        done
        if [ $UPLOADSTATUS == "success" ]; then
            echo 'Data successfully Uploaded to Netskope'
            rm -rf ./nsuploadtmp
            echo 'Deleting the temporary nsuploadtmp directory'
        fi
   else
        echo "CSV file less than/equal to 5 MB. No need to split......"
        # Post the file as-is to the netskope endpoint
        UPLOAD_RESPONSE=`curl -k --silent -X POST -F files=@${UPLOADFILE} "https://${UI}/api/v1/userattr/replaceall/${UPLOADTOKEN}"`
        UPLOADSTATUS=`echo "$UPLOAD_RESPONSE" | jsonValue "status"`
        echo $UPLOAD_RESPONSE
        if [ "$UPLOADSTATUS" == "error" ]; then
           echo 'Upload Failed'
           echo $UPLOAD_RESPONSE
        else
           echo 'Data successfully Uploaded to Netskope'
        fi
   fi
}


while [ "$1" != "" ]; do
    case $1 in
        -u | --uiendpoint ) shift
                UI=$1
                 ;;
        -f | --csvfile )    shift
		        CSVFILE=$1
		;;
        -t | --resttoken )  shift
		        RESTTOKEN=$1
		;;
        -h | --help ) usage
                      exit 1
                                ;;
        * )           usage
                      exit 2
    esac
    shift
done


getToken ${UI} ${RESTTOKEN}
echo 'Upload Token fetched='${UPLOADTOKEN}

if [ "$TOKENSTATUS" == "success" ]; then
    uploadFile ${CSVFILE} ${UPLOADTOKEN}
else
   exit 1
fi
</pre></div></div><br class="example-break"></br></section><div class="footer-content"><div class="section-toc section-toc-after"><div class="section-toc-title">In this section<span class="section-toc-title-delimiter">: </span></div></div><div class="glossary-definitions"></div></div><footer></footer></div></article><article id="search-result-wrapper"><div class="search-container" style="display: none;"><h2>Search results</h2><ul class="searchresults"></ul><p class="noresults">No results found</p></div></article><div class="feedback-panel"><div id="email-feedback" class="no-voting toggle-feedback"><p><a href="mailto:techpubs@netskope.com?subject=Feedback%20for%20help%20topic%20%22Add%20Custom%20User%20Attributes%22&amp;body=%0A%09%09%09%09%0A%09%09%09%09%0A%09%09%09%09_______________________%0A%09%09%09%09%0A%09%09%09Please%20add%20your%20feedback%20above%20for%20topic%20%22Add%20Custom%20User%20Attributes%22%20in%20the%20publication%20%22Netskope%20Help%22."><i aria-hidden="true" class="fa fa-pencil-square-o feedbackicon"></i>Would you like to provide feedback? Just click here to suggest edits.</a></p></div></div></main><div id="bottom-pager"><ul class="pager"><li class="previous"><a accesskey="p" id="header-navigation-prev" class="pull-left prev visible-lg visible-md" href="upgrade-the-netskope-adapters.html">Prev</a></li><li class="next"><a accesskey="n" id="header-navigation-next" class="pull-right next visible-lg visible-md" href="appliances.html">Next</a></li></ul></div><footer class="site-footer"><div class="inner"><div class="copyright"> © 2021 Netskope </div><div class="date-modified"><span class="date-modified-text">Last modified: </span><span class="formatted-date">September 17, 2019</span></div><div class="publication-date"><span class="publication-date-text">Publication date</span><span class="pubdate-delimiter">: </span><span class="formatted-date"></span></div></div></footer></div></div></div></div></body></html>
